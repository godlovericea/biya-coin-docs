# Git 分支切换和提交指南

## 场景：从 main 分支切换到 wanli 分支并提交代码

### 方案 1：未暂存的修改（推荐）

如果你还没有提交任何代码，当前修改仍在工作区：

```bash
# 1. 查看当前状态
git status

# 2. 暂存所有修改
git stash save "保存 main 分支上的修改"

# 3. 切换或创建 wanli 分支
# 如果 wanli 分支不存在，创建并切换
git checkout -b wanli

# 如果 wanli 分支已存在，直接切换
git checkout wanli

# 4. 恢复之前暂存的修改
git stash pop

# 5. 查看修改的文件
git status

# 6. 添加所有修改到暂存区
git add .

# 7. 提交修改
git commit -m "feat: 添加产品页面和登录页面优化

- 新增 product 页面及组件
- 优化登录页面交互效果
- 添加 Figma MCP 配置文档
- 更新国际化翻译文件"

# 8. 推送到远程 wanli 分支
git push origin wanli

# 如果是第一次推送该分支
git push -u origin wanli
```

### 方案 2：已提交到 main 分支

如果你已经在 main 分支提交了代码：

```bash
# 1. 查看最近的提交
git log --oneline -5

# 2. 记住要移动的 commit hash（例如：abc123）

# 3. 创建并切换到 wanli 分支（基于当前 main）
git checkout -b wanli

# 4. 推送到远程
git push -u origin wanli

# 5. 切换回 main 分支
git checkout main

# 6. 重置 main 分支到之前的提交（撤销刚才的提交）
# 使用 HEAD~1 表示回退 1 个提交，如果有多个提交用 HEAD~n
git reset --hard HEAD~1

# 7. 强制推送到远程 main（如果已经推送过）
# ⚠️ 注意：强制推送会覆盖远程历史，谨慎使用
git push --force origin main
```

### 方案 3：Cherry-pick 方式（精确控制）

如果你想精确控制哪些提交移动到 wanli 分支：

```bash
# 1. 查看提交历史，记录要移动的 commit hash
git log --oneline -10

# 2. 创建/切换到 wanli 分支
git checkout -b wanli origin/main  # 基于远程 main 创建

# 或者如果 wanli 已存在
git checkout wanli

# 3. Cherry-pick 特定的提交（假设 commit hash 是 abc123）
git cherry-pick abc123

# 如果有多个连续的提交（从 abc123 到 xyz789）
git cherry-pick abc123^..xyz789

# 4. 推送到远程
git push origin wanli
```

---

## 快速操作命令（推荐使用）

### 情况 A：修改未提交

```bash
cd biya-helix-app

# 保存当前修改
git stash

# 切换到 wanli 分支（如果不存在则创建）
git checkout -b wanli

# 恢复修改
git stash pop

# 提交
git add .
git commit -m "feat: 更新产品页面和登录页面"
git push -u origin wanli
```

### 情况 B：修改已提交到 main

```bash
cd biya-helix-app

# 创建 wanli 分支（携带当前的提交）
git checkout -b wanli

# 推送到远程
git push -u origin wanli

# （可选）如果需要清理 main 分支
git checkout main
git reset --hard origin/main  # 重置到远程 main 的状态
```

---

## 验证步骤

完成后验证操作是否正确：

```bash
# 1. 确认当前在 wanli 分支
git branch

# 输出应该显示：
# * wanli
#   main

# 2. 查看提交历史
git log --oneline -5

# 3. 查看远程分支
git branch -r

# 4. 查看文件状态
git status
```

---

## 注意事项

### ⚠️ 重要提醒

1. **备份重要修改**
   ```bash
   # 在任何重置操作前，创建备份分支
   git branch backup-$(date +%Y%m%d-%H%M%S)
   ```

2. **检查远程分支状态**
   ```bash
   # 查看远程有哪些分支
   git branch -r
   
   # 拉取最新的远程分支信息
   git fetch origin
   ```

3. **避免强制推送到主分支**
   - ❌ 不要对 main/master 分支使用 `--force`
   - ✅ 对功能分支可以使用 `--force-with-lease`（更安全）

4. **团队协作考虑**
   - 如果有其他人正在使用 main 分支，不要重置 main
   - 考虑使用 revert 而不是 reset

---

## 常见问题

### Q1: git stash pop 后有冲突怎么办？

```bash
# 查看冲突文件
git status

# 手动解决冲突后
git add <解决冲突的文件>

# 删除 stash 记录
git stash drop
```

### Q2: 忘记切换分支就提交了怎么办？

```bash
# 使用 cherry-pick 将提交复制到正确的分支
git checkout wanli
git cherry-pick <commit-hash>
```

### Q3: 如何撤销已推送的提交？

```bash
# 方法 1: 使用 revert（推荐，不改变历史）
git revert <commit-hash>
git push origin wanli

# 方法 2: 使用 reset + force push（危险）
git reset --hard HEAD~1
git push --force-with-lease origin wanli
```

### Q4: wanli 分支已存在但很旧，如何更新？

```bash
# 切换到 wanli
git checkout wanli

# 拉取最新代码
git pull origin wanli

# 合并 main 的最新代码
git merge main

# 或者使用 rebase（保持历史线性）
git rebase main
```

---

## 推荐工作流

### 标准功能开发流程

```bash
# 1. 从 main 创建功能分支
git checkout main
git pull origin main
git checkout -b feature/your-feature

# 2. 开发和提交
git add .
git commit -m "feat: 实现某功能"

# 3. 推送到远程
git push -u origin feature/your-feature

# 4. 在 GitHub/GitLab 上创建 Pull Request

# 5. 代码审查通过后合并到 main
```

---

## 图示说明

### 当前状态
```
main -------- [你的修改]
```

### 目标状态
```
main -------- (干净)
            \
wanli ------- [你的修改]
```

---

**创建时间：** 2025-01-31  
**适用场景：** Git 分支管理、代码迁移

