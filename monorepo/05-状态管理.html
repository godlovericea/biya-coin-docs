<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05-çŠ¶æ€ç®¡ç†</title>
    <link rel="stylesheet" href="../md2html/style.css">
</head>
<body>

<div class="content">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05-çŠ¶æ€ç®¡ç†</title>
    <link rel="stylesheet" href="../md2html/style.css">
</head>
<body>
<nav class="table-of-contents">
  <h2 class="toc-title">ğŸ“‘ ç›®å½•</h2>
  <ul class="toc-list">
    <li class="toc-item toc-level-1">
      <a href="#çŠ¶æ€ç®¡ç†ç­–ç•¥" class="toc-link">ğŸ—‚ï¸ çŠ¶æ€ç®¡ç†ç­–ç•¥</a>
    <li class="toc-item toc-level-2">
      <a href="#ç›®å½•" class="toc-link">ğŸ“– ç›®å½•</a>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#çŠ¶æ€åˆ†å±‚ç­–ç•¥" class="toc-link">ğŸ¯ çŠ¶æ€åˆ†å±‚ç­–ç•¥</a>
    <li class="toc-item toc-level-3">
      <a href="#æ ¸å¿ƒåŸåˆ™" class="toc-link">æ ¸å¿ƒåŸåˆ™</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#å†³ç­–æ ‘" class="toc-link">å†³ç­–æ ‘</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#å…±äº«çŠ¶æ€è®¾è®¡" class="toc-link">ğŸŒ å…±äº«çŠ¶æ€è®¾è®¡</a>
    <li class="toc-item toc-level-3">
      <a href="#1-theme-store-ä¸»é¢˜çŠ¶æ€" class="toc-link">1. Theme Storeï¼ˆä¸»é¢˜çŠ¶æ€ï¼‰</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-wallet-store-é’±åŒ…çŠ¶æ€" class="toc-link">2. Wallet Storeï¼ˆé’±åŒ…çŠ¶æ€ï¼‰</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-auth-store-è®¤è¯çŠ¶æ€" class="toc-link">3. Auth Storeï¼ˆè®¤è¯çŠ¶æ€ï¼‰</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#åº”ç”¨ç‰¹å®šçŠ¶æ€" class="toc-link">ğŸ® åº”ç”¨ç‰¹å®šçŠ¶æ€</a>
    <li class="toc-item toc-level-3">
      <a href="#1-bridge-app-state" class="toc-link">1. Bridge App State</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-dex-app-state" class="toc-link">2. DEX App State</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-helix-app-state" class="toc-link">3. Helix App State</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#çŠ¶æ€æŒä¹…åŒ–" class="toc-link">ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–</a>
    <li class="toc-item toc-level-3">
      <a href="#1-æŒä¹…åŒ–ç­–ç•¥" class="toc-link">1. æŒä¹…åŒ–ç­–ç•¥</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-æŒä¹…åŒ–æ¸…å•" class="toc-link">2. æŒä¹…åŒ–æ¸…å•</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-è‡ªå®šä¹‰å­˜å‚¨" class="toc-link">3. è‡ªå®šä¹‰å­˜å‚¨</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æ€§èƒ½ä¼˜åŒ–" class="toc-link">âš¡ æ€§èƒ½ä¼˜åŒ–</a>
    <li class="toc-item toc-level-3">
      <a href="#1-ä½¿ç”¨é€‰æ‹©å™¨" class="toc-link">1. ä½¿ç”¨é€‰æ‹©å™¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-ç»„åˆå¤šä¸ªé€‰æ‹©å™¨" class="toc-link">2. ç»„åˆå¤šä¸ªé€‰æ‹©å™¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-é¿å…å†…è”é€‰æ‹©å™¨" class="toc-link">3. é¿å…å†…è”é€‰æ‹©å™¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#4-ä½¿ç”¨-useshallow-hook" class="toc-link">4. ä½¿ç”¨ useShallow Hook</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æœ€ä½³å®è·µ" class="toc-link">ğŸ“‹ æœ€ä½³å®è·µ</a>
    <li class="toc-item toc-level-3">
      <a href="#1-çŠ¶æ€åˆ†å±‚åŸåˆ™" class="toc-link">1. çŠ¶æ€åˆ†å±‚åŸåˆ™</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-å•ä¸€èŒè´£" class="toc-link">2. å•ä¸€èŒè´£</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-ç±»å‹å®‰å…¨" class="toc-link">3. ç±»å‹å®‰å…¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#4-å¯¼å‡ºé€‰æ‹©å™¨" class="toc-link">4. å¯¼å‡ºé€‰æ‹©å™¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#5-actions-å‘½åçº¦å®š" class="toc-link">5. Actions å‘½åçº¦å®š</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#6-é”™è¯¯å¤„ç†" class="toc-link">6. é”™è¯¯å¤„ç†</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#7-devtools-é›†æˆ" class="toc-link">7. DevTools é›†æˆ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#ä¸‹ä¸€æ­¥" class="toc-link">ğŸš€ ä¸‹ä¸€æ­¥</a>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æœ¬ç« å°ç»“" class="toc-link">ğŸ“š æœ¬ç« å°ç»“</a>
    <li class="toc-item toc-level-3">
      <a href="#çŠ¶æ€åˆ†å±‚" class="toc-link">çŠ¶æ€åˆ†å±‚</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ ¸å¿ƒåŸåˆ™" class="toc-link">æ ¸å¿ƒåŸåˆ™</a>
    </ul>
  </li>
    </ul>
  </li>
  </li>
  </ul>
</nav>

<div class="content">
<h1 id="çŠ¶æ€ç®¡ç†ç­–ç•¥">ğŸ—‚ï¸ çŠ¶æ€ç®¡ç†ç­–ç•¥</h1>
<blockquote>
<p><strong>æ ¸å¿ƒå†…å®¹</strong>: Zustand çŠ¶æ€ç®¡ç†çš„åˆ†å±‚è®¾è®¡ä¸æœ€ä½³å®è·µ<br><strong>ç›®æ ‡</strong>: åŒºåˆ†å…±äº«çŠ¶æ€å’Œåº”ç”¨ç‰¹å®šçŠ¶æ€ï¼Œå®ç°é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†<br><strong>æ›´æ–°æ—¶é—´</strong>: 2025-10-31</p>
</blockquote>
<hr>
<h2 id="ç›®å½•">ğŸ“– ç›®å½•</h2>
<ol>
<li><a href="#%E7%8A%B6%E6%80%81%E5%88%86%E5%B1%82%E7%AD%96%E7%95%A5">çŠ¶æ€åˆ†å±‚ç­–ç•¥</a></li>
<li><a href="#%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1">å…±äº«çŠ¶æ€è®¾è®¡</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E7%89%B9%E5%AE%9A%E7%8A%B6%E6%80%81">åº”ç”¨ç‰¹å®šçŠ¶æ€</a></li>
<li><a href="#%E7%8A%B6%E6%80%81%E6%8C%81%E4%B9%85%E5%8C%96">çŠ¶æ€æŒä¹…åŒ–</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">æ€§èƒ½ä¼˜åŒ–</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">æœ€ä½³å®è·µ</a></li>
</ol>
<hr>
<h2 id="çŠ¶æ€åˆ†å±‚ç­–ç•¥">ğŸ¯ çŠ¶æ€åˆ†å±‚ç­–ç•¥</h2>
<h3 id="æ ¸å¿ƒåŸåˆ™">æ ¸å¿ƒåŸåˆ™</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åº”ç”¨å±‚çŠ¶æ€                      â”‚
â”‚  (App-Specific State in apps/*/store/)         â”‚
â”‚  â”œâ”€â”€ Bridge: äº¤æ˜“å†å²ã€è¡¨å•çŠ¶æ€                 â”‚
â”‚  â”œâ”€â”€ DEX: è®¢å•ç°¿ã€äº¤æ˜“å¯¹                        â”‚
â”‚  â””â”€â”€ Helix: ç”¨æˆ·åå¥½ã€ä¸´æ—¶æ•°æ®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–²
                      â”‚ å¼•ç”¨
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å…±äº«å±‚çŠ¶æ€                      â”‚
â”‚  (Shared State in packages/*/store/)           â”‚
â”‚  â”œâ”€â”€ @biya/theme: ä¸»é¢˜é…ç½®                      â”‚
â”‚  â”œâ”€â”€ @biya/wallet: é’±åŒ…è¿æ¥                     â”‚
â”‚  â””â”€â”€ @biya/auth: ç”¨æˆ·è®¤è¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr>
<h3 id="å†³ç­–æ ‘">å†³ç­–æ ‘</h3>
<pre><code>çŠ¶æ€éœ€è¦è·¨åº”ç”¨å…±äº«ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ”¾åœ¨å…±äº«åŒ…ä¸­ (packages/*/store/)
â”‚   â”œâ”€ ä¸»é¢˜è®¾ç½® â†’ @biya/theme
â”‚   â”œâ”€ é’±åŒ…è¿æ¥ â†’ @biya/wallet
â”‚   â”œâ”€ ç”¨æˆ·è®¤è¯ â†’ @biya/auth
â”‚   â””â”€ å…¶ä»–å…¨å±€çŠ¶æ€ â†’ @biya/shared/store
â”‚
â””â”€ å¦ â†’ æ”¾åœ¨åº”ç”¨ä¸­ (apps/*/store/)
    â”œâ”€ Bridge äº¤æ˜“è®°å½• â†’ apps/bridge/store
    â”œâ”€ DEX è®¢å•æ•°æ® â†’ apps/dex/store
    â””â”€ Helix ç‰¹å®šçŠ¶æ€ â†’ apps/helix/store
</code></pre>
<hr>
<h2 id="å…±äº«çŠ¶æ€è®¾è®¡">ğŸŒ å…±äº«çŠ¶æ€è®¾è®¡</h2>
<h3 id="1-theme-store-ä¸»é¢˜çŠ¶æ€">1. Theme Storeï¼ˆä¸»é¢˜çŠ¶æ€ï¼‰</h3>
<pre><code class="language-typescript">// packages/theme/store/theme-store.ts
import { create } from &#39;zustand&#39;
import { persist, createJSONStorage } from &#39;zustand/middleware&#39;

<p>export type Theme = &#39;light&#39; | &#39;dark&#39; | &#39;system&#39;</p>
<p>interface ThemeState {<br>  // çŠ¶æ€<br>  theme: Theme<br>  isDark: boolean</p>
<p>  // æ“ä½œ<br>  setTheme: (theme: Theme) =&gt; void<br>  toggleTheme: () =&gt; void<br>}</p>
<p>export const useThemeStore = create&lt;ThemeState&gt;()(<br>  persist(<br>    (set, get) =&gt; ({<br>      theme: &#39;system&#39;,<br>      isDark: false,</p>
<pre><code>  setTheme: (theme) =&amp;gt; {
    const root = document.documentElement
    const isDark = theme === &amp;#39;dark&amp;#39; || 
      (theme === &amp;#39;system&amp;#39; &amp;amp;&amp;amp; window.matchMedia(&amp;#39;(prefers-color-scheme: dark)&amp;#39;).matches)
    
    root.classList.toggle(&amp;#39;dark&amp;#39;, isDark)
    set({ theme, isDark })
  },
  
  toggleTheme: () =&amp;gt; {
    const current = get().theme
    const newTheme = current === &amp;#39;dark&amp;#39; ? &amp;#39;light&amp;#39; : &amp;#39;dark&amp;#39;
    get().setTheme(newTheme)
  },
}),
{
  name: &amp;#39;biya-theme-storage&amp;#39;,
  storage: createJSONStorage(() =&amp;gt; localStorage),
}
</code></pre>
<p>  )<br>)</p>
<p>// å¯¼å‡ºé€‰æ‹©å™¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰<br>export const selectTheme = (state: ThemeState) =&gt; state.theme<br>export const selectIsDark = (state: ThemeState) =&gt; state.isDark<br></code></pre></p>
<hr>
<h3 id="2-wallet-store-é’±åŒ…çŠ¶æ€">2. Wallet Storeï¼ˆé’±åŒ…çŠ¶æ€ï¼‰</h3>
<pre><code class="language-typescript">// packages/wallet/store/wallet-store.ts
import { create } from &#39;zustand&#39;
import { persist, createJSONStorage } from &#39;zustand/middleware&#39;

<p>interface WalletState {<br>  // EVM é’±åŒ…<br>  address: string | null<br>  chainId: number | null</p>
<p>  // Injective é’±åŒ…<br>  injectiveAddress: string | null</p>
<p>  // çŠ¶æ€<br>  isConnected: boolean<br>  isConnecting: boolean</p>
<p>  // ä½™é¢<br>  balance: string | null</p>
<p>  // æ“ä½œ<br>  connect: () =&gt; Promise&lt;void&gt;<br>  disconnect: () =&gt; void<br>  setAddress: (address: string | null) =&gt; void<br>  setInjectiveAddress: (address: string | null) =&gt; void<br>  setChainId: (chainId: number | null) =&gt; void<br>  setBalance: (balance: string | null) =&gt; void<br>  reset: () =&gt; void<br>}</p>
<p>export const useWalletStore = create&lt;WalletState&gt;()(<br>  persist(<br>    (set) =&gt; ({<br>      // åˆå§‹çŠ¶æ€<br>      address: null,<br>      chainId: null,<br>      injectiveAddress: null,<br>      isConnected: false,<br>      isConnecting: false,<br>      balance: null,</p>
<pre><code>  // è¿æ¥é’±åŒ…
  connect: async () =&amp;gt; {
    set({ isConnecting: true })
    try {
      // è¿æ¥é€»è¾‘
      // const { address, chainId } = await connectWallet()
      // set({ address, chainId, isConnected: true })
    } catch (error) {
      console.error(&amp;#39;Failed to connect wallet:&amp;#39;, error)
      throw error
    } finally {
      set({ isConnecting: false })
    }
  },
  
  // æ–­å¼€è¿æ¥
  disconnect: () =&amp;gt; {
    set({
      address: null,
      chainId: null,
      injectiveAddress: null,
      isConnected: false,
      balance: null,
    })
  },
  
  // Setters
  setAddress: (address) =&amp;gt; set({ address, isConnected: !!address }),
  setInjectiveAddress: (injectiveAddress) =&amp;gt; set({ injectiveAddress }),
  setChainId: (chainId) =&amp;gt; set({ chainId }),
  setBalance: (balance) =&amp;gt; set({ balance }),
  
  // é‡ç½®
  reset: () =&amp;gt; {
    set({
      address: null,
      chainId: null,
      injectiveAddress: null,
      isConnected: false,
      isConnecting: false,
      balance: null,
    })
  },
}),
{
  name: &amp;#39;biya-wallet-storage&amp;#39;,
  storage: createJSONStorage(() =&amp;gt; localStorage),
  partialize: (state) =&amp;gt; ({
    address: state.address,
    chainId: state.chainId,
    injectiveAddress: state.injectiveAddress,
  }),
}
</code></pre>
<p>  )<br>)</p>
<p>// é€‰æ‹©å™¨<br>export const selectAddress = (state: WalletState) =&gt; state.address<br>export const selectIsConnected = (state: WalletState) =&gt; state.isConnected<br>export const selectBalance = (state: WalletState) =&gt; state.balance<br></code></pre></p>
<hr>
<h3 id="3-auth-store-è®¤è¯çŠ¶æ€">3. Auth Storeï¼ˆè®¤è¯çŠ¶æ€ï¼‰</h3>
<pre><code class="language-typescript">// packages/auth/store/auth-store.ts
import { create } from &#39;zustand&#39;
import { persist, createJSONStorage } from &#39;zustand/middleware&#39;

<p>interface User {<br>  id: string<br>  email: string<br>  name: string<br>  avatar?: string<br>}</p>
<p>interface AuthState {<br>  // ç”¨æˆ·ä¿¡æ¯<br>  user: User | null<br>  token: string | null</p>
<p>  // çŠ¶æ€<br>  isAuthenticated: boolean<br>  isLoading: boolean</p>
<p>  // æ“ä½œ<br>  login: (email: string, password: string) =&gt; Promise&lt;void&gt;<br>  logout: () =&gt; void<br>  setUser: (user: User | null) =&gt; void<br>  setToken: (token: string | null) =&gt; void<br>  refreshToken: () =&gt; Promise&lt;void&gt;<br>}</p>
<p>export const useAuthStore = create&lt;AuthState&gt;()(<br>  persist(<br>    (set, get) =&gt; ({<br>      // åˆå§‹çŠ¶æ€<br>      user: null,<br>      token: null,<br>      isAuthenticated: false,<br>      isLoading: false,</p>
<pre><code>  // ç™»å½•
  login: async (email, password) =&amp;gt; {
    set({ isLoading: true })
    try {
      // const response = await authService.login(email, password)
      // set({
      //   user: response.user,
      //   token: response.token,
      //   isAuthenticated: true,
      // })
    } catch (error) {
      console.error(&amp;#39;Login failed:&amp;#39;, error)
      throw error
    } finally {
      set({ isLoading: false })
    }
  },
  
  // ç™»å‡º
  logout: () =&amp;gt; {
    set({
      user: null,
      token: null,
      isAuthenticated: false,
    })
  },
  
  // Setters
  setUser: (user) =&amp;gt; set({ user, isAuthenticated: !!user }),
  setToken: (token) =&amp;gt; set({ token }),
  
  // åˆ·æ–° Token
  refreshToken: async () =&amp;gt; {
    const currentToken = get().token
    if (!currentToken) return
    
    try {
      // const newToken = await authService.refreshToken(currentToken)
      // set({ token: newToken })
    } catch (error) {
      console.error(&amp;#39;Failed to refresh token:&amp;#39;, error)
      get().logout()
    }
  },
}),
{
  name: &amp;#39;biya-auth-storage&amp;#39;,
  storage: createJSONStorage(() =&amp;gt; localStorage),
  partialize: (state) =&amp;gt; ({
    user: state.user,
    token: state.token,
  }),
}
</code></pre>
<p>  )<br>)</p>
<p>// é€‰æ‹©å™¨<br>export const selectUser = (state: AuthState) =&gt; state.user<br>export const selectIsAuthenticated = (state: AuthState) =&gt; state.isAuthenticated<br>export const selectToken = (state: AuthState) =&gt; state.token<br></code></pre></p>
<hr>
<h2 id="åº”ç”¨ç‰¹å®šçŠ¶æ€">ğŸ® åº”ç”¨ç‰¹å®šçŠ¶æ€</h2>
<h3 id="1-bridge-app-state">1. Bridge App State</h3>
<pre><code class="language-typescript">// apps/bridge/store/bridge-store.ts
import { create } from &#39;zustand&#39;

<p>interface BridgeTransaction {<br>  id: string<br>  from: string<br>  to: string<br>  amount: string<br>  token: string<br>  status: &#39;pending&#39; | &#39;completed&#39; | &#39;failed&#39;<br>  timestamp: number<br>  txHash?: string<br>}</p>
<p>interface BridgeState {<br>  // äº¤æ˜“å†å²<br>  transactions: BridgeTransaction[]</p>
<p>  // è¡¨å•çŠ¶æ€<br>  fromChain: string<br>  toChain: string<br>  selectedToken: string<br>  amount: string</p>
<p>  // UI çŠ¶æ€<br>  isTransferring: boolean<br>  showHistory: boolean</p>
<p>  // æ“ä½œ<br>  addTransaction: (tx: BridgeTransaction) =&gt; void<br>  updateTransaction: (id: string, updates: Partial&lt;BridgeTransaction&gt;) =&gt; void<br>  setFromChain: (chain: string) =&gt; void<br>  setToChain: (chain: string) =&gt; void<br>  setSelectedToken: (token: string) =&gt; void<br>  setAmount: (amount: string) =&gt; void<br>  setTransferring: (transferring: boolean) =&gt; void<br>  toggleHistory: () =&gt; void<br>  reset: () =&gt; void<br>}</p>
<p>export const useBridgeStore = create&lt;BridgeState&gt;((set) =&gt; ({<br>  // åˆå§‹çŠ¶æ€<br>  transactions: [],<br>  fromChain: &#39;ethereum&#39;,<br>  toChain: &#39;injective&#39;,<br>  selectedToken: &#39;USDT&#39;,<br>  amount: &#39;&#39;,<br>  isTransferring: false,<br>  showHistory: false,</p>
<p>  // äº¤æ˜“æ“ä½œ<br>  addTransaction: (tx) =&gt; set((state) =&gt; ({<br>    transactions: [tx, ...state.transactions],<br>  })),</p>
<p>  updateTransaction: (id, updates) =&gt; set((state) =&gt; ({<br>    transactions: state.transactions.map((tx) =&gt;<br>      tx.id === id ? { ...tx, ...updates } : tx<br>    ),<br>  })),</p>
<p>  // è¡¨å•æ“ä½œ<br>  setFromChain: (fromChain) =&gt; set({ fromChain }),<br>  setToChain: (toChain) =&gt; set({ toChain }),<br>  setSelectedToken: (selectedToken) =&gt; set({ selectedToken }),<br>  setAmount: (amount) =&gt; set({ amount }),</p>
<p>  // UI æ“ä½œ<br>  setTransferring: (isTransferring) =&gt; set({ isTransferring }),<br>  toggleHistory: () =&gt; set((state) =&gt; ({ showHistory: !state.showHistory })),</p>
<p>  // é‡ç½®<br>  reset: () =&gt; set({<br>    fromChain: &#39;ethereum&#39;,<br>    toChain: &#39;injective&#39;,<br>    selectedToken: &#39;USDT&#39;,<br>    amount: &#39;&#39;,<br>    isTransferring: false,<br>  }),<br>}))</p>
<p>// é€‰æ‹©å™¨<br>export const selectTransactions = (state: BridgeState) =&gt; state.transactions<br>export const selectIsTransferring = (state: BridgeState) =&gt; state.isTransferring<br></code></pre></p>
<hr>
<h3 id="2-dex-app-state">2. DEX App State</h3>
<pre><code class="language-typescript">// apps/dex/store/dex-store.ts
import { create } from &#39;zustand&#39;

<p>interface Order {<br>  id: string<br>  type: &#39;buy&#39; | &#39;sell&#39;<br>  price: string<br>  amount: string<br>  total: string<br>  timestamp: number<br>  status: &#39;pending&#39; | &#39;filled&#39; | &#39;cancelled&#39;<br>}</p>
<p>interface DexState {<br>  // äº¤æ˜“å¯¹<br>  baseCurrency: string<br>  quoteCurrency: string</p>
<p>  // è®¢å•ç°¿<br>  buyOrders: Order[]<br>  sellOrders: Order[]</p>
<p>  // ç”¨æˆ·è®¢å•<br>  myOrders: Order[]</p>
<p>  // è¡¨å•çŠ¶æ€<br>  orderType: &#39;buy&#39; | &#39;sell&#39;<br>  price: string<br>  amount: string</p>
<p>  // UI çŠ¶æ€<br>  isPlacingOrder: boolean</p>
<p>  // æ“ä½œ<br>  setTradingPair: (base: string, quote: string) =&gt; void<br>  setBuyOrders: (orders: Order[]) =&gt; void<br>  setSellOrders: (orders: Order[]) =&gt; void<br>  addMyOrder: (order: Order) =&gt; void<br>  updateMyOrder: (id: string, updates: Partial&lt;Order&gt;) =&gt; void<br>  setOrderType: (type: &#39;buy&#39; | &#39;sell&#39;) =&gt; void<br>  setPrice: (price: string) =&gt; void<br>  setAmount: (amount: string) =&gt; void<br>  setPlacingOrder: (placing: boolean) =&gt; void<br>  reset: () =&gt; void<br>}</p>
<p>export const useDexStore = create&lt;DexState&gt;((set) =&gt; ({<br>  // åˆå§‹çŠ¶æ€<br>  baseCurrency: &#39;INJ&#39;,<br>  quoteCurrency: &#39;USDT&#39;,<br>  buyOrders: [],<br>  sellOrders: [],<br>  myOrders: [],<br>  orderType: &#39;buy&#39;,<br>  price: &#39;&#39;,<br>  amount: &#39;&#39;,<br>  isPlacingOrder: false,</p>
<p>  // äº¤æ˜“å¯¹æ“ä½œ<br>  setTradingPair: (baseCurrency, quoteCurrency) =&gt; set({ baseCurrency, quoteCurrency }),</p>
<p>  // è®¢å•ç°¿æ“ä½œ<br>  setBuyOrders: (buyOrders) =&gt; set({ buyOrders }),<br>  setSellOrders: (sellOrders) =&gt; set({ sellOrders }),</p>
<p>  // ç”¨æˆ·è®¢å•æ“ä½œ<br>  addMyOrder: (order) =&gt; set((state) =&gt; ({<br>    myOrders: [order, ...state.myOrders],<br>  })),</p>
<p>  updateMyOrder: (id, updates) =&gt; set((state) =&gt; ({<br>    myOrders: state.myOrders.map((order) =&gt;<br>      order.id === id ? { ...order, ...updates } : order<br>    ),<br>  })),</p>
<p>  // è¡¨å•æ“ä½œ<br>  setOrderType: (orderType) =&gt; set({ orderType }),<br>  setPrice: (price) =&gt; set({ price }),<br>  setAmount: (amount) =&gt; set({ amount }),</p>
<p>  // UI æ“ä½œ<br>  setPlacingOrder: (isPlacingOrder) =&gt; set({ isPlacingOrder }),</p>
<p>  // é‡ç½®<br>  reset: () =&gt; set({<br>    orderType: &#39;buy&#39;,<br>    price: &#39;&#39;,<br>    amount: &#39;&#39;,<br>    isPlacingOrder: false,<br>  }),<br>}))</p>
<p>// é€‰æ‹©å™¨<br>export const selectBuyOrders = (state: DexState) =&gt; state.buyOrders<br>export const selectSellOrders = (state: DexState) =&gt; state.sellOrders<br>export const selectMyOrders = (state: DexState) =&gt; state.myOrders<br></code></pre></p>
<hr>
<h3 id="3-helix-app-state">3. Helix App State</h3>
<pre><code class="language-typescript">// apps/helix/store/helix-store.ts
import { create } from &#39;zustand&#39;
import { persist, createJSONStorage } from &#39;zustand/middleware&#39;

<p>interface HelixState {<br>  // ç”¨æˆ·åå¥½<br>  defaultView: &#39;simple&#39; | &#39;advanced&#39;<br>  showTutorial: boolean<br>  favoriteTokens: string[]</p>
<p>  // UI çŠ¶æ€<br>  sidebarOpen: boolean</p>
<p>  // æ“ä½œ<br>  setDefaultView: (view: &#39;simple&#39; | &#39;advanced&#39;) =&gt; void<br>  setShowTutorial: (show: boolean) =&gt; void<br>  addFavoriteToken: (token: string) =&gt; void<br>  removeFavoriteToken: (token: string) =&gt; void<br>  toggleSidebar: () =&gt; void<br>}</p>
<p>export const useHelixStore = create&lt;HelixState&gt;()(<br>  persist(<br>    (set) =&gt; ({<br>      // åˆå§‹çŠ¶æ€<br>      defaultView: &#39;simple&#39;,<br>      showTutorial: true,<br>      favoriteTokens: [],<br>      sidebarOpen: true,</p>
<pre><code>  // æ“ä½œ
  setDefaultView: (defaultView) =&amp;gt; set({ defaultView }),
  setShowTutorial: (showTutorial) =&amp;gt; set({ showTutorial }),
  
  addFavoriteToken: (token) =&amp;gt; set((state) =&amp;gt; ({
    favoriteTokens: [...state.favoriteTokens, token],
  })),
  
  removeFavoriteToken: (token) =&amp;gt; set((state) =&amp;gt; ({
    favoriteTokens: state.favoriteTokens.filter((t) =&amp;gt; t !== token),
  })),
  
  toggleSidebar: () =&amp;gt; set((state) =&amp;gt; ({
    sidebarOpen: !state.sidebarOpen,
  })),
}),
{
  name: &amp;#39;helix-storage&amp;#39;,
  storage: createJSONStorage(() =&amp;gt; localStorage),
}
</code></pre>
<p>  )<br>)</p>
<p>// é€‰æ‹©å™¨<br>export const selectFavoriteTokens = (state: HelixState) =&gt; state.favoriteTokens<br>export const selectSidebarOpen = (state: HelixState) =&gt; state.sidebarOpen<br></code></pre></p>
<hr>
<h2 id="çŠ¶æ€æŒä¹…åŒ–">ğŸ’¾ çŠ¶æ€æŒä¹…åŒ–</h2>
<h3 id="1-æŒä¹…åŒ–ç­–ç•¥">1. æŒä¹…åŒ–ç­–ç•¥</h3>
<pre><code class="language-typescript">// æŒä¹…åŒ–æ‰€æœ‰çŠ¶æ€ï¼ˆé»˜è®¤ï¼‰
persist(
  (set) =&gt; ({ /* ... */ }),
  {
    name: &#39;storage-key&#39;,
    storage: createJSONStorage(() =&gt; localStorage),
  }
)

<p>// éƒ¨åˆ†æŒä¹…åŒ–<br>persist(<br>  (set) =&gt; ({ /* ... */ }),<br>  {<br>    name: &#39;storage-key&#39;,<br>    storage: createJSONStorage(() =&gt; localStorage),<br>    partialize: (state) =&gt; ({<br>      // åªæŒä¹…åŒ–è¿™äº›å­—æ®µ<br>      theme: state.theme,<br>      user: state.user,<br>    }),<br>  }<br>)</p>
<p>// ä¸æŒä¹…åŒ–<br>create&lt;State&gt;((set) =&gt; ({ /* ... */ }))<br></code></pre></p>
<hr>
<h3 id="2-æŒä¹…åŒ–æ¸…å•">2. æŒä¹…åŒ–æ¸…å•</h3>
<table>
<thead>
<tr>
<th>Store</th>
<th>æŒä¹…åŒ–</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody><tr>
<td><code>@biya/theme</code></td>
<td>âœ… å…¨éƒ¨</td>
<td>ä¿æŒç”¨æˆ·ä¸»é¢˜åå¥½</td>
</tr>
<tr>
<td><code>@biya/wallet</code></td>
<td>âœ… éƒ¨åˆ†</td>
<td>ä¿å­˜åœ°å€ï¼Œä¸ä¿å­˜ä½™é¢</td>
</tr>
<tr>
<td><code>@biya/auth</code></td>
<td>âœ… éƒ¨åˆ†</td>
<td>ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œ Token</td>
</tr>
<tr>
<td><code>bridge-store</code></td>
<td>âŒ æ— </td>
<td>äº¤æ˜“å†å²ä¸éœ€è¦æŒä¹…åŒ–</td>
</tr>
<tr>
<td><code>dex-store</code></td>
<td>âŒ æ— </td>
<td>è®¢å•æ•°æ®å®æ—¶è·å–</td>
</tr>
<tr>
<td><code>helix-store</code></td>
<td>âœ… å…¨éƒ¨</td>
<td>ä¿å­˜ç”¨æˆ·åå¥½</td>
</tr>
</tbody></table>
<hr>
<h3 id="3-è‡ªå®šä¹‰å­˜å‚¨">3. è‡ªå®šä¹‰å­˜å‚¨</h3>
<pre><code class="language-typescript">// ä½¿ç”¨ sessionStorage
import { persist, createJSONStorage } from &#39;zustand/middleware&#39;

<p>export const useSessionStore = create&lt;State&gt;()(<br>  persist(<br>    (set) =&gt; ({ /* ... */ }),<br>    {<br>      name: &#39;session-storage&#39;,<br>      storage: createJSONStorage(() =&gt; sessionStorage),<br>    }<br>  )<br>)</p>
<p>// ä½¿ç”¨ IndexedDBï¼ˆå¤§æ•°æ®ï¼‰<br>import { persist } from &#39;zustand/middleware&#39;<br>import { get, set, del } from &#39;idb-keyval&#39;</p>
<p>export const useIndexedDBStore = create&lt;State&gt;()(<br>  persist(<br>    (set) =&gt; ({ /* ... */ }),<br>    {<br>      name: &#39;indexed-db-storage&#39;,<br>      storage: {<br>        getItem: async (name) =&gt; {<br>          return (await get(name)) || null<br>        },<br>        setItem: async (name, value) =&gt; {<br>          await set(name, value)<br>        },<br>        removeItem: async (name) =&gt; {<br>          await del(name)<br>        },<br>      },<br>    }<br>  )<br>)<br></code></pre></p>
<hr>
<h2 id="æ€§èƒ½ä¼˜åŒ–">âš¡ æ€§èƒ½ä¼˜åŒ–</h2>
<h3 id="1-ä½¿ç”¨é€‰æ‹©å™¨">1. ä½¿ç”¨é€‰æ‹©å™¨</h3>
<pre><code class="language-typescript">// âŒ ä¸å¥½ï¼šç»„ä»¶ä¼šåœ¨ä»»ä½•çŠ¶æ€å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
function Component() {
  const store = useWalletStore()
  return &lt;div&gt;{store.address}&lt;/div&gt;
}

<p>// âœ… å¥½ï¼šåªåœ¨ address å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“<br>function Component() {<br>  const address = useWalletStore((state) =&gt; state.address)<br>  return &lt;div&gt;{address}&lt;/div&gt;<br>}</p>
<p>// âœ… æ›´å¥½ï¼šä½¿ç”¨å¯¼å‡ºçš„é€‰æ‹©å™¨<br>import { useWalletStore, selectAddress } from &#39;@biya/wallet&#39;</p>
<p>function Component() {<br>  const address = useWalletStore(selectAddress)<br>  return &lt;div&gt;{address}&lt;/div&gt;<br>}<br></code></pre></p>
<hr>
<h3 id="2-ç»„åˆå¤šä¸ªé€‰æ‹©å™¨">2. ç»„åˆå¤šä¸ªé€‰æ‹©å™¨</h3>
<pre><code class="language-typescript">// âŒ ä¸å¥½ï¼šå¤šæ¬¡è®¢é˜…
function Component() {
  const address = useWalletStore((state) =&gt; state.address)
  const balance = useWalletStore((state) =&gt; state.balance)
  const isConnected = useWalletStore((state) =&gt; state.isConnected)
  // ...
}

<p>// âœ… å¥½ï¼šä½¿ç”¨ shallow æ¯”è¾ƒ<br>import { shallow } from &#39;zustand/shallow&#39;</p>
<p>function Component() {<br>  const { address, balance, isConnected } = useWalletStore(<br>    (state) =&gt; ({<br>      address: state.address,<br>      balance: state.balance,<br>      isConnected: state.isConnected,<br>    }),<br>    shallow<br>  )<br>  // ...<br>}<br></code></pre></p>
<hr>
<h3 id="3-é¿å…å†…è”é€‰æ‹©å™¨">3. é¿å…å†…è”é€‰æ‹©å™¨</h3>
<pre><code class="language-typescript">// âŒ ä¸å¥½ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
function Component() {
  const user = useAuthStore((state) =&gt; state.user)
  // ...
}

<p>// âœ… å¥½ï¼šåœ¨ç»„ä»¶å¤–å®šä¹‰é€‰æ‹©å™¨<br>const selectUser = (state: AuthState) =&gt; state.user</p>
<p>function Component() {<br>  const user = useAuthStore(selectUser)<br>  // ...<br>}<br></code></pre></p>
<hr>
<h3 id="4-ä½¿ç”¨-useshallow-hook">4. ä½¿ç”¨ useShallow Hook</h3>
<pre><code class="language-typescript">// Zustand v4.4.0+ æä¾›çš„æ–° Hook
import { useShallow } from &#39;zustand/react/shallow&#39;

<p>function Component() {<br>  const { address, balance, isConnected } = useWalletStore(<br>    useShallow((state) =&gt; ({<br>      address: state.address,<br>      balance: state.balance,<br>      isConnected: state.isConnected,<br>    }))<br>  )<br>  // ...<br>}<br></code></pre></p>
<hr>
<h2 id="æœ€ä½³å®è·µ">ğŸ“‹ æœ€ä½³å®è·µ</h2>
<h3 id="1-çŠ¶æ€åˆ†å±‚åŸåˆ™">1. çŠ¶æ€åˆ†å±‚åŸåˆ™</h3>
<pre><code class="language-typescript">// âœ… å…±äº«çŠ¶æ€ï¼šæ”¾åœ¨ packages/*/store/
// - ä¸»é¢˜ã€é’±åŒ…ã€è®¤è¯ç­‰è·¨åº”ç”¨çŠ¶æ€

<p>// âœ… åº”ç”¨çŠ¶æ€ï¼šæ”¾åœ¨ apps/*/store/<br>// - åº”ç”¨ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘å’Œ UI çŠ¶æ€</p>
<p>// âŒ é¿å…ï¼šåœ¨åº”ç”¨ä¸­åˆ›å»ºå…±äº«çŠ¶æ€<br>// âŒ é¿å…ï¼šåœ¨å…±äº«åŒ…ä¸­åˆ›å»ºåº”ç”¨ç‰¹å®šçŠ¶æ€<br></code></pre></p>
<hr>
<h3 id="2-å•ä¸€èŒè´£">2. å•ä¸€èŒè´£</h3>
<pre><code class="language-typescript">// âœ… å¥½ï¼šæ¯ä¸ª Store åªç®¡ç†ä¸€ç±»çŠ¶æ€
const useThemeStore = create(/* åªç®¡ç†ä¸»é¢˜ */)
const useWalletStore = create(/* åªç®¡ç†é’±åŒ… */)
const useAuthStore = create(/* åªç®¡ç†è®¤è¯ */)

<p>// âŒ ä¸å¥½ï¼šä¸€ä¸ª Store ç®¡ç†æ‰€æœ‰çŠ¶æ€<br>const useGlobalStore = create(/* ä¸»é¢˜ã€é’±åŒ…ã€è®¤è¯å…¨åœ¨è¿™é‡Œ */)<br></code></pre></p>
<hr>
<h3 id="3-ç±»å‹å®‰å…¨">3. ç±»å‹å®‰å…¨</h3>
<pre><code class="language-typescript">// âœ… å§‹ç»ˆå®šä¹‰ TypeScript æ¥å£
interface WalletState {
  address: string | null
  isConnected: boolean
  connect: () =&gt; Promise&lt;void&gt;
  disconnect: () =&gt; void
}

<p>export const useWalletStore = create&lt;WalletState&gt;()(/* ... */)<br></code></pre></p>
<hr>
<h3 id="4-å¯¼å‡ºé€‰æ‹©å™¨">4. å¯¼å‡ºé€‰æ‹©å™¨</h3>
<pre><code class="language-typescript">// store/wallet-store.ts
export const useWalletStore = create&lt;WalletState&gt;()(/* ... */)

<p>// å¯¼å‡ºå¸¸ç”¨é€‰æ‹©å™¨<br>export const selectAddress = (state: WalletState) =&gt; state.address<br>export const selectIsConnected = (state: WalletState) =&gt; state.isConnected<br>export const selectBalance = (state: WalletState) =&gt; state.balance</p>
<p>// ä½¿ç”¨æ—¶<br>import { useWalletStore, selectAddress } from &#39;@biya/wallet&#39;<br>const address = useWalletStore(selectAddress)<br></code></pre></p>
<hr>
<h3 id="5-actions-å‘½åçº¦å®š">5. Actions å‘½åçº¦å®š</h3>
<pre><code class="language-typescript">interface State {
  // çŠ¶æ€ï¼šåè¯
  user: User | null
  isLoading: boolean
  
<p>  // è®¾ç½®å™¨ï¼šsetXxx<br>  setUser: (user: User | null) =&gt; void<br>  setLoading: (loading: boolean) =&gt; void</p>
<p>  // åˆ‡æ¢å™¨ï¼štoggleXxx<br>  toggleSidebar: () =&gt; void</p>
<p>  // å¼‚æ­¥æ“ä½œï¼šåŠ¨è¯<br>  login: (email: string, password: string) =&gt; Promise&lt;void&gt;<br>  logout: () =&gt; void</p>
<p>  // é‡ç½®ï¼šreset<br>  reset: () =&gt; void<br>}<br></code></pre></p>
<hr>
<h3 id="6-é”™è¯¯å¤„ç†">6. é”™è¯¯å¤„ç†</h3>
<pre><code class="language-typescript">export const useAuthStore = create&lt;AuthState&gt;((set) =&gt; ({
  login: async (email, password) =&gt; {
    set({ isLoading: true, error: null })
    try {
      const response = await authService.login(email, password)
      set({ user: response.user, isAuthenticated: true })
    } catch (error) {
      set({ error: error instanceof Error ? error.message : &#39;Login failed&#39; })
      throw error
    } finally {
      set({ isLoading: false })
    }
  },
}))
</code></pre>
<hr>
<h3 id="7-devtools-é›†æˆ">7. DevTools é›†æˆ</h3>
<pre><code class="language-typescript">import { create } from &#39;zustand&#39;
import { devtools } from &#39;zustand/middleware&#39;

<p>export const useWalletStore = create&lt;WalletState&gt;()(<br>  devtools(<br>    (set) =&gt; ({ /* ... */ }),<br>    { name: &#39;WalletStore&#39; }<br>  )<br>)</p>
<p>// åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ Redux DevTools Extension æŸ¥çœ‹çŠ¶æ€å˜åŒ–<br></code></pre></p>
<hr>
<h2 id="ä¸‹ä¸€æ­¥">ğŸš€ ä¸‹ä¸€æ­¥</h2>
<p>çŠ¶æ€ç®¡ç†ç­–ç•¥å·²æ˜ç¡®ï¼Œç»§ç»­é˜…è¯»ï¼š</p>
<p><strong>â†’ <a href="./06-%E5%AE%9E%E6%96%BD%E6%AD%A5%E9%AA%A4.md">06-å®æ–½æ­¥éª¤.md</a></strong></p>
<p>äº†è§£å¦‚ä½•ä¸€æ­¥æ­¥å°† <code>biya-helix-app</code> è¿ç§»åˆ° Monorepoã€‚</p>
<hr>
<h2 id="æœ¬ç« å°ç»“">ğŸ“š æœ¬ç« å°ç»“</h2>
<h3 id="çŠ¶æ€åˆ†å±‚">çŠ¶æ€åˆ†å±‚</h3>
<ol>
<li><p><strong>å…±äº«çŠ¶æ€</strong>ï¼ˆpackages/*/store/ï¼‰</p>
<ul>
<li><code>@biya/theme</code>: ä¸»é¢˜é…ç½®</li>
<li><code>@biya/wallet</code>: é’±åŒ…è¿æ¥</li>
<li><code>@biya/auth</code>: ç”¨æˆ·è®¤è¯</li>
</ul>
</li>
<li><p><strong>åº”ç”¨çŠ¶æ€</strong>ï¼ˆapps/*/store/ï¼‰</p>
<ul>
<li><code>bridge-store</code>: äº¤æ˜“å†å²ã€è¡¨å•çŠ¶æ€</li>
<li><code>dex-store</code>: è®¢å•ç°¿ã€ç”¨æˆ·è®¢å•</li>
<li><code>helix-store</code>: ç”¨æˆ·åå¥½ã€UI çŠ¶æ€</li>
</ul>
</li>
</ol>
<h3 id="æ ¸å¿ƒåŸåˆ™">æ ¸å¿ƒåŸåˆ™</h3>
<ol>
<li><strong>å•ä¸€èŒè´£</strong>: æ¯ä¸ª Store åªç®¡ç†ä¸€ç±»çŠ¶æ€</li>
<li><strong>ç±»å‹å®‰å…¨</strong>: ä½¿ç”¨ TypeScript æ¥å£</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: ä½¿ç”¨é€‰æ‹©å™¨å’Œ shallow æ¯”è¾ƒ</li>
<li><strong>æŒä¹…åŒ–</strong>: åªæŒä¹…åŒ–å¿…è¦çš„çŠ¶æ€</li>
<li><strong>å¯æµ‹è¯•</strong>: Actions æ˜¯çº¯å‡½æ•°</li>
</ol>
<hr>
<p><em>æœ€åæ›´æ–°: 2025-10-31</em></p>

</div>
</body>
</html>
</div>
</body>
</html>