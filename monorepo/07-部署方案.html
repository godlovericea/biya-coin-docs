<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07-éƒ¨ç½²æ–¹æ¡ˆ</title>
    <link rel="stylesheet" href="../md2html/style.css">
</head>
<body>
<nav class="table-of-contents">
  <h2 class="toc-title">ğŸ“‘ ç›®å½•</h2>
  <ul class="toc-list">
    <li class="toc-item toc-level-1">
      <a href="#éƒ¨ç½²æ–¹æ¡ˆ" class="toc-link">ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ</a>
    <li class="toc-item toc-level-2">
      <a href="#ç›®å½•" class="toc-link">ğŸ“– ç›®å½•</a>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ" class="toc-link">ğŸ¯ éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ</a>
    <li class="toc-item toc-level-3">
      <a href="#ç‹¬ç«‹éƒ¨ç½²åŸåˆ™" class="toc-link">ç‹¬ç«‹éƒ¨ç½²åŸåˆ™</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”" class="toc-link">éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#vercel-éƒ¨ç½²" class="toc-link">â˜ï¸ Vercel éƒ¨ç½²</a>
    <li class="toc-item toc-level-3">
      <a href="#æ–¹æ¡ˆ-1-æ‰‹åŠ¨éƒ¨ç½²-æ¨èç”¨äºæµ‹è¯•" class="toc-link">æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰</a>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-1-å®‰è£…-vercel-cli" class="toc-link">æ­¥éª¤ 1ï¼šå®‰è£… Vercel CLI</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-2-éƒ¨ç½²-helix-åº”ç”¨" class="toc-link">æ­¥éª¤ 2ï¼šéƒ¨ç½² Helix åº”ç”¨</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-3-éƒ¨ç½²-bridge-åº”ç”¨" class="toc-link">æ­¥éª¤ 3ï¼šéƒ¨ç½² Bridge åº”ç”¨</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ–¹æ¡ˆ-2-é€šè¿‡-vercel-dashboard-éƒ¨ç½²-æ¨èç”¨äºç”Ÿäº§" class="toc-link">æ–¹æ¡ˆ 2ï¼šé€šè¿‡ Vercel Dashboard éƒ¨ç½²ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰</a>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-1-å¯¼å…¥é¡¹ç›®" class="toc-link">æ­¥éª¤ 1ï¼šå¯¼å…¥é¡¹ç›®</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-2-é…ç½®-helix-é¡¹ç›®" class="toc-link">æ­¥éª¤ 2ï¼šé…ç½® Helix é¡¹ç›®</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#æ­¥éª¤-3-é…ç½®-bridge-é¡¹ç›®" class="toc-link">æ­¥éª¤ 3ï¼šé…ç½® Bridge é¡¹ç›®</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-4-åˆ›å»ºæ¡ä»¶æ„å»ºè„šæœ¬" class="toc-link">æ­¥éª¤ 4ï¼šåˆ›å»ºæ¡ä»¶æ„å»ºè„šæœ¬</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-5-é…ç½®åŸŸå" class="toc-link">æ­¥éª¤ 5ï¼šé…ç½®åŸŸå</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-6-é…ç½®ç¯å¢ƒå˜é‡" class="toc-link">æ­¥éª¤ 6ï¼šé…ç½®ç¯å¢ƒå˜é‡</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²" class="toc-link">ğŸ–¥ï¸ è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²</a>
    <li class="toc-item toc-level-3">
      <a href="#æ–¹æ¡ˆ-docker-nginx-pm2" class="toc-link">æ–¹æ¡ˆï¼šDocker + Nginx + PM2</a>
    <li class="toc-item toc-level-4">
      <a href="#æ¶æ„å›¾" class="toc-link">æ¶æ„å›¾</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-1-å‡†å¤‡æœåŠ¡å™¨" class="toc-link">æ­¥éª¤ 1ï¼šå‡†å¤‡æœåŠ¡å™¨</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-2-å…‹éš†å’Œæ„å»ºé¡¹ç›®" class="toc-link">æ­¥éª¤ 2ï¼šå…‹éš†å’Œæ„å»ºé¡¹ç›®</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-3-é…ç½®-pm2" class="toc-link">æ­¥éª¤ 3ï¼šé…ç½® PM2</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-4-é…ç½®-nginx" class="toc-link">æ­¥éª¤ 4ï¼šé…ç½® Nginx</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-5-é…ç½®-ssl-let-s-encrypt" class="toc-link">æ­¥éª¤ 5ï¼šé…ç½® SSLï¼ˆLet&#39;s Encryptï¼‰</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-6-é…ç½®é˜²ç«å¢™" class="toc-link">æ­¥éª¤ 6ï¼šé…ç½®é˜²ç«å¢™</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#ci-cd-é…ç½®" class="toc-link">ğŸ”„ CI/CD é…ç½®</a>
    <li class="toc-item toc-level-3">
      <a href="#github-actions" class="toc-link">GitHub Actions</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#gitlab-ci-cd" class="toc-link">GitLab CI/CD</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#ç¯å¢ƒå˜é‡ç®¡ç†" class="toc-link">ğŸ” ç¯å¢ƒå˜é‡ç®¡ç†</a>
    <li class="toc-item toc-level-3">
      <a href="#å¼€å‘ç¯å¢ƒ" class="toc-link">å¼€å‘ç¯å¢ƒ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#ç”Ÿäº§ç¯å¢ƒ" class="toc-link">ç”Ÿäº§ç¯å¢ƒ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ" class="toc-link">ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æ€§èƒ½ä¼˜åŒ–" class="toc-link">âš¡ æ€§èƒ½ä¼˜åŒ–</a>
    <li class="toc-item toc-level-3">
      <a href="#1-æ„å»ºä¼˜åŒ–" class="toc-link">1. æ„å»ºä¼˜åŒ–</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#2-ç¼“å­˜ç­–ç•¥" class="toc-link">2. ç¼“å­˜ç­–ç•¥</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#3-cdn-é…ç½®" class="toc-link">3. CDN é…ç½®</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#4-ç›‘æ§å’Œåˆ†æ" class="toc-link">4. ç›‘æ§å’Œåˆ†æ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#éƒ¨ç½²æ¸…å•" class="toc-link">ğŸ“‹ éƒ¨ç½²æ¸…å•</a>
    <li class="toc-item toc-level-3">
      <a href="#vercel-éƒ¨ç½²æ¸…å•" class="toc-link">Vercel éƒ¨ç½²æ¸…å•</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#è‡ªå»ºæœåŠ¡å™¨æ¸…å•" class="toc-link">è‡ªå»ºæœåŠ¡å™¨æ¸…å•</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#ä¸‹ä¸€æ­¥" class="toc-link">ğŸš€ ä¸‹ä¸€æ­¥</a>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æœ¬ç« å°ç»“" class="toc-link">ğŸ“š æœ¬ç« å°ç»“</a>
    <li class="toc-item toc-level-3">
      <a href="#éƒ¨ç½²é€‰é¡¹" class="toc-link">éƒ¨ç½²é€‰é¡¹</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#å…³é”®é…ç½®" class="toc-link">å…³é”®é…ç½®</a>
    </ul>
  </li>
    </ul>
  </li>
  </li>
  </ul>
</nav>

<div class="content">
<h1 id="éƒ¨ç½²æ–¹æ¡ˆ">ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ</h1>
<blockquote>
<p><strong>æ ¸å¿ƒå†…å®¹</strong>: Monorepo åº”ç”¨çš„éƒ¨ç½²ç­–ç•¥å’Œé…ç½®<br><strong>ç›®æ ‡</strong>: å®ç°ç‹¬ç«‹ã€é«˜æ•ˆã€å¯é çš„åº”ç”¨éƒ¨ç½²<br><strong>æ›´æ–°æ—¶é—´</strong>: 2025-10-31</p>
</blockquote>
<hr>
<h2 id="ç›®å½•">ğŸ“– ç›®å½•</h2>
<ol>
<li><a href="#%E9%83%A8%E7%BD%B2%E7%AD%96%E7%95%A5%E6%A6%82%E8%A7%88">éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ</a></li>
<li><a href="#vercel-%E9%83%A8%E7%BD%B2">Vercel éƒ¨ç½²</a></li>
<li><a href="#%E8%87%AA%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2">è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²</a></li>
<li><a href="#cicd-%E9%85%8D%E7%BD%AE">CI/CD é…ç½®</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%AE%A1%E7%90%86">ç¯å¢ƒå˜é‡ç®¡ç†</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">æ€§èƒ½ä¼˜åŒ–</a></li>
</ol>
<hr>
<h2 id="éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ">ğŸ¯ éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ</h2>
<h3 id="ç‹¬ç«‹éƒ¨ç½²åŸåˆ™">ç‹¬ç«‹éƒ¨ç½²åŸåˆ™</h3>
<pre><code>Monorepo å•ä»“åº“
â”œâ”€â”€ apps/helix       â†’ Vercel Project 1 (helix.biya.com)
â”œâ”€â”€ apps/bridge      â†’ Vercel Project 2 (bridge.biya.com)
â””â”€â”€ apps/dex         â†’ Vercel Project 3 (dex.biya.com)

âœ… ä¸€ä¸ª Git ä»“åº“
âœ… å¤šä¸ª Vercel é¡¹ç›®
âœ… ç‹¬ç«‹åŸŸå
âœ… ç‹¬ç«‹æ„å»ºå’Œéƒ¨ç½²
</code></pre>
<hr>
<h3 id="éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”">éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Vercel</th>
<th>è‡ªå»ºæœåŠ¡å™¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>è®¾ç½®éš¾åº¦</strong></td>
<td>â­ ç®€å•</td>
<td>â­â­â­ å¤æ‚</td>
</tr>
<tr>
<td><strong>ç»´æŠ¤æˆæœ¬</strong></td>
<td>â­ ä½</td>
<td>â­â­â­ é«˜</td>
</tr>
<tr>
<td><strong>éƒ¨ç½²é€Ÿåº¦</strong></td>
<td>â­â­â­ å¿«</td>
<td>â­â­ ä¸­ç­‰</td>
</tr>
<tr>
<td><strong>æ€§èƒ½</strong></td>
<td>â­â­â­ ä¼˜ç§€</td>
<td>â­â­ å–å†³äºé…ç½®</td>
</tr>
<tr>
<td><strong>æˆæœ¬ï¼ˆå°è§„æ¨¡ï¼‰</strong></td>
<td>â­â­â­ å…è´¹</td>
<td>â­â­ æœåŠ¡å™¨è´¹ç”¨</td>
</tr>
<tr>
<td><strong>æˆæœ¬ï¼ˆå¤§è§„æ¨¡ï¼‰</strong></td>
<td>â­â­ æŒ‰é‡ä»˜è´¹</td>
<td>â­â­â­ å›ºå®šæˆæœ¬</td>
</tr>
<tr>
<td><strong>çµæ´»æ€§</strong></td>
<td>â­â­ ä¸­ç­‰</td>
<td>â­â­â­ å®Œå…¨æ§åˆ¶</td>
</tr>
<tr>
<td><strong>æ¨èåº¦</strong></td>
<td>â­â­â­â­â­</td>
<td>â­â­â­</td>
</tr>
</tbody></table>
<hr>
<h2 id="vercel-éƒ¨ç½²">â˜ï¸ Vercel éƒ¨ç½²</h2>
<h3 id="æ–¹æ¡ˆ-1-æ‰‹åŠ¨éƒ¨ç½²-æ¨èç”¨äºæµ‹è¯•">æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰</h3>
<h4 id="æ­¥éª¤-1-å®‰è£…-vercel-cli">æ­¥éª¤ 1ï¼šå®‰è£… Vercel CLI</h4>
<pre><code class="language-bash">npm install -g vercel
</code></pre>
<hr>
<h4 id="æ­¥éª¤-2-éƒ¨ç½²-helix-åº”ç”¨">æ­¥éª¤ 2ï¼šéƒ¨ç½² Helix åº”ç”¨</h4>
<pre><code class="language-bash">cd D:\rwa\biya-coin\apps\helix

# ç™»å½• Vercel
vercel login

# é¦–æ¬¡éƒ¨ç½²ï¼ˆä¼šåˆ›å»ºé¡¹ç›®ï¼‰
vercel

# ç”Ÿäº§éƒ¨ç½²
vercel --prod
</code></pre>
<p><strong>é…ç½®é€‰é¡¹</strong>:</p>
<ul>
<li><strong>Set up and deploy</strong>: Yes</li>
<li><strong>Which scope</strong>: é€‰æ‹©ä½ çš„å›¢é˜Ÿæˆ–ä¸ªäººè´¦å·</li>
<li><strong>Link to existing project</strong>: No</li>
<li><strong>Project name</strong>: biya-helix</li>
<li><strong>Directory</strong>: <code>apps/helix</code> æˆ– <code>./</code>ï¼ˆå¦‚æœå·²åœ¨è¯¥ç›®å½•ï¼‰</li>
<li><strong>Override settings</strong>: Yes<ul>
<li><strong>Build Command</strong>: <code>cd ../.. &amp;&amp; npm install &amp;&amp; npm run build:helix</code></li>
<li><strong>Output Directory</strong>: <code>.next</code></li>
<li><strong>Development Command</strong>: <code>npm run dev</code></li>
</ul>
</li>
</ul>
<hr>
<h4 id="æ­¥éª¤-3-éƒ¨ç½²-bridge-åº”ç”¨">æ­¥éª¤ 3ï¼šéƒ¨ç½² Bridge åº”ç”¨</h4>
<pre><code class="language-bash">cd D:\rwa\biya-coin\apps\bridge

# éƒ¨ç½²
vercel

# ç”Ÿäº§éƒ¨ç½²
vercel --prod
</code></pre>
<p><strong>é…ç½®é€‰é¡¹</strong>ï¼ˆåŒä¸Šï¼Œé¡¹ç›®åæ”¹ä¸º <code>biya-bridge</code>ï¼‰</p>
<hr>
<h3 id="æ–¹æ¡ˆ-2-é€šè¿‡-vercel-dashboard-éƒ¨ç½²-æ¨èç”¨äºç”Ÿäº§">æ–¹æ¡ˆ 2ï¼šé€šè¿‡ Vercel Dashboard éƒ¨ç½²ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰</h3>
<h4 id="æ­¥éª¤-1-å¯¼å…¥é¡¹ç›®">æ­¥éª¤ 1ï¼šå¯¼å…¥é¡¹ç›®</h4>
<ol>
<li>è®¿é—® <a href="https://vercel.com/new">Vercel Dashboard</a></li>
<li>ç‚¹å‡» <strong>Add New</strong> â†’ <strong>Project</strong></li>
<li>å¯¼å…¥ä½ çš„ Git ä»“åº“ï¼ˆGitHub/GitLab/Bitbucketï¼‰</li>
</ol>
<hr>
<h4 id="æ­¥éª¤-2-é…ç½®-helix-é¡¹ç›®">æ­¥éª¤ 2ï¼šé…ç½® Helix é¡¹ç›®</h4>
<p><strong>General Settings</strong>:</p>
<ul>
<li><strong>Project Name</strong>: <code>biya-helix</code></li>
<li><strong>Framework Preset</strong>: <code>Next.js</code></li>
<li><strong>Root Directory</strong>: <code>apps/helix</code></li>
</ul>
<p><strong>Build &amp; Development Settings</strong>:</p>
<ul>
<li><strong>Build Command</strong>: <code>cd ../.. &amp;&amp; npm install &amp;&amp; npm run build:helix</code></li>
<li><strong>Output Directory</strong>: <code>.next</code></li>
<li><strong>Install Command</strong>: <code>npm install</code></li>
<li><strong>Development Command</strong>: <code>npm run dev</code></li>
</ul>
<p><strong>Environment Variables</strong>:</p>
<pre><code>NEXT_PUBLIC_API_URL=https://api.biya.com
NEXT_PUBLIC_SITE_URL=https://helix.biya.com
</code></pre>
<p><strong>Ignored Build Step</strong>:</p>
<pre><code class="language-bash">node ../../scripts/vercel-ignore-helix.js
</code></pre>
<hr>
<h4 id="æ­¥éª¤-3-é…ç½®-bridge-é¡¹ç›®">æ­¥éª¤ 3ï¼šé…ç½® Bridge é¡¹ç›®</h4>
<p>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä½†ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š</p>
<p><strong>General Settings</strong>:</p>
<ul>
<li><strong>Project Name</strong>: <code>biya-bridge</code></li>
<li><strong>Root Directory</strong>: <code>apps/bridge</code></li>
</ul>
<p><strong>Build Command</strong>:</p>
<pre><code class="language-bash">cd ../.. &amp;&amp; npm install &amp;&amp; npm run build:bridge
</code></pre>
<p><strong>Environment Variables</strong>:</p>
<pre><code>NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=your_project_id
NEXT_PUBLIC_ALCHEMY_KEY=your_alchemy_key
NEXT_PUBLIC_ETHEREUM_CHAIN_ID=1
NEXT_PUBLIC_INJECTIVE_CHAIN_ID=injective-1
</code></pre>
<p><strong>Ignored Build Step</strong>:</p>
<pre><code class="language-bash">node ../../scripts/vercel-ignore-bridge.js
</code></pre>
<hr>
<h3 id="æ­¥éª¤-4-åˆ›å»ºæ¡ä»¶æ„å»ºè„šæœ¬">æ­¥éª¤ 4ï¼šåˆ›å»ºæ¡ä»¶æ„å»ºè„šæœ¬</h3>
<p><strong>scripts/vercel-ignore-helix.js</strong>:</p>
<pre><code class="language-javascript">#!/usr/bin/env node

const { execSync } = require(&#39;child_process&#39;)

try {
  // è·å–å˜æ›´çš„æ–‡ä»¶
  const diff = execSync(&#39;git diff HEAD^ HEAD --name-only&#39;).toString().trim()
  
  if (!diff) {
    console.log(&#39;No changes detected&#39;)
    process.exit(0)
  }
  
  const changedFiles = diff.split(&#39;\n&#39;)
  
  // æ£€æŸ¥æ˜¯å¦éœ€è¦æ„å»º
  const shouldBuild = changedFiles.some(file =&gt; 
    file.startsWith(&#39;apps/helix/&#39;) || 
    file.startsWith(&#39;packages/shared/&#39;) ||
    file.startsWith(&#39;packages/theme/&#39;) ||
    file.startsWith(&#39;packages/i18n/&#39;)
  )
  
  if (shouldBuild) {
    console.log(&#39;âœ… Changes detected in Helix or shared packages - Building&#39;)
    process.exit(1) // è¿”å› 1 è¡¨ç¤ºéœ€è¦æ„å»º
  } else {
    console.log(&#39;â­ï¸  No relevant changes - Skipping build&#39;)
    process.exit(0) // è¿”å› 0 è¡¨ç¤ºè·³è¿‡æ„å»º
  }
} catch (error) {
  console.error(&#39;Error checking git diff:&#39;, error.message)
  // å‡ºé”™æ—¶é»˜è®¤æ„å»º
  process.exit(1)
}
</code></pre>
<p><strong>scripts/vercel-ignore-bridge.js</strong>:</p>
<pre><code class="language-javascript">#!/usr/bin/env node

const { execSync } = require(&#39;child_process&#39;)

try {
  const diff = execSync(&#39;git diff HEAD^ HEAD --name-only&#39;).toString().trim()
  
  if (!diff) {
    console.log(&#39;No changes detected&#39;)
    process.exit(0)
  }
  
  const changedFiles = diff.split(&#39;\n&#39;)
  
  const shouldBuild = changedFiles.some(file =&gt; 
    file.startsWith(&#39;apps/bridge/&#39;) || 
    file.startsWith(&#39;packages/shared/&#39;) ||
    file.startsWith(&#39;packages/theme/&#39;) ||
    file.startsWith(&#39;packages/i18n/&#39;) ||
    file.startsWith(&#39;packages/wallet/&#39;)
  )
  
  if (shouldBuild) {
    console.log(&#39;âœ… Changes detected in Bridge or shared packages - Building&#39;)
    process.exit(1)
  } else {
    console.log(&#39;â­ï¸  No relevant changes - Skipping build&#39;)
    process.exit(0)
  }
} catch (error) {
  console.error(&#39;Error checking git diff:&#39;, error.message)
  process.exit(1)
}
</code></pre>
<p><strong>åˆ«å¿˜äº†æ·»åŠ æ‰§è¡Œæƒé™</strong>:</p>
<pre><code class="language-bash">chmod +x scripts/vercel-ignore-helix.js
chmod +x scripts/vercel-ignore-bridge.js
</code></pre>
<hr>
<h3 id="æ­¥éª¤-5-é…ç½®åŸŸå">æ­¥éª¤ 5ï¼šé…ç½®åŸŸå</h3>
<p>åœ¨ Vercel Dashboard ä¸­ï¼š</p>
<ol>
<li>è¿›å…¥é¡¹ç›® â†’ <strong>Settings</strong> â†’ <strong>Domains</strong></li>
<li>æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼š<ul>
<li>Helix: <code>helix.biya.com</code></li>
<li>Bridge: <code>bridge.biya.com</code></li>
</ul>
</li>
<li>æŒ‰ç…§æç¤ºé…ç½® DNSï¼ˆCNAME æˆ– A è®°å½•ï¼‰</li>
</ol>
<hr>
<h3 id="æ­¥éª¤-6-é…ç½®ç¯å¢ƒå˜é‡">æ­¥éª¤ 6ï¼šé…ç½®ç¯å¢ƒå˜é‡</h3>
<p>åœ¨ Vercel Dashboard ä¸­ï¼š</p>
<ol>
<li>è¿›å…¥é¡¹ç›® â†’ <strong>Settings</strong> â†’ <strong>Environment Variables</strong></li>
<li>æ·»åŠ å˜é‡ï¼ˆæ³¨æ„é€‰æ‹©ç¯å¢ƒï¼šProduction/Preview/Developmentï¼‰</li>
</ol>
<p><strong>Helix ç¯å¢ƒå˜é‡</strong>:</p>
<pre><code>NEXT_PUBLIC_API_URL
NEXT_PUBLIC_SITE_URL
</code></pre>
<p><strong>Bridge ç¯å¢ƒå˜é‡</strong>:</p>
<pre><code>NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID
NEXT_PUBLIC_ALCHEMY_KEY
NEXT_PUBLIC_ETHEREUM_CHAIN_ID
NEXT_PUBLIC_INJECTIVE_CHAIN_ID
NEXT_PUBLIC_NETWORK
</code></pre>
<hr>
<h2 id="è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²">ğŸ–¥ï¸ è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½²</h2>
<h3 id="æ–¹æ¡ˆ-docker-nginx-pm2">æ–¹æ¡ˆï¼šDocker + Nginx + PM2</h3>
<h4 id="æ¶æ„å›¾">æ¶æ„å›¾</h4>
<pre><code>Internet
    â†“
[Nginx] (åå‘ä»£ç†)
    â”œâ”€â†’ helix.biya.com:3000 (Helix App)
    â”œâ”€â†’ bridge.biya.com:3001 (Bridge App)
    â””â”€â†’ dex.biya.com:3002 (DEX App)
</code></pre>
<hr>
<h3 id="æ­¥éª¤-1-å‡†å¤‡æœåŠ¡å™¨">æ­¥éª¤ 1ï¼šå‡†å¤‡æœåŠ¡å™¨</h3>
<pre><code class="language-bash"># æ›´æ–°ç³»ç»Ÿ
sudo apt update &amp;&amp; sudo apt upgrade -y

# å®‰è£… Node.js 18+
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£… PM2
sudo npm install -g pm2

# å®‰è£… Nginx
sudo apt install -y nginx

# å®‰è£… Git
sudo apt install -y git
</code></pre>
<hr>
<h3 id="æ­¥éª¤-2-å…‹éš†å’Œæ„å»ºé¡¹ç›®">æ­¥éª¤ 2ï¼šå…‹éš†å’Œæ„å»ºé¡¹ç›®</h3>
<pre><code class="language-bash"># å…‹éš†ä»“åº“
cd /var/www
sudo git clone https://github.com/your-org/biya-coin.git
cd biya-coin

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºæ‰€æœ‰åº”ç”¨
npm run build

# æˆ–è€…åªæ„å»ºç‰¹å®šåº”ç”¨
npm run build:helix
npm run build:bridge
</code></pre>
<hr>
<h3 id="æ­¥éª¤-3-é…ç½®-pm2">æ­¥éª¤ 3ï¼šé…ç½® PM2</h3>
<p><strong>åˆ›å»º ecosystem.config.js</strong>:</p>
<pre><code class="language-javascript">module.exports = {
  apps: [
    {
      name: &#39;helix&#39;,
      cwd: &#39;/var/www/biya-coin/apps/helix&#39;,
      script: &#39;node_modules/next/dist/bin/next&#39;,
      args: &#39;start -p 3000&#39;,
      instances: 2,
      exec_mode: &#39;cluster&#39;,
      env: {
        NODE_ENV: &#39;production&#39;,
        PORT: 3000,
        NEXT_PUBLIC_API_URL: &#39;https://api.biya.com&#39;,
      },
    },
    {
      name: &#39;bridge&#39;,
      cwd: &#39;/var/www/biya-coin/apps/bridge&#39;,
      script: &#39;node_modules/next/dist/bin/next&#39;,
      args: &#39;start -p 3001&#39;,
      instances: 2,
      exec_mode: &#39;cluster&#39;,
      env: {
        NODE_ENV: &#39;production&#39;,
        PORT: 3001,
        NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID: &#39;your_id&#39;,
      },
    },
  ],
}
</code></pre>
<p><strong>å¯åŠ¨åº”ç”¨</strong>:</p>
<pre><code class="language-bash">cd /var/www/biya-coin

# å¯åŠ¨æ‰€æœ‰åº”ç”¨
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
</code></pre>
<hr>
<h3 id="æ­¥éª¤-4-é…ç½®-nginx">æ­¥éª¤ 4ï¼šé…ç½® Nginx</h3>
<p><strong>åˆ›å»º /etc/nginx/sites-available/biya-helix</strong>:</p>
<pre><code class="language-nginx">server {
    listen 80;
    server_name helix.biya.com;

    # å¼ºåˆ¶ HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name helix.biya.com;

    # SSL è¯ä¹¦ï¼ˆä½¿ç”¨ Let&#39;s Encryptï¼‰
    ssl_certificate /etc/letsencrypt/live/helix.biya.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/helix.biya.com/privkey.pem;

    # å®‰å…¨å¤´
    add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;
    add_header X-Content-Type-Options &quot;nosniff&quot; always;
    add_header X-XSS-Protection &quot;1; mode=block&quot; always;

    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &#39;upgrade&#39;;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location /_next/static {
        proxy_pass http://localhost:3000;
        add_header Cache-Control &quot;public, max-age=31536000, immutable&quot;;
    }
}
</code></pre>
<p><strong>åˆ›å»º /etc/nginx/sites-available/biya-bridge</strong>ï¼ˆç±»ä¼¼é…ç½®ï¼Œæ”¹ä¸º bridge.biya.com å’Œç«¯å£ 3001ï¼‰</p>
<p><strong>å¯ç”¨ç«™ç‚¹</strong>:</p>
<pre><code class="language-bash"># åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/biya-helix /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/biya-bridge /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
</code></pre>
<hr>
<h3 id="æ­¥éª¤-5-é…ç½®-ssl-let-s-encrypt">æ­¥éª¤ 5ï¼šé…ç½® SSLï¼ˆLet&#39;s Encryptï¼‰</h3>
<pre><code class="language-bash"># å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d helix.biya.com
sudo certbot --nginx -d bridge.biya.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
</code></pre>
<hr>
<h3 id="æ­¥éª¤-6-é…ç½®é˜²ç«å¢™">æ­¥éª¤ 6ï¼šé…ç½®é˜²ç«å¢™</h3>
<pre><code class="language-bash"># å…è®¸ HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å…è®¸ SSH
sudo ufw allow 22/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
</code></pre>
<hr>
<h2 id="ci-cd-é…ç½®">ğŸ”„ CI/CD é…ç½®</h2>
<h3 id="github-actions">GitHub Actions</h3>
<p><strong>åˆ›å»º .github/workflows/deploy-helix.yml</strong>:</p>
<pre><code class="language-yaml">name: Deploy Helix

on:
  push:
    branches:
      - main
    paths:
      - &#39;apps/helix/**&#39;
      - &#39;packages/shared/**&#39;
      - &#39;packages/theme/**&#39;
      - &#39;packages/i18n/**&#39;

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: &#39;18&#39;
          cache: &#39;npm&#39;
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build Helix
        run: npm run build:helix
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID_HELIX }}
          working-directory: ./apps/helix
          vercel-args: &#39;--prod&#39;
</code></pre>
<p><strong>åˆ›å»º .github/workflows/deploy-bridge.yml</strong>ï¼ˆç±»ä¼¼é…ç½®ï¼‰</p>
<hr>
<h3 id="gitlab-ci-cd">GitLab CI/CD</h3>
<p><strong>åˆ›å»º .gitlab-ci.yml</strong>:</p>
<pre><code class="language-yaml">stages:
  - build
  - deploy

variables:
  NODE_VERSION: &#39;18&#39;

# ç¼“å­˜ node_modules
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
    - apps/*/node_modules/

# Helix æ„å»º
build:helix:
  stage: build
  image: node:${NODE_VERSION}
  only:
    changes:
      - apps/helix/**/*
      - packages/**/*
  script:
    - npm ci
    - npm run build:helix
  artifacts:
    paths:
      - apps/helix/.next

# Helix éƒ¨ç½²
deploy:helix:
  stage: deploy
  only:
    changes:
      - apps/helix/**/*
      - packages/**/*
  dependencies:
    - build:helix
  script:
    - npm install -g vercel
    - vercel --token $VERCEL_TOKEN --prod --cwd apps/helix

# Bridge æ„å»ºå’Œéƒ¨ç½²ï¼ˆç±»ä¼¼é…ç½®ï¼‰
</code></pre>
<hr>
<h2 id="ç¯å¢ƒå˜é‡ç®¡ç†">ğŸ” ç¯å¢ƒå˜é‡ç®¡ç†</h2>
<h3 id="å¼€å‘ç¯å¢ƒ">å¼€å‘ç¯å¢ƒ</h3>
<p><strong>apps/helix/.env.local</strong>:</p>
<pre><code class="language-bash">NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_SITE_URL=http://localhost:3000
</code></pre>
<p><strong>apps/bridge/.env.local</strong>:</p>
<pre><code class="language-bash">NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=dev_project_id
NEXT_PUBLIC_ALCHEMY_KEY=dev_alchemy_key
NEXT_PUBLIC_ETHEREUM_CHAIN_ID=11155111  # Sepolia
NEXT_PUBLIC_INJECTIVE_CHAIN_ID=injective-888
</code></pre>
<hr>
<h3 id="ç”Ÿäº§ç¯å¢ƒ">ç”Ÿäº§ç¯å¢ƒ</h3>
<p><strong>æ–¹å¼ 1ï¼šVercel Dashboard</strong></p>
<ul>
<li>Settings â†’ Environment Variables â†’ Add</li>
</ul>
<p><strong>æ–¹å¼ 2ï¼šVercel CLI</strong></p>
<pre><code class="language-bash">vercel env add NEXT_PUBLIC_API_URL production
vercel env add NEXT_PUBLIC_SITE_URL production
</code></pre>
<p><strong>æ–¹å¼ 3ï¼šè‡ªå»ºæœåŠ¡å™¨ï¼ˆä½¿ç”¨ .env æ–‡ä»¶ï¼‰</strong></p>
<pre><code class="language-bash"># /var/www/biya-coin/apps/helix/.env.production
NEXT_PUBLIC_API_URL=https://api.biya.com
NEXT_PUBLIC_SITE_URL=https://helix.biya.com
</code></pre>
<hr>
<h3 id="ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ">ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>ä½¿ç”¨ NEXT_PUBLIC_ å‰ç¼€</strong>ï¼šå®¢æˆ·ç«¯å¯è®¿é—®çš„å˜é‡</li>
<li><strong>æ•æ„Ÿä¿¡æ¯ä¸ä½¿ç”¨å‰ç¼€</strong>ï¼šæœåŠ¡ç«¯ä¸“ç”¨</li>
<li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š.env.example æäº¤åˆ° Gitï¼Œ.env.local ä¸æäº¤</li>
<li><strong>åˆ†ç¯å¢ƒç®¡ç†</strong>ï¼šdevelopment/preview/production</li>
</ol>
<hr>
<h2 id="æ€§èƒ½ä¼˜åŒ–">âš¡ æ€§èƒ½ä¼˜åŒ–</h2>
<h3 id="1-æ„å»ºä¼˜åŒ–">1. æ„å»ºä¼˜åŒ–</h3>
<p><strong>next.config.ts</strong>:</p>
<pre><code class="language-typescript">const nextConfig: NextConfig = {
  // å‹ç¼©
  compress: true,
  
  // å›¾ç‰‡ä¼˜åŒ–
  images: {
    domains: [&#39;your-cdn.com&#39;],
    formats: [&#39;image/avif&#39;, &#39;image/webp&#39;],
  },
  
  // å®éªŒæ€§ä¼˜åŒ–
  experimental: {
    optimizePackageImports: [
      &#39;@biya/shared&#39;,
      &#39;@biya/theme&#39;,
      &#39;lucide-react&#39;,
    ],
  },
  
  // ç”Ÿäº§ Source Mapï¼ˆå¯é€‰ï¼‰
  productionBrowserSourceMaps: false,
}
</code></pre>
<hr>
<h3 id="2-ç¼“å­˜ç­–ç•¥">2. ç¼“å­˜ç­–ç•¥</h3>
<p><strong>Vercel è‡ªåŠ¨ç¼“å­˜</strong>:</p>
<ul>
<li><code>_next/static/*</code> â†’ æ°¸ä¹…ç¼“å­˜</li>
<li>é¡µé¢ â†’ æ ¹æ® ISR é…ç½®</li>
</ul>
<p><strong>è‡ªå»ºæœåŠ¡å™¨ Nginx ç¼“å­˜</strong>:</p>
<pre><code class="language-nginx">location /_next/static {
    proxy_pass http://localhost:3000;
    add_header Cache-Control &quot;public, max-age=31536000, immutable&quot;;
}

location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg)$ {
    expires 1y;
    add_header Cache-Control &quot;public, immutable&quot;;
}
</code></pre>
<hr>
<h3 id="3-cdn-é…ç½®">3. CDN é…ç½®</h3>
<p><strong>Vercel</strong>:</p>
<ul>
<li>è‡ªåŠ¨å…¨çƒ CDN</li>
</ul>
<p><strong>è‡ªå»ºæœåŠ¡å™¨</strong>:</p>
<ul>
<li>ä½¿ç”¨ Cloudflareã€AWS CloudFront ç­‰</li>
</ul>
<hr>
<h3 id="4-ç›‘æ§å’Œåˆ†æ">4. ç›‘æ§å’Œåˆ†æ</h3>
<p><strong>Vercel Analytics</strong>:</p>
<pre><code class="language-typescript">// app/layout.tsx
import { Analytics } from &#39;@vercel/analytics/react&#39;

export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        {children}
        &lt;Analytics /&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<p><strong>è‡ªå»ºç›‘æ§</strong>:</p>
<ul>
<li>PM2 Plus</li>
<li>Grafana + Prometheus</li>
<li>Sentryï¼ˆé”™è¯¯è¿½è¸ªï¼‰</li>
</ul>
<hr>
<h2 id="éƒ¨ç½²æ¸…å•">ğŸ“‹ éƒ¨ç½²æ¸…å•</h2>
<h3 id="vercel-éƒ¨ç½²æ¸…å•">Vercel éƒ¨ç½²æ¸…å•</h3>
<ul>
<li><input disabled="" type="checkbox"> åˆ›å»º Vercel é¡¹ç›®ï¼ˆHelixã€Bridgeï¼‰</li>
<li><input disabled="" type="checkbox"> é…ç½® Root Directory</li>
<li><input disabled="" type="checkbox"> é…ç½® Build Command</li>
<li><input disabled="" type="checkbox"> æ·»åŠ ç¯å¢ƒå˜é‡</li>
<li><input disabled="" type="checkbox"> é…ç½® Ignored Build Step</li>
<li><input disabled="" type="checkbox"> æ·»åŠ è‡ªå®šä¹‰åŸŸå</li>
<li><input disabled="" type="checkbox"> é…ç½® DNS</li>
<li><input disabled="" type="checkbox"> æµ‹è¯•éƒ¨ç½²</li>
</ul>
<h3 id="è‡ªå»ºæœåŠ¡å™¨æ¸…å•">è‡ªå»ºæœåŠ¡å™¨æ¸…å•</h3>
<ul>
<li><input disabled="" type="checkbox"> æœåŠ¡å™¨é…ç½®ï¼ˆNode.jsã€Nginxã€PM2ï¼‰</li>
<li><input disabled="" type="checkbox"> å…‹éš†ä»£ç ä»“åº“</li>
<li><input disabled="" type="checkbox"> å®‰è£…ä¾èµ–</li>
<li><input disabled="" type="checkbox"> æ„å»ºåº”ç”¨</li>
<li><input disabled="" type="checkbox"> é…ç½® PM2</li>
<li><input disabled="" type="checkbox"> é…ç½® Nginx</li>
<li><input disabled="" type="checkbox"> é…ç½® SSL è¯ä¹¦</li>
<li><input disabled="" type="checkbox"> é…ç½®é˜²ç«å¢™</li>
<li><input disabled="" type="checkbox"> è®¾ç½®è‡ªåŠ¨éƒ¨ç½²ï¼ˆCI/CDï¼‰</li>
<li><input disabled="" type="checkbox"> é…ç½®ç›‘æ§</li>
</ul>
<hr>
<h2 id="ä¸‹ä¸€æ­¥">ğŸš€ ä¸‹ä¸€æ­¥</h2>
<p>éƒ¨ç½²æ–¹æ¡ˆå·²æ˜ç¡®ï¼Œç»§ç»­é˜…è¯»ï¼š</p>
<p><strong>â†’ <a href="./08-FAQ%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.md">08-FAQæœ€ä½³å®è·µ.md</a></strong></p>
<p>äº†è§£å¸¸è§é—®é¢˜å’Œæœ€ä½³å®è·µã€‚</p>
<hr>
<h2 id="æœ¬ç« å°ç»“">ğŸ“š æœ¬ç« å°ç»“</h2>
<h3 id="éƒ¨ç½²é€‰é¡¹">éƒ¨ç½²é€‰é¡¹</h3>
<ol>
<li><p><strong>Vercel</strong>ï¼ˆæ¨èï¼‰</p>
<ul>
<li>ç®€å•å¿«é€Ÿ</li>
<li>è‡ªåŠ¨ä¼˜åŒ–</li>
<li>å…¨çƒ CDN</li>
<li>é€‚åˆä¸­å°å‹é¡¹ç›®</li>
</ul>
</li>
<li><p><strong>è‡ªå»ºæœåŠ¡å™¨</strong></p>
<ul>
<li>å®Œå…¨æ§åˆ¶</li>
<li>å›ºå®šæˆæœ¬</li>
<li>éœ€è¦ç»´æŠ¤</li>
<li>é€‚åˆå¤§å‹é¡¹ç›®æˆ–ç‰¹æ®Šéœ€æ±‚</li>
</ul>
</li>
</ol>
<h3 id="å…³é”®é…ç½®">å…³é”®é…ç½®</h3>
<ol>
<li><strong>ç‹¬ç«‹éƒ¨ç½²</strong>ï¼šæ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®</li>
<li><strong>æ¡ä»¶æ„å»º</strong>ï¼šåªæ„å»ºå˜æ›´çš„åº”ç”¨</li>
<li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šåˆ†ç¯å¢ƒç®¡ç†</li>
<li><strong>CI/CD</strong>ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼“å­˜ã€CDNã€ç›‘æ§</li>
</ol>
<hr>
<p><em>æœ€åæ›´æ–°: 2025-10-31</em></p>

</div>
</body>
</html>