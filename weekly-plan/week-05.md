# Week 5: 楂樼骇鍔熻兘 (Day 29-35)

**涓婁竴鍛?*: [Week 4](./week-04.md) | **涓嬩竴鍛?*: [Week 6](./week-06.md)
## Week 5: 高级功能 (Day 29-35)

**目标**: Swap、流动性、网格交易基本可用  
**负责人**: 2-3名开发  
**验收**: 三个高级功能页面完成

---

### Day 29-30: Swap功能

**负责人**: 1名开发  
**工作时间**: 16小时

#### 任务29.1: 创建Swap Service (3小时)

**参考文件**: `injective-helix-demo/app/services/swap.ts`

**详细步骤**:
1. 创建swap service
   - 创建 `src/lib/services/swap.service.ts`
   - 初始化Swap相关API

2. 获取交换路径
   - 查询最优交换路径
   - 支持多跳交换
   - 计算价格影响

3. 计算交换数量
   - 输入数量计算输出
   - 输出数量反推输入
   - 考虑滑点

4. 执行交换
   - 构造Swap消息
   - 签名并广播
   - 处理结果

5. 测试service
   - 测试路径查询
   - 测试数量计算
   - 测试交换执行

**交付物**:
- [ ] swap.service.ts
- [ ] 路径查询方法
- [ ] 交换执行方法

**验收标准**:
- Service功能正常
- 路径查询准确
- 交换功能正常

---

#### 任务29.2: Swap Store (2小时)

**详细步骤**:
1. 创建swap store
   - 创建 `src/lib/store/swapStore.ts`
   - 定义状态类型

2. 状态管理
   - 输入币种和数量
   - 输出币种和预估数量
   - 交换路径
   - 滑点设置
   - 价格影响

3. 方法实现
   - 计算输出数量
   - 获取交换路径
   - 执行交换

4. 测试store
   - 测试状态管理
   - 测试计算

**交付物**:
- [ ] swapStore.ts
- [ ] Swap状态类型

**验收标准**:
- Store功能正常
- 计算准确

---

#### 任务29.3: Swap页面组件 (6小时)

**参考文件**: `injective-helix-demo/pages/swap.vue`

**详细步骤**:
1. SwapForm主组件
   - 创建 `src/components/swap/SwapForm.tsx`
   - 卡片式布局

2. 币种选择器
   - TokenSelector下拉组件
   - 显示币种列表
   - 显示余额
   - 搜索功能

3. 输入区域
   - 输入币种和数量
   - 显示余额
   - 快捷百分比按钮

4. 输出区域
   - 输出币种和预估数量
   - 实时计算

5. 交换按钮
   - 中间的双向箭头
   - 点击交换输入输出币种

6. 交换信息
   - 显示汇率
   - 显示交换路径（如果多跳）
   - 显示价格影响
   - 显示最小接收数量
   - 显示手续费

7. 滑点设置
   - 设置按钮打开设置Modal
   - 预设值：0.1%, 0.5%, 1%
   - 自定义输入
   - 滑点警告

8. 提交按钮
   - 未连接：Connect Wallet
   - 余额不足：Insufficient Balance
   - 正常：Swap按钮

9. 确认Modal
   - 显示交换详情
   - 确认交换

10. 测试组件
    - 测试币种选择
    - 测试数量计算
    - 测试交换执行

**交付物**:
- [ ] SwapForm组件
- [ ] TokenSelector组件
- [ ] 滑点设置Modal

**验收标准**:
- 组件功能完整
- 计算准确
- 交互流畅
- UI美观

---

#### 任务29.4: Swap历史组件 (2小时)

**详细步骤**:
1. SwapHistory组件
   - 显示交换历史
   - 表格布局

2. 表格列
   - 时间
   - 输入币种和数量
   - 输出币种和数量
   - 汇率
   - 交易哈希

3. 筛选
   - 按时间范围
   - 按币种

4. 测试组件
   - 测试历史显示

**交付物**:
- [ ] SwapHistory组件

**验收标准**:
- 历史显示准确

---

#### 任务29.5: Swap页面集成 (3小时)

**详细步骤**:
1. 创建Swap页面
   - 创建 `src/app/swap/page.tsx`
   - 使用MainLayout

2. 页面布局
   - 中心：SwapForm
   - 底部：SwapHistory

3. 测试页面
   - 测试Swap流程
   - 测试历史显示

**交付物**:
- [ ] Swap页面

**验收标准**:
- 页面功能完整
- Swap功能正常

---

### Day 31-32: 流动性功能

**负责人**: 1名开发  
**工作时间**: 16小时

#### 任务31.1: 流动性Service (3小时)

**参考文件**: `injective-helix-demo/app/services/`

**详细步骤**:
1. 创建liquidity service
   - 创建 `src/lib/services/liquidity.service.ts`

2. 获取流动性池
   - 查询所有流动性池
   - 查询池子详情
   - 获取TVL和APY

3. 获取用户流动性
   - 查询用户提供的流动性
   - 计算份额和价值

4. 添加流动性
   - 构造添加流动性消息
   - 签名并广播

5. 移除流动性
   - 构造移除流动性消息
   - 签名并广播

6. 测试service
   - 测试数据获取
   - 测试添加移除

**交付物**:
- [ ] liquidity.service.ts

**验收标准**:
- Service功能正常

---

#### 任务31.2: 流动性Store (2小时)

**详细步骤**:
1. 创建liquidity store
   - 创建 `src/lib/store/liquidityStore.ts`

2. 状态管理
   - 流动性池列表
   - 用户流动性
   - 收益信息

3. 方法实现
   - 获取池列表
   - 添加流动性
   - 移除流动性

4. 测试store

**交付物**:
- [ ] liquidityStore.ts

**验收标准**:
- Store功能正常

---

#### 任务31.3: 流动性池列表 (3小时)

**参考文件**: `injective-helix-demo/pages/lp-rewards/`

**详细步骤**:
1. PoolList组件
   - 创建流动性池列表组件
   - 表格布局

2. 表格列
   - 币种对
   - TVL
   - APY
   - 24h交易量
   - 我的流动性
   - 操作按钮

3. 筛选排序
   - 按TVL排序
   - 按APY排序
   - 搜索币种对

4. 测试组件

**交付物**:
- [ ] PoolList组件

**验收标准**:
- 列表显示正确
- 排序筛选正常

---

#### 任务31.4: 添加流动性组件 (4小时)

**详细步骤**:
1. AddLiquidityModal组件
   - 选择池子或创建新池
   - 输入两个币种数量
   - 自动计算比例
   - 显示池子份额
   - 显示预期收益

2. 表单验证
   - 余额验证
   - 比例验证

3. 提交流程
   - 构造消息
   - 确认Modal
   - 提交交易

4. 测试组件

**交付物**:
- [ ] AddLiquidityModal组件

**验收标准**:
- 功能正常
- 计算准确

---

#### 任务31.5: 移除流动性组件 (2小时)

**详细步骤**:
1. RemoveLiquidityModal组件
   - 选择要移除的流动性
   - 滑块选择移除百分比
   - 显示预期收回数量
   - 显示收益

2. 提交流程
   - 确认
   - 提交交易

3. 测试组件

**交付物**:
- [ ] RemoveLiquidityModal组件

**验收标准**:
- 功能正常

---

#### 任务31.6: 流动性页面集成 (2小时)

**详细步骤**:
1. 创建流动性页面
   - 创建 `src/app/liquidity/page.tsx`

2. 页面布局
   - Tab：所有池子、我的流动性
   - 所有池子Tab：PoolList
   - 我的流动性Tab：MyLiquidity

3. 快速操作
   - 添加流动性按钮
   - 移除流动性按钮

4. 测试页面

**交付物**:
- [ ] 流动性页面

**验收标准**:
- 页面功能完整

---

### Day 33-35: 网格交易

**负责人**: 1-2名开发  
**工作时间**: 24小时

#### 任务33.1: 网格交易Service (4小时)

**参考文件**: `injective-helix-demo/app/services/grid-trading/`

**详细步骤**:
1. 创建grid service
   - 创建 `src/lib/services/grid.service.ts`

2. 网格策略计算
   - 计算网格价位
   - 算术网格算法
   - 几何网格算法
   - 计算每格数量

3. 创建网格策略
   - 保存策略参数
   - 生成初始订单

4. 批量下单
   - 构造批量订单消息
   - 提交所有网格订单

5. 监控策略
   - 监听订单成交
   - 自动重建订单

6. 停止策略
   - 取消所有未成交订单

7. 测试service

**交付物**:
- [ ] grid.service.ts
- [ ] 网格计算算法

**验收标准**:
- 计算准确
- 功能正常

---

#### 任务33.2: 网格Store (2小时)

**详细步骤**:
1. 创建grid store
   - 创建 `src/lib/store/gridStore.ts`

2. 状态管理
   - 策略列表
   - 策略参数
   - 网格订单
   - 策略状态

3. 方法实现
   - 创建策略
   - 启动策略
   - 停止策略
   - 删除策略

4. 测试store

**交付物**:
- [ ] gridStore.ts

**验收标准**:
- Store功能正常

---

#### 任务33.3: 创建网格策略组件 (6小时)

**参考文件**: `injective-helix-demo/pages/trading-bots/`

**详细步骤**:
1. GridSetup组件
   - 创建网格策略设置表单
   - 选择交易对
   - 选择策略类型（算术/几何）
   - 设置价格区间（上限/下限）
   - 设置网格数量
   - 设置每格投资额

2. 网格计算器
   - 实时计算网格间距
   - 计算总投资额
   - 计算预期收益
   - 显示策略预览（网格价位列表）

3. 风险提示
   - 显示风险等级
   - 单边行情风险提示
   - 建议价格区间

4. 表单验证
   - 价格区间验证
   - 网格数量范围
   - 投资额验证

5. 提交创建
   - 确认Modal显示策略详情
   - 创建策略
   - 批量下单

6. 测试组件

**交付物**:
- [ ] GridSetup组件
- [ ] 网格计算器

**验收标准**:
- 策略设置完整
- 计算准确
- 创建功能正常

---

#### 任务33.4: 网格策略列表 (4小时)

**详细步骤**:
1. GridList组件
   - 显示所有策略
   - 卡片式布局

2. 策略卡片
   - 显示策略参数
   - 显示当前状态（运行中/已停止）
   - 显示当前收益
   - 显示运行时长
   - 显示网格成交次数
   - 操作按钮（查看详情、停止、删除）

3. 筛选
   - 按状态筛选
   - 按市场筛选

4. 测试组件

**交付物**:
- [ ] GridList组件

**验收标准**:
- 列表显示正确
- 操作功能正常

---

#### 任务33.5: 网格详情页面 (4小时)

**详细步骤**:
1. 创建网格详情页面
   - 创建 `src/app/grid/[id]/page.tsx`

2. 页面内容
   - 策略参数展示
   - 网格订单列表
   - 网格可视化（图表显示网格线）
   - 收益统计
   - 收益曲线图
   - 成交历史

3. 操作区域
   - 停止策略按钮
   - 删除策略按钮
   - 修改策略按钮（可选）

4. 实时更新
   - 订阅订单状态
   - 实时更新收益

5. 测试页面

**交付物**:
- [ ] 网格详情页面

**验收标准**:
- 信息完整
- 实时更新正常
- 可视化清晰

---

#### 任务33.6: 网格交易页面集成 (2小时)

**详细步骤**:
1. 创建网格交易页面
   - 创建 `src/app/grid/page.tsx`

2. 页面布局
   - Tab：我的策略、创建策略
   - 我的策略Tab：GridList
   - 创建策略Tab：GridSetup

3. 测试页面

**交付物**:
- [ ] 网格交易页面

**验收标准**:
- 页面功能完整

---

#### 任务33.7: Week 5集成测试 (2小时)

**详细步骤**:
1. 功能测试
   - 测试Swap功能
   - 测试流动性功能
   - 测试网格交易功能

2. 数据准确性测试
   - 验证计算准确性
   - 对比Nuxt版本

3. 性能测试
   - 页面加载速度
   - 交互流畅度

4. Bug修复
   - 记录Bug
   - 修复
   - 回归测试

**交付物**:
- [ ] 测试报告
- [ ] Bug修复记录

**验收标准**:
- Week 5所有功能基本可用
- 核心计算准确
- 无严重Bug

---

### Week 5 验收标准

#### 功能验收
- [ ] Swap可以交换代币
- [ ] 流动性可以添加移除
- [ ] 网格策略可以创建
- [ ] 网格策略可以运行
- [ ] 网格策略可以停止
- [ ] 所有页面可正常访问

#### 计算验收
- [ ] Swap汇率准确
- [ ] 流动性份额准确
- [ ] 网格价位计算准确
- [ ] 网格收益计算准确

#### 质量验收
- [ ] 无TypeScript错误
- [ ] 无严重Bug
- [ ] 基本功能正常

#### UI验收
- [ ] 页面布局合理
- [ ] 与Nuxt版本风格一致
- [ ] 响应式布局基本正常

**注意**: Week 5功能可能不够完善，Week 6会继续优化

# 8周迁移计划 - Week 6-8详细内容

这是《MIGRATION_PLAN_8WEEKS.md》的最后部分，包含Week 6-8的详细任务分解。

---


---

**涓婁竴鍛?*: [Week 4](./week-04.md) | **涓嬩竴鍛?*: [Week 6](./week-06.md)
