# Week 4: 璁㈠崟鎸佷粨璧勪骇 (Day 22-28)

**涓婁竴鍛?*: [Week 3](./week-03.md) | **涓嬩竴鍛?*: [Week 5](./week-05.md)
## Week 4: 订单持仓资产 (Day 22-28)

**目标**: 完整的订单管理、持仓管理、资产管理页面  
**负责人**: 2-3名开发  
**验收**: 订单/持仓/资产页面完整可用

---

### Day 22-23: 订单管理页面

**负责人**: 1名开发  
**工作时间**: 16小时

#### 任务22.1: 统一Orders Store (2小时)

**详细步骤**:
1. 创建统一的orders store
   - 创建 `src/lib/store/ordersStore.ts`
   - 合并现货和期货订单

2. 订单数据结构
   - 统一的Order类型
   - 区分type字段（spot/derivatives）
   - 包含所有必要字段

3. 订单获取方法
   - fetchSpotOrders
   - fetchDerivativeOrders
   - fetchAllOrders
   - 按市场筛选
   - 按时间范围筛选
   - 按状态筛选

4. 订单实时订阅
   - 订阅现货订单变化
   - 订阅期货订单变化
   - 合并到统一列表

5. 测试store
   - 测试数据获取
   - 测试筛选
   - 测试订阅

**交付物**:
- [ ] ordersStore.ts
- [ ] 统一Order类型
- [ ] 订单获取和订阅方法

**验收标准**:
- Store功能正常
- 数据结构统一
- 筛选功能正确

---

#### 任务22.2: 订单管理页面 (6小时)

**参考文件**: `injective-helix-demo/pages/portfolio/orders/`

**详细步骤**:
1. 创建订单管理页面
   - 创建 `src/app/orders/page.tsx`
   - 使用MainLayout

2. 页面布局
   - 顶部：筛选栏
   - 中间：订单列表（Tab切换）
   - 底部：分页

3. 筛选栏设计
   - 市场筛选（下拉选择）
   - 类型筛选（现货/期货）
   - 方向筛选（买/卖）
   - 状态筛选（全部/未成交/部分成交/已成交/已取消）
   - 时间范围筛选（今天/7天/30天/自定义）
   - 搜索框（按市场名搜索）

4. Tab页设计
   - 当前订单
   - 订单历史
   - 成交历史

5. 当前订单列表
   - 表格显示
   - 列：时间、市场、类型、方向、订单类型、价格、数量、已成交、未成交、状态、操作
   - 操作：取消按钮
   - 批量操作：全选、批量取消
   - 排序：按时间、价格、数量
   - 实时更新

6. 订单历史列表
   - 显示已成交/已取消订单
   - 列：时间、市场、类型、方向、订单类型、价格、数量、已成交、状态、成交均价
   - 导出功能：导出CSV

7. 成交历史列表
   - 显示所有成交记录
   - 列：时间、市场、类型、方向、价格、数量、手续费、成交额
   - 统计：总成交量、总手续费
   - 导出功能

8. 订单详情Modal
   - 点击订单弹出详情
   - 显示完整订单信息
   - 显示成交明细
   - 显示手续费明细

9. 空状态设计
   - 无订单时显示友好提示
   - 引导去交易

10. 测试页面
    - 测试筛选功能
    - 测试取消订单
    - 测试导出功能
    - 测试实时更新

**交付物**:
- [ ] 订单管理页面
- [ ] 筛选栏组件
- [ ] 三个订单列表
- [ ] 订单详情Modal

**验收标准**:
- 页面功能完整
- 筛选功能正常
- 实时更新正常
- 导出功能正常
- UI清晰易用

---

#### 任务22.3: 订单导出功能 (2小时)

**详细步骤**:
1. 创建export utils
   - 创建 `src/lib/utils/export.ts`
   - 实现CSV导出
   - 实现Excel导出（可选）

2. 导出订单数据
   - 按筛选条件导出
   - 包含所有字段
   - 格式化数据

3. 导出按钮
   - 添加到页面
   - 选择导出格式
   - 下载文件

4. 测试导出
   - 测试CSV导出
   - 测试数据完整性

**交付物**:
- [ ] export.ts工具函数
- [ ] 导出按钮组件

**验收标准**:
- 导出功能正常
- 数据完整准确
- 文件格式正确

---

#### 任务22.4: 订单通知 (2小时)

**详细步骤**:
1. 订单状态通知
   - 订单成交Toast通知
   - 订单部分成交通知
   - 订单取消通知
   - 订单失败通知

2. 通知内容设计
   - 显示订单简要信息
   - 显示成交价格和数量
   - 链接到订单详情

3. 通知设置
   - 在settings中添加通知开关
   - 选择通知类型

4. 实现通知逻辑
   - 订阅订单状态变化
   - 触发Toast通知
   - 浏览器通知（可选）

5. 测试通知
   - 测试各种通知场景
   - 测试通知设置

**交付物**:
- [ ] 订单通知逻辑
- [ ] 通知设置

**验收标准**:
- 通知及时准确
- 通知设置有效

---

#### 任务22.5: 集成测试与优化 (4小时)

**详细步骤**:
1. 功能测试
   - 测试订单列表显示
   - 测试筛选功能
   - 测试取消订单
   - 测试导出功能
   - 测试通知功能

2. 性能测试
   - 测试大量订单加载
   - 测试实时更新性能
   - 测试筛选性能

3. UI测试
   - 测试响应式布局
   - 测试不同屏幕尺寸
   - 测试主题切换

4. 优化
   - 虚拟滚动（如果订单多）
   - 分页加载
   - 缓存策略

5. Bug修复
   - 记录Bug
   - 修复
   - 回归测试

**交付物**:
- [ ] 测试报告
- [ ] 性能优化
- [ ] Bug修复记录

**验收标准**:
- 所有功能正常
- 性能良好
- 无严重Bug

---

### Day 24-25: 资产管理页面

**负责人**: 1名开发 + 1名开发  
**工作时间**: 16小时

#### 任务24.1: 创建Portfolio Store (2小时)

**参考文件**: `injective-helix-demo/store/account.ts`

**详细步骤**:
1. 创建portfolio store
   - 创建 `src/lib/store/portfolioStore.ts`
   - 定义状态类型

2. 资产数据结构
   - 各币种余额
   - 总资产价值（USD）
   - 24h资产变化
   - 资产分布

3. 资产获取方法
   - fetchBalances
   - fetchTotalValue
   - fetchAssetHistory
   - 实时更新余额

4. 资产统计
   - 计算总资产
   - 计算资产分布百分比
   - 计算24h变化

5. 测试store
   - 测试数据获取
   - 测试计算

**交付物**:
- [ ] portfolioStore.ts
- [ ] Portfolio类型
- [ ] 资产获取方法

**验收标准**:
- Store功能正常
- 数据准确
- 计算正确

---

#### 任务24.2: 资产总览组件 (3小时)

**参考文件**: `injective-helix-demo/pages/portfolio/`

**详细步骤**:
1. AssetOverview组件
   - 创建 `src/components/portfolio/AssetOverview.tsx`
   - 卡片式布局

2. 总资产卡片
   - 显示总资产价值（大字显示）
   - 显示24h变化（金额和百分比）
   - 涨跌颜色标识

3. 资产分布饼图
   - 使用ApexCharts
   - 显示各币种占比
   - 交互：Hover显示详情

4. 快速操作
   - 充值按钮
   - 提现按钮
   - 转账按钮

5. 资产趋势图
   - 折线图显示资产变化
   - 时间范围选择：1天/7天/30天/全部
   - 显示关键节点

6. 测试组件
   - 测试数据显示
   - 测试图表
   - 测试交互

**交付物**:
- [ ] AssetOverview组件
- [ ] 饼图组件
- [ ] 趋势图组件

**验收标准**:
- 资产总览正确
- 图表美观准确
- 交互流畅

---

#### 任务24.3: 余额列表组件 (3小时)

**参考文件**: `injective-helix-demo/components/Partials/Portfolio/Balances/`

**详细步骤**:
1. BalanceList组件
   - 创建 `src/components/portfolio/BalanceList.tsx`
   - 表格布局

2. 表格列设计
   - 币种图标和名称
   - 可用余额
   - 冻结余额（在订单中）
   - 总余额
   - USD价值
   - 24h变化
   - 操作按钮（充值、提现、转账、交易）

3. 筛选和排序
   - 隐藏小额余额（< $1）
   - 隐藏零余额
   - 按价值排序
   - 按名称排序
   - 搜索币种

4. 实时更新
   - 订阅余额变化
   - 实时更新显示

5. 空状态
   - 无余额时显示提示

6. 测试组件
   - 测试余额显示
   - 测试筛选排序
   - 测试实时更新

**交付物**:
- [ ] BalanceList组件
- [ ] 筛选排序功能

**验收标准**:
- 余额显示准确
- 筛选排序正常
- 实时更新正常

---

#### 任务24.4: 充值提现组件 (4小时)

**参考文件**: `injective-helix-demo/components/Partials/Portfolio/`

**详细步骤**:
1. DepositModal组件
   - 创建充值Modal
   - 选择币种
   - 显示充值地址
   - 生成二维码
   - 复制地址按钮
   - 显示充值注意事项

2. WithdrawModal组件
   - 创建提现Modal
   - 选择币种
   - 输入提现地址
   - 输入提现数量
   - 显示可用余额
   - 显示手续费
   - 显示到账数量
   - 地址验证
   - 确认提现

3. 提现Service
   - 创建 `src/lib/services/withdraw.service.ts`
   - 构造提现消息
   - 签名并广播

4. 充提记录
   - TransactionHistory组件
   - 显示充值记录
   - 显示提现记录
   - 状态：处理中/成功/失败
   - 显示交易哈希
   - 链接到区块浏览器

5. 测试功能
   - 测试充值地址生成
   - 测试提现流程
   - 测试充提记录

**交付物**:
- [ ] DepositModal组件
- [ ] WithdrawModal组件
- [ ] withdraw.service.ts
- [ ] TransactionHistory组件

**验收标准**:
- 充值地址正确
- 提现功能正常
- 充提记录准确

---

#### 任务24.5: 资产管理页面集成 (2小时)

**详细步骤**:
1. 创建资产管理页面
   - 创建 `src/app/portfolio/page.tsx`
   - 使用MainLayout

2. 页面布局
   - 顶部：资产总览
   - 中间：Tab页（余额、充提记录、子账户）
   - 余额Tab：BalanceList
   - 充提Tab：TransactionHistory

3. 快速操作
   - 充值按钮弹出DepositModal
   - 提现按钮弹出WithdrawModal

4. 测试页面
   - 测试页面加载
   - 测试Tab切换
   - 测试Modal交互

**交付物**:
- [ ] 资产管理页面

**验收标准**:
- 页面功能完整
- 布局合理
- 交互流畅

---

#### 任务24.6: 子账户管理（简化） (2小时)

**参考文件**: `injective-helix-demo/components/Partials/Portfolio/Subaccounts/`

**详细步骤**:
1. SubaccountList组件
   - 显示所有子账户
   - 显示余额
   - 切换子账户

2. 子账户转账
   - 选择源子账户
   - 选择目标子账户
   - 选择币种和数量
   - 执行转账

3. 转账历史
   - 显示子账户间转账记录

4. 测试功能
   - 测试子账户显示
   - 测试转账功能

**交付物**:
- [ ] SubaccountList组件
- [ ] 转账功能

**验收标准**:
- 子账户管理正常
- 转账功能正常

---

### Day 26-28: 投资组合分析与完善

**负责人**: 1-2名开发  
**工作时间**: 24小时

#### 任务26.1: 收益分析组件 (4小时)

**详细步骤**:
1. PnLAnalysis组件
   - 创建收益分析组件
   - 计算总收益
   - 计算ROI
   - 按币种分析
   - 按时间分析

2. 收益曲线图
   - 折线图显示累计收益
   - 时间范围选择
   - 关键节点标注

3. 收益统计卡片
   - 今日收益
   - 7日收益
   - 30日收益
   - 总收益

4. 测试组件
   - 测试收益计算
   - 测试图表显示

**交付物**:
- [ ] PnLAnalysis组件
- [ ] 收益计算逻辑

**验收标准**:
- 收益计算准确
- 图表清晰美观

---

#### 任务26.2: 交易统计组件 (3小时)

**详细步骤**:
1. TradingStats组件
   - 创建交易统计组件
   - 统计交易次数
   - 统计交易量
   - 统计手续费
   - 统计胜率

2. 统计图表
   - 柱状图：每日交易量
   - 饼图：手续费分布
   - 胜率仪表盘

3. 统计卡片
   - 总交易次数
   - 总交易量
   - 总手续费
   - 平均胜率

4. 测试组件
   - 测试统计计算
   - 测试图表显示

**交付物**:
- [ ] TradingStats组件
- [ ] 统计计算逻辑

**验收标准**:
- 统计准确
- 图表美观

---

#### 任务26.3: 持仓分析组件 (3小时)

**详细步骤**:
1. PositionAnalysis组件
   - 持仓分布图
   - 盈亏分析
   - 风险分析

2. 持仓统计
   - 当前持仓总价值
   - 未实现盈亏
   - 平均持仓时长
   - 风险等级

3. 测试组件
   - 测试持仓分析

**交付物**:
- [ ] PositionAnalysis组件

**验收标准**:
- 分析准确
- 展示清晰

---

#### 任务26.4: Portfolio页面完善 (4小时)

**详细步骤**:
1. 增加Tab页
   - 概览Tab：AssetOverview + 快速统计
   - 余额Tab：BalanceList
   - 持仓Tab：PositionsList
   - 订单Tab：简化的订单列表
   - 分析Tab：PnLAnalysis + TradingStats

2. 页面优化
   - 加载状态
   - 骨架屏
   - 错误处理
   - 空状态

3. 导航优化
   - 面包屑导航
   - 快速链接

4. 测试页面
   - 测试所有Tab
   - 测试页面性能

**交付物**:
- [ ] 完善的Portfolio页面

**验收标准**:
- 页面功能完整
- 性能良好
- UI美观

---

#### 任务26.5: 资产详情页面 (4小时)

**详细步骤**:
1. 创建资产详情页
   - 创建 `src/app/portfolio/assets/[token]/page.tsx`
   - 显示单个币种详细信息

2. 页面内容
   - 币种基本信息
   - 余额详情
   - 价格图表
   - 交易历史
   - 充提记录

3. 操作区域
   - 交易按钮
   - 充值按钮
   - 提现按钮

4. 测试页面
   - 测试详情显示
   - 测试操作功能

**交付物**:
- [ ] 资产详情页面

**验收标准**:
- 信息完整
- 操作便捷

---

#### 任务26.6: Week 4集成测试 (6小时)

**详细步骤**:
1. 功能测试
   - 测试订单管理页面
   - 测试资产管理页面
   - 测试投资组合页面
   - 测试所有Tab和功能

2. 数据准确性测试
   - 对比Nuxt版本数据
   - 验证计算准确性
   - 验证统计数据

3. 性能测试
   - 页面加载速度
   - 大量数据处理
   - 实时更新性能

4. UI测试
   - 响应式布局
   - 主题切换
   - 不同屏幕尺寸

5. Bug修复
   - 记录所有Bug
   - 按优先级修复
   - 回归测试

6. 代码Review
   - Review所有代码
   - 优化代码质量

**交付物**:
- [ ] 测试报告
- [ ] Bug修复记录
- [ ] Code review记录

**验收标准**:
- Week 4所有功能正常
- 数据准确
- 性能良好
- 无严重Bug

---

### Week 4 验收标准

#### 功能验收
- [ ] 订单管理页面完整
- [ ] 可筛选和导出订单
- [ ] 订单通知正常
- [ ] 资产总览正确
- [ ] 余额列表准确
- [ ] 充值功能正常
- [ ] 提现功能正常
- [ ] 子账户管理正常
- [ ] 收益分析准确
- [ ] 交易统计准确
- [ ] 所有页面可正常访问

#### 性能验收
- [ ] 页面加载 < 2s
- [ ] 大量数据处理流畅
- [ ] 图表渲染流畅

#### 质量验收
- [ ] 无TypeScript错误
- [ ] 无ESLint错误
- [ ] 计算准确
- [ ] 无严重Bug

#### UI验收
- [ ] 页面布局合理
- [ ] 响应式布局正常
- [ ] 图表美观
- [ ] 与Nuxt版本风格一致

---


---

**涓婁竴鍛?*: [Week 3](./week-03.md) | **涓嬩竴鍛?*: [Week 5](./week-05.md)
