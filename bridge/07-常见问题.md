# 07 - 常见问题（FAQ）

> **最后更新**: 2025-10-30  
> **适合人群**: 所有人

---

## 📖 目录

1. [业务问题](#业务问题)
2. [技术问题](#技术问题)
3. [钱包问题](#钱包问题)
4. [交易问题](#交易问题)
5. [开发问题](#开发问题)

---

## 💼 业务问题

### Q1: Peggy 和 Axelar 有什么区别？

**A**: 

| 特性 | Peggy | Axelar |
|------|-------|--------|
| 支持链 | 仅以太坊 | 40+ 链（BSC、Polygon等） |
| 速度 | 5-15 分钟 | 5-30 分钟 |
| 费用 | Gas only | Gas + 0.1-0.3% |
| 安全性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 代币前缀 | `peggy` | `axl` / `ibc` |

**推荐**：
- 以太坊 ↔️ Injective：使用 **Peggy**
- BSC/Polygon ↔️ Injective：使用 **Axelar**

---

### Q2: 为什么 Peggy 提现需要这么久？

**A**: Peggy 提现需要 **5-24 小时**，原因如下：

1. **批量处理机制**：
   - 验证器每 4-12 小时批量处理一次
   - 多个用户的提现打包到一笔交易
   - 节省 Gas 费用

2. **安全性考虑**：
   - 需要多个验证器签名
   - 确保跨链安全

**解决方案**：
- 不着急的话，耐心等待
- 需要快速到账，使用其他桥（如 Wormhole）

---

### Q3: 桥接失败了，资金去哪了？

**A**: 不用担心！资金是安全的。

**可能的情况**：

1. **交易未确认**：
   - 检查区块浏览器
   - 等待更多确认

2. **Gas 费不足**：
   - 交易自动回滚
   - 资金仍在原地址

3. **网络拥堵**：
   - 交易在队列中
   - 可能需要更长时间

**查看交易状态**：
```
以太坊：https://etherscan.io/tx/[交易哈希]
Injective：https://explorer.injective.network/transaction/[交易哈希]
```

---

### Q4: 为什么需要授权（Approve）？

**A**: 授权是 ERC20 代币的安全机制。

**原理**：
```
你的钱包拥有代币
    ↓
Peggy 合约想要转移你的代币
    ↓
需要你先授权（允许合约使用你的代币）
```

**只需授权一次**：
- 通常授权无限额度
- 后续转账无需重复授权
- 费用：~$5-20

---

### Q5: 最小/最大转账金额是多少？

**A**: 

| 限制 | 金额 | 说明 |
|------|------|------|
| 最小金额 | $10 | 低于此金额不划算（Gas 费高） |
| 最大金额 | 无限制 | 但建议单次不超过 $100,000 |
| 推荐范围 | $100-$10,000 | 性价比最高 |

**提示**：首次使用建议转小额测试（$10-50）

---

## 🔧 技术问题

### Q6: 为什么 React 版本这么高（19.1.0）？

**A**: 项目使用 **React 19 RC**，这是为了：
- 使用最新的 Server Components
- 兼容 Next.js 15
- 提升性能

**兼容性**：
- 所有 Bridge 组件都标记了 `'use client'`
- 与 React 18 API 100% 兼容
- 可以降级到 React 18（如需要）

---

### Q7: 为什么有这么多 Injective 包在 vendor 目录？

**A**: **本地化依赖** 的原因：

1. **版本控制**：
   - 确保所有 Injective 包版本一致（1.16.7）
   - 避免 npm 版本冲突

2. **离线开发**：
   - 不依赖 npm registry
   - 更快的安装速度

3. **定制需求**：
   - 可以修改源码（如果需要）
   - 便于调试

**哪些包被本地化**：
```
@injectivelabs/sdk-ts
@injectivelabs/wallet-strategy
@injectivelabs/core-proto-ts
... 共 18 个包
```

---

### Q8: ethers v5 还是 v6？

**A**: 项目使用 **ethers v6**。

**重要差异**：
```typescript
// ethers v5
import { ethers } from 'ethers'
const provider = new ethers.providers.JsonRpcProvider(rpc)
const interface = new ethers.utils.Interface(abi)

// ethers v6 ✅
import { ethers } from 'ethers'
const provider = new ethers.JsonRpcProvider(rpc)
const interface = new ethers.Interface(abi)
```

**注意**：
- Vendor 中的 Injective SDK 使用 ethers v5 API
- 需要兼容处理（已在 BaseContract 中处理）

---

### Q9: 为什么需要同时连接两个钱包？

**A**: 因为桥接涉及两条链：

```
以太坊（EVM 链）              Injective（Cosmos 链）
     ↓                             ↓
  MetaMask                       Keplr
     ↓                             ↓
  发送代币                       接收代币
```

**两个钱包的作用**：
- **MetaMask/OKX**：管理以太坊/BSC 地址和签名
- **Keplr/Leap**：管理 Injective 地址和签名

**不能只用一个钱包**：
- 地址格式不同
- 签名算法不同
- 交易结构不同

---

### Q10: Gas 费为什么这么高？

**A**: Gas 费取决于网络：

| 网络 | Gas 代币 | 平均费用 |
|------|---------|---------|
| 以太坊 Layer 1 | ETH | $10-$100 |
| BNB Chain | BNB | $0.1-$1 |
| Injective | INJ | $0.01 |

**降低 Gas 费的方法**：
1. 使用 BSC 而不是以太坊
2. 在低峰时段操作（UTC 2-6am）
3. 批量转账（减少交易次数）
4. 使用 Layer 2（如 Arbitrum）

---

## 👛 钱包问题

### Q11: 支持哪些钱包？

**A**: 

**Cosmos 钱包**（用于 Injective）：
- ✅ Keplr（推荐）
- ✅ Leap
- ✅ Cosmostation

**EVM 钱包**（用于以太坊/BSC）：
- ✅ MetaMask（推荐）
- ✅ OKX Wallet
- ✅ WalletConnect（移动端）

---

### Q12: Keplr 连接失败怎么办？

**A**: 检查以下几点：

1. **是否安装 Keplr 扩展**：
   - 访问：https://www.keplr.app/
   - 安装浏览器扩展

2. **是否启用扩展**：
   - 浏览器 → 扩展管理 → 启用 Keplr

3. **是否添加 Injective 链**：
   - 打开 Keplr
   - 点击顶部网络下拉
   - 搜索 "Injective"

4. **是否锁定**：
   - 解锁 Keplr 钱包
   - 输入密码

---

### Q13: WalletConnect Project ID 在哪获取？

**A**: 

1. 访问：https://cloud.walletconnect.com/
2. 注册/登录（可用 GitHub）
3. 创建项目：
   - Project Name: `Biya Helix Bridge`
   - Project URL: `http://localhost:8080`
4. 复制 Project ID
5. 更新 `.env.local`：
   ```bash
   NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=你的ID
   ```

详细指南：`docs/WALLET_CONNECT_SETUP.md`

---

## 📡 交易问题

### Q14: 交易卡在 Pending 状态怎么办？

**A**: 

**以太坊交易 Pending**：
1. **Gas 价格过低**：
   - 使用 Speed Up（加速）
   - 提高 Gas Price

2. **网络拥堵**：
   - 耐心等待
   - 查看 https://etherscan.io/gastracker

3. **Nonce 冲突**：
   - 取消并重新发送
   - 使用 Cancel 功能

**Injective 交易 Pending**：
- Injective 交易通常 1-3 秒确认
- 如果长时间 Pending，检查网络状态

---

### Q15: 如何查询交易状态？

**A**: 

**以太坊**：
```
https://etherscan.io/tx/[交易哈希]
```

**Injective**：
```
https://explorer.injective.network/transaction/[交易哈希]
```

**BSC**：
```
https://bscscan.com/tx/[交易哈希]
```

**在代码中查询**：
```typescript
import { useTransactionReceipt } from 'wagmi'

const { data, isError, isLoading } = useTransactionReceipt({
  hash: txHash
})
```

---

### Q16: 授权了但还是提示需要授权？

**A**: 可能的原因：

1. **授权交易未确认**：
   - 等待交易确认（12 个区块）
   - 查看区块浏览器

2. **授权给错误的合约**：
   - 检查合约地址
   - 重新授权

3. **缓存问题**：
   - 刷新页面
   - 清除浏览器缓存

4. **授权额度不足**：
   - 使用无限授权（`MaxUint256`）

---

## 💻 开发问题

### Q17: 如何在本地测试跨链桥？

**A**: 

**环境准备**：
```bash
# 1. 安装依赖
npm install

# 2. 配置环境变量
cp .env.example .env.local

# 3. 设置必需变量
NEXT_PUBLIC_NETWORK=testnet
NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=xxx
```

**使用测试网**：
- 以太坊：Sepolia
- Injective：Testnet
- 获取测试代币：
  - Sepolia Faucet: https://sepoliafaucet.com/
  - Injective Faucet: https://testnet.faucet.injective.network/

**启动开发服务器**：
```bash
npm run dev
```

---

### Q18: 如何添加新的代币？

**A**: 

1. **定义代币**（`lib/bridge/data/tokens.ts`）：
```typescript
export const newToken: TokenStatic = {
  address: "0x...",
  denom: "peggy0x...",
  symbol: "NEW",
  name: "New Token",
  decimals: 18,
  logo: "https://...",
  coinGeckoId: "new-token",
  tokenType: TokenType.Erc20,
  tokenVerification: TokenVerification.Verified,
  isNative: false
}
```

2. **添加到代币列表**（`BridgeFromV2.tsx`）：
```typescript
const tokens = [
  ethUsdtToken,
  newToken,  // 添加新代币
  // ...
]
```

3. **测试**：
   - 查询余额
   - 授权
   - 转账

---

### Q19: 如何调试 Provider 错误？

**A**: 

**使用 React DevTools**：
```bash
# 安装
npm install -D react-devtools

# 启动
npx react-devtools
```

**打印 Context 值**：
```typescript
const { address, injectiveAddress } = useWallet()

useEffect(() => {
  console.log('Wallet State:', {
    address,
    injectiveAddress
  })
}, [address, injectiveAddress])
```

**检查 Provider 层级**：
```typescript
// 确保组件在 BridgeProviders 内部
<BridgeProviders>
  <YourComponent />  {/* ✅ 可以使用 Hooks */}
</BridgeProviders>

<YourComponent />  {/* ❌ 报错：not within Provider */}
```

---

### Q20: 如何处理大数计算？

**A**: 使用 `@injectivelabs/utils`：

```typescript
import {
  BigNumberInBase,
  BigNumberInWei
} from '@injectivelabs/utils'

// 用户输入 → 最小单位
const userInput = "100.5"  // 100.5 USDT
const inWei = new BigNumberInBase(userInput)
  .toWei(6)  // USDT 6 位精度
  .toString()  // "100500000"

// 最小单位 → 用户可读
const rawBalance = "100500000"
const displayBalance = new BigNumberInBase(rawBalance)
  .toWei(-6)  // 负数表示除以
  .toFixed(2)  // "100.50"

// 比较
const amount1 = new BigNumberInBase("100.5")
const amount2 = new BigNumberInBase("50")

if (amount1.gt(amount2)) {
  console.log('amount1 > amount2')
}
```

---

## 🆘 获取帮助

### 文档导航

- 🎯 [业务概述](./01-业务概述.md) - 理解跨链桥
- 🏗️ [架构设计](./02-架构设计.md) - 技术架构
- 📚 [核心概念](./03-核心概念.md) - 关键术语
- 🔄 [数据流程](./04-数据流程.md) - 交易流程
- 📦 [组件说明](./05-组件说明.md) - 代码模块
- 📖 [API 参考](./06-API参考.md) - API 文档

### 社区资源

- **Injective Discord**: https://discord.gg/injective
- **Injective 文档**: https://docs.injective.network/
- **Axelar Discord**: https://discord.gg/axelar

---

## 💡 最佳实践

### 1. 开发建议

✅ **推荐做法**：
- 使用 TypeScript 类型检查
- 添加详细的错误处理
- 记录交易哈希
- 小额测试后再大额转账

❌ **不推荐**：
- 跳过授权检查
- 忽略 Gas 费估算
- 不验证用户输入
- 在生产环境使用 console.log

### 2. 用户体验

✅ **提升 UX**：
- 显示实时 Gas 费
- 提供交易进度条
- 添加交易历史记录
- 支持交易加速/取消

### 3. 安全建议

✅ **安全措施**：
- 验证合约地址
- 检查代币精度
- 限制单次转账上限
- 添加二次确认

---

## 🎉 总结

如果遇到其他问题：

1. 📖 查看相关文档
2. 🔍 搜索错误信息
3. 🐛 检查控制台日志
4. 💬 在社区提问

**记住**：大多数问题都有解决方案，保持耐心！ 😊

---

*最后更新: 2025-10-30*

