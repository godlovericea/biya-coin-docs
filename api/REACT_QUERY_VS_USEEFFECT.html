<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACT_QUERY_VS_USEEFFECT</title>
    <link rel="stylesheet" href="../md2html/style.css">
</head>
<body>
<nav class="table-of-contents">
  <h2 class="toc-title">ğŸ“‘ ç›®å½•</h2>
  <ul class="toc-list">
    <li class="toc-item toc-level-1">
      <a href="#react-query-vs-useeffect-ä¸ºä»€ä¹ˆè¦æ›¿æ¢æ•°æ®è·å–æ–¹å¼" class="toc-link">React Query vs useEffectï¼šä¸ºä»€ä¹ˆè¦æ›¿æ¢æ•°æ®è·å–æ–¹å¼ï¼Ÿ</a>
    <li class="toc-item toc-level-2">
      <a href="#ç›®å½•" class="toc-link">ğŸ“‘ ç›®å½•</a>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æ ¸å¿ƒè§‚ç‚¹" class="toc-link">æ ¸å¿ƒè§‚ç‚¹</a>
    <li class="toc-item toc-level-3">
      <a href="#ä¸€å¥è¯æ€»ç»“" class="toc-link">ğŸ¯ ä¸€å¥è¯æ€»ç»“</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#å…³é”®æ•°æ®" class="toc-link">ğŸ“Š å…³é”®æ•°æ®</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#useeffect-çš„-7-ä¸ªä¸¥é‡é—®é¢˜" class="toc-link">useEffect çš„ 7 ä¸ªä¸¥é‡é—®é¢˜</a>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-1-ä»£ç å†—é•¿-æ ·æ¿ä»£ç è¿‡å¤š" class="toc-link">é—®é¢˜ 1: ä»£ç å†—é•¿ï¼Œæ ·æ¿ä»£ç è¿‡å¤š ğŸ“</a>
    <li class="toc-item toc-level-4">
      <a href="#ä½¿ç”¨-useeffect-çš„ä¼ ç»Ÿæ–¹å¼" class="toc-link">âŒ ä½¿ç”¨ useEffect çš„ä¼ ç»Ÿæ–¹å¼</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#ä½¿ç”¨-react-query-çš„æ–¹å¼" class="toc-link">âœ… ä½¿ç”¨ React Query çš„æ–¹å¼</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-2-ç«æ€æ¡ä»¶-race-condition" class="toc-link">é—®é¢˜ 2: ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ğŸ›</a>
    <li class="toc-item toc-level-4">
      <a href="#ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶" class="toc-link">ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#useeffect-çš„ç«æ€é—®é¢˜ç¤ºä¾‹" class="toc-link">âŒ useEffect çš„ç«æ€é—®é¢˜ç¤ºä¾‹</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#å°è¯•ä¿®å¤-ä½†ä»ä¸å®Œç¾" class="toc-link">å°è¯•ä¿®å¤ï¼ˆä½†ä»ä¸å®Œç¾ï¼‰</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„è§£å†³æ–¹æ¡ˆ" class="toc-link">âœ… React Query çš„è§£å†³æ–¹æ¡ˆ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-3-é‡å¤è¯·æ±‚å’Œç¼“å­˜ç¼ºå¤±" class="toc-link">é—®é¢˜ 3: é‡å¤è¯·æ±‚å’Œç¼“å­˜ç¼ºå¤± ğŸ”„</a>
    <li class="toc-item toc-level-4">
      <a href="#useeffect-çš„é‡å¤è¯·æ±‚é—®é¢˜" class="toc-link">âŒ useEffect çš„é‡å¤è¯·æ±‚é—®é¢˜</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„è‡ªåŠ¨ç¼“å­˜" class="toc-link">âœ… React Query çš„è‡ªåŠ¨ç¼“å­˜</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-4-åŠ è½½çŠ¶æ€ç®¡ç†å¤æ‚" class="toc-link">é—®é¢˜ 4: åŠ è½½çŠ¶æ€ç®¡ç†å¤æ‚ ğŸ›ï¸</a>
    <li class="toc-item toc-level-4">
      <a href="#å¤šä¸ªæ•°æ®æºçš„çŠ¶æ€ç®¡ç†å™©æ¢¦" class="toc-link">âŒ å¤šä¸ªæ•°æ®æºçš„çŠ¶æ€ç®¡ç†å™©æ¢¦</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„ä¼˜é›…æ–¹æ¡ˆ" class="toc-link">âœ… React Query çš„ä¼˜é›…æ–¹æ¡ˆ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-5-çª—å£èšç„¦æ—¶æ•°æ®è¿‡æœŸ" class="toc-link">é—®é¢˜ 5: çª—å£èšç„¦æ—¶æ•°æ®è¿‡æœŸ ğŸªŸ</a>
    <li class="toc-item toc-level-4">
      <a href="#useeffect-ä¸ä¼šè‡ªåŠ¨åˆ·æ–°" class="toc-link">âŒ useEffect ä¸ä¼šè‡ªåŠ¨åˆ·æ–°</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„æ™ºèƒ½åˆ·æ–°" class="toc-link">âœ… React Query çš„æ™ºèƒ½åˆ·æ–°</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-6-ä¹è§‚æ›´æ–°å›°éš¾" class="toc-link">é—®é¢˜ 6: ä¹è§‚æ›´æ–°å›°éš¾ âš¡</a>
    <li class="toc-item toc-level-4">
      <a href="#useeffect-å®ç°ä¹è§‚æ›´æ–°-å¤æ‚" class="toc-link">âŒ useEffect å®ç°ä¹è§‚æ›´æ–°ï¼ˆå¤æ‚ï¼‰</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„ä¹è§‚æ›´æ–°-å†…ç½®æ”¯æŒ" class="toc-link">âœ… React Query çš„ä¹è§‚æ›´æ–°ï¼ˆå†…ç½®æ”¯æŒï¼‰</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#é—®é¢˜-7-è½®è¯¢å’Œå®æ—¶æ›´æ–°" class="toc-link">é—®é¢˜ 7: è½®è¯¢å’Œå®æ—¶æ›´æ–° ğŸ”„</a>
    <li class="toc-item toc-level-4">
      <a href="#useeffect-æ‰‹åŠ¨è½®è¯¢" class="toc-link">âŒ useEffect æ‰‹åŠ¨è½®è¯¢</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#react-query-çš„æ™ºèƒ½è½®è¯¢" class="toc-link">âœ… React Query çš„æ™ºèƒ½è½®è¯¢</a>
    </ul>
  </li>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#react-query-å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜" class="toc-link">React Query å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜</a>
    <li class="toc-item toc-level-3">
      <a href="#æ ¸å¿ƒè®¾è®¡ç†å¿µ" class="toc-link">ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ ¸å¿ƒæœºåˆ¶" class="toc-link">ğŸ› ï¸ æ ¸å¿ƒæœºåˆ¶</a>
    <li class="toc-item toc-level-4">
      <a href="#1-åŸºäº-key-çš„ç¼“å­˜ç³»ç»Ÿ" class="toc-link">1. åŸºäº Key çš„ç¼“å­˜ç³»ç»Ÿ</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#2-è‡ªåŠ¨å–æ¶ˆè¿‡æœŸè¯·æ±‚" class="toc-link">2. è‡ªåŠ¨å–æ¶ˆè¿‡æœŸè¯·æ±‚</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#3-æ™ºèƒ½çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥" class="toc-link">3. æ™ºèƒ½çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#4-è‡ªåŠ¨çš„åå°é‡æ–°éªŒè¯" class="toc-link">4. è‡ªåŠ¨çš„åå°é‡æ–°éªŒè¯</a>
    </ul>
  </li>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#å®é™…é¡¹ç›®å¯¹æ¯”" class="toc-link">å®é™…é¡¹ç›®å¯¹æ¯”</a>
    <li class="toc-item toc-level-3">
      <a href="#åœºæ™¯-ç”¨æˆ·åˆ—è¡¨é¡µé¢" class="toc-link">åœºæ™¯ï¼šç”¨æˆ·åˆ—è¡¨é¡µé¢</a>
    <li class="toc-item toc-level-4">
      <a href="#ä½¿ç”¨-useeffect-120-è¡Œä»£ç " class="toc-link">âŒ ä½¿ç”¨ useEffect (120 è¡Œä»£ç )</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#ä½¿ç”¨-react-query-30-è¡Œä»£ç " class="toc-link">âœ… ä½¿ç”¨ React Query (30 è¡Œä»£ç )</a>
    </ul>
  </li>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æ€§èƒ½å’Œä½“éªŒæå‡" class="toc-link">æ€§èƒ½å’Œä½“éªŒæå‡</a>
    <li class="toc-item toc-level-3">
      <a href="#æ€§èƒ½å¯¹æ¯”" class="toc-link">ğŸ“Š æ€§èƒ½å¯¹æ¯”</a>
    <li class="toc-item toc-level-4">
      <a href="#åœºæ™¯-1-ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾" class="toc-link">åœºæ™¯ 1: ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#åœºæ™¯-2-å¤šç»„ä»¶å…±äº«æ•°æ®" class="toc-link">åœºæ™¯ 2: å¤šç»„ä»¶å…±äº«æ•°æ®</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#åœºæ™¯-3-ç¦»çº¿åé‡è¿" class="toc-link">åœºæ™¯ 3: ç¦»çº¿åé‡è¿</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#ç”¨æˆ·ä½“éªŒæå‡" class="toc-link">ğŸ’¡ ç”¨æˆ·ä½“éªŒæå‡</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#ä½•æ—¶ä»éœ€è¦-useeffect" class="toc-link">ä½•æ—¶ä»éœ€è¦ useEffect</a>
    <li class="toc-item toc-level-3">
      <a href="#useeffect-çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯" class="toc-link">âœ… useEffect çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯</a>
    <li class="toc-item toc-level-4">
      <a href="#1-éæ•°æ®è·å–çš„å‰¯ä½œç”¨" class="toc-link">1. éæ•°æ®è·å–çš„å‰¯ä½œç”¨</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#2-dom-æ“ä½œ" class="toc-link">2. DOM æ“ä½œ</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#3-è®¢é˜…å¤–éƒ¨æ•°æ®æº" class="toc-link">3. è®¢é˜…å¤–éƒ¨æ•°æ®æº</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#4-åŒæ­¥-react-çŠ¶æ€åˆ°å¤–éƒ¨ç³»ç»Ÿ" class="toc-link">4. åŒæ­¥ React çŠ¶æ€åˆ°å¤–éƒ¨ç³»ç»Ÿ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#ä¸è¦ç”¨-useeffect-åšæ•°æ®è·å–" class="toc-link">âŒ ä¸è¦ç”¨ useEffect åšæ•°æ®è·å–</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#è¿ç§»æŒ‡å—" class="toc-link">è¿ç§»æŒ‡å—</a>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-1-å®‰è£…-react-query" class="toc-link">æ­¥éª¤ 1: å®‰è£… React Query</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-2-è®¾ç½®-queryclient" class="toc-link">æ­¥éª¤ 2: è®¾ç½® QueryClient</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-3-è¿ç§»ç¬¬ä¸€ä¸ªç»„ä»¶" class="toc-link">æ­¥éª¤ 3: è¿ç§»ç¬¬ä¸€ä¸ªç»„ä»¶</a>
    <li class="toc-item toc-level-4">
      <a href="#before-useeffect" class="toc-link">Before (useEffect)</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#after-react-query" class="toc-link">After (React Query)</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-4-è¿ç§»å¸¦å‚æ•°çš„è¯·æ±‚" class="toc-link">æ­¥éª¤ 4: è¿ç§»å¸¦å‚æ•°çš„è¯·æ±‚</a>
    <li class="toc-item toc-level-4">
      <a href="#before" class="toc-link">Before</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#after" class="toc-link">After</a>
    </ul>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ­¥éª¤-5-è¿ç§»-post-put-delete-æ“ä½œ" class="toc-link">æ­¥éª¤ 5: è¿ç§» POST/PUT/DELETE æ“ä½œ</a>
    <li class="toc-item toc-level-4">
      <a href="#before" class="toc-link">Before</a>
  </li>
    <li class="toc-item toc-level-4">
      <a href="#after" class="toc-link">After</a>
    </ul>
  </li>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#å¸¸è§é—®é¢˜è§£ç­”" class="toc-link">å¸¸è§é—®é¢˜è§£ç­”</a>
    <li class="toc-item toc-level-3">
      <a href="#q1-react-query-ä¼šå¢åŠ åŒ…ä½“ç§¯å—" class="toc-link">Q1: React Query ä¼šå¢åŠ åŒ…ä½“ç§¯å—ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q2-å­¦ä¹ -react-query-éš¾å—" class="toc-link">Q2: å­¦ä¹  React Query éš¾å—ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q3-å¦‚ä½•å¤„ç†éœ€è¦ç«‹å³æ‰§è¡Œçš„è¯·æ±‚" class="toc-link">Q3: å¦‚ä½•å¤„ç†éœ€è¦ç«‹å³æ‰§è¡Œçš„è¯·æ±‚ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q4-å¦‚ä½•å¤„ç†ä¾èµ–å…¶ä»–æ•°æ®çš„è¯·æ±‚" class="toc-link">Q4: å¦‚ä½•å¤„ç†ä¾èµ–å…¶ä»–æ•°æ®çš„è¯·æ±‚ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q5-useeffect-çš„ä¾èµ–æ•°ç»„åœ¨-react-query-ä¸­å¦‚ä½•ä½“ç°" class="toc-link">Q5: useEffect çš„ä¾èµ–æ•°ç»„åœ¨ React Query ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q6-å¦‚ä½•æ¸…ç©ºç¼“å­˜" class="toc-link">Q6: å¦‚ä½•æ¸…ç©ºç¼“å­˜ï¼Ÿ</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#q7-react-query-ä¸-redux-æœ‰ä»€ä¹ˆåŒºåˆ«" class="toc-link">Q7: React Query ä¸ Redux æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a>
    </ul>
  </li>
    <li class="toc-item toc-level-2">
      <a href="#æ€»ç»“" class="toc-link">æ€»ç»“</a>
    <li class="toc-item toc-level-3">
      <a href="#æ ¸å¿ƒè¦ç‚¹" class="toc-link">ğŸ¯ æ ¸å¿ƒè¦ç‚¹</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#è¿ç§»å¸¦æ¥çš„ä»·å€¼" class="toc-link">ğŸ“ˆ è¿ç§»å¸¦æ¥çš„ä»·å€¼</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#ç«‹å³å¼€å§‹" class="toc-link">ğŸš€ ç«‹å³å¼€å§‹</a>
  </li>
    <li class="toc-item toc-level-3">
      <a href="#æ¨èèµ„æº" class="toc-link">ğŸ“š æ¨èèµ„æº</a>
    </ul>
  </li>
    </ul>
  </li>
  </li>
  </ul>
</nav>

<div class="content">
<h1 id="react-query-vs-useeffect-ä¸ºä»€ä¹ˆè¦æ›¿æ¢æ•°æ®è·å–æ–¹å¼">React Query vs useEffectï¼šä¸ºä»€ä¹ˆè¦æ›¿æ¢æ•°æ®è·å–æ–¹å¼ï¼Ÿ</h1>
<blockquote>
<p><strong>æ–‡æ¡£ç›®çš„</strong>: æ·±å…¥è§£é‡Šä¸ºä»€ä¹ˆåœ¨æ•°æ®è·å–åœºæ™¯ä¸‹ï¼ŒReact Query æ¯”ä¼ ç»Ÿçš„ useEffect æ–¹å¼æ›´ä¼˜ç§€<br><strong>é€‚ç”¨è¯»è€…</strong>: React å¼€å‘è€…ï¼Œç‰¹åˆ«æ˜¯ä¹ æƒ¯ä½¿ç”¨ useEffect è¿›è¡Œæ•°æ®è·å–çš„å¼€å‘è€…<br><strong>é˜…è¯»æ—¶é—´</strong>: 15-20 åˆ†é’Ÿ<br><strong>æ›´æ–°æ—¥æœŸ</strong>: 2025-11-05</p>
</blockquote>
<hr>
<h2 id="ç›®å½•">ğŸ“‘ ç›®å½•</h2>
<ol>
<li><a href="#%E6%A0%B8%E5%BF%83%E8%A7%82%E7%82%B9">æ ¸å¿ƒè§‚ç‚¹</a></li>
<li><a href="#useeffect-%E7%9A%84-7-%E4%B8%AA%E4%B8%A5%E9%87%8D%E9%97%AE%E9%A2%98">useEffect çš„ 7 ä¸ªä¸¥é‡é—®é¢˜</a></li>
<li><a href="#react-query-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%BF%99%E4%BA%9B%E9%97%AE%E9%A2%98">React Query å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜</a></li>
<li><a href="#%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E5%AF%B9%E6%AF%94">å®é™…é¡¹ç›®å¯¹æ¯”</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E5%92%8C%E4%BD%93%E9%AA%8C%E6%8F%90%E5%8D%87">æ€§èƒ½å’Œä½“éªŒæå‡</a></li>
<li><a href="#%E4%BD%95%E6%97%B6%E4%BB%8D%E9%9C%80%E8%A6%81-useeffect">ä½•æ—¶ä»éœ€è¦ useEffect</a></li>
<li><a href="#%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97">è¿ç§»æŒ‡å—</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94">å¸¸è§é—®é¢˜è§£ç­”</a></li>
</ol>
<hr>
<h2 id="æ ¸å¿ƒè§‚ç‚¹">æ ¸å¿ƒè§‚ç‚¹</h2>
<h3 id="ä¸€å¥è¯æ€»ç»“">ğŸ¯ ä¸€å¥è¯æ€»ç»“</h3>
<p><strong>useEffect æ˜¯ä¸ºå‰¯ä½œç”¨è®¾è®¡çš„ï¼Œä¸æ˜¯ä¸ºæ•°æ®è·å–è®¾è®¡çš„ã€‚React Query æ˜¯ä¸“é—¨ä¸ºæ•°æ®è·å–è®¾è®¡çš„ï¼Œè§£å†³äº† useEffect åœ¨æ•°æ®è·å–åœºæ™¯ä¸‹çš„æ‰€æœ‰ç—›ç‚¹ã€‚</strong></p>
<h3 id="å…³é”®æ•°æ®">ğŸ“Š å…³é”®æ•°æ®</h3>
<ul>
<li><strong>ä»£ç é‡å‡å°‘</strong>: 70-90%</li>
<li><strong>Bug å‡å°‘</strong>: çº¦ 60-70%ï¼ˆé¿å…ç«æ€æ¡ä»¶ã€å†…å­˜æ³„æ¼ç­‰ï¼‰</li>
<li><strong>æ€§èƒ½æå‡</strong>: è¯·æ±‚å»é‡ + æ™ºèƒ½ç¼“å­˜</li>
<li><strong>å¼€å‘æ•ˆç‡</strong>: æå‡ 3-5 å€</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: æ˜¾è‘—æ”¹å–„ï¼ˆæ›´å¿«çš„å“åº”ã€æ›´å°‘çš„é—ªçƒï¼‰</li>
</ul>
<hr>
<h2 id="useeffect-çš„-7-ä¸ªä¸¥é‡é—®é¢˜">useEffect çš„ 7 ä¸ªä¸¥é‡é—®é¢˜</h2>
<h3 id="é—®é¢˜-1-ä»£ç å†—é•¿-æ ·æ¿ä»£ç è¿‡å¤š">é—®é¢˜ 1: ä»£ç å†—é•¿ï¼Œæ ·æ¿ä»£ç è¿‡å¤š ğŸ“</h3>
<h4 id="ä½¿ç”¨-useeffect-çš„ä¼ ç»Ÿæ–¹å¼">âŒ ä½¿ç”¨ useEffect çš„ä¼ ç»Ÿæ–¹å¼</h4>
<pre><code class="language-typescript">function UserDashboard() {
  // çŠ¶æ€ç®¡ç† - éœ€è¦ 3 ä¸ªçŠ¶æ€
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() =&gt; {
    // é˜²æ­¢å†…å­˜æ³„æ¼çš„æ ‡å¿—
    let cancelled = false
    
    // è®¾ç½®åŠ è½½çŠ¶æ€
    setLoading(true)
    setError(null)
    
    // å‘èµ·è¯·æ±‚
    fetchUserData()
      .then(result =&gt; {
        // æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ
        if (!cancelled) {
          setData(result)
          setError(null)
        }
      })
      .catch(err =&gt; {
        // æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ
        if (!cancelled) {
          setError(err.message)
          setData(null)
        }
      })
      .finally(() =&gt; {
        // æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ
        if (!cancelled) {
          setLoading(false)
        }
      })

    // æ¸…ç†å‡½æ•° - é˜²æ­¢å†…å­˜æ³„æ¼
    return () =&gt; {
      cancelled = true
    }
  }, []) // ç©ºä¾èµ–æ•°ç»„

  // æ¸²æŸ“é€»è¾‘
  if (loading) return &lt;LoadingSpinner /&gt;
  if (error) return &lt;ErrorMessage message={error} /&gt;
  if (!data) return null

  return &lt;div&gt;{/* æ¸²æŸ“æ•°æ® */}&lt;/div&gt;
}
</code></pre>
<p><strong>ä»£ç è¡Œæ•°</strong>: ~45 è¡Œ<br><strong>éœ€è¦ç®¡ç†</strong>: 3 ä¸ªçŠ¶æ€å˜é‡ + 1 ä¸ªå–æ¶ˆæ ‡å¿— + æ¸…ç†é€»è¾‘</p>
<hr>
<h4 id="ä½¿ç”¨-react-query-çš„æ–¹å¼">âœ… ä½¿ç”¨ React Query çš„æ–¹å¼</h4>
<pre><code class="language-typescript">function UserDashboard() {
  const { data, isLoading, error } = useQuery({
    queryKey: [&#39;userData&#39;],
    queryFn: fetchUserData,
  })

  if (isLoading) return &lt;LoadingSpinner /&gt;
  if (error) return &lt;ErrorMessage message={error.message} /&gt;

  return &lt;div&gt;{/* æ¸²æŸ“æ•°æ® */}&lt;/div&gt;
}
</code></pre>
<p><strong>ä»£ç è¡Œæ•°</strong>: ~10 è¡Œ<br><strong>ä»£ç å‡å°‘</strong>: 78% â¬‡ï¸<br><strong>è‡ªåŠ¨å¤„ç†</strong>: ç¼“å­˜ã€å–æ¶ˆã€é”™è¯¯ã€åŠ è½½çŠ¶æ€</p>
<hr>
<h3 id="é—®é¢˜-2-ç«æ€æ¡ä»¶-race-condition">é—®é¢˜ 2: ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ğŸ›</h3>
<p>è¿™æ˜¯ useEffect æœ€ä¸¥é‡çš„ Bug ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«å¿½è§†çš„ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶">ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶ï¼Ÿ</h4>
<p>å½“ç”¨æˆ·å¿«é€Ÿæ“ä½œï¼ˆå¦‚å¿«é€Ÿåˆ‡æ¢é€‰é¡¹å¡ï¼‰ï¼Œå¤šä¸ªå¼‚æ­¥è¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œå“åº”é¡ºåºå¯èƒ½ä¸è¯·æ±‚é¡ºåºä¸ä¸€è‡´ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯çš„æ•°æ®ã€‚</p>
<h4 id="useeffect-çš„ç«æ€é—®é¢˜ç¤ºä¾‹">âŒ useEffect çš„ç«æ€é—®é¢˜ç¤ºä¾‹</h4>
<pre><code class="language-typescript">function UserProfile({ userId }) {
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(false)

  useEffect(() =&gt; {
    setLoading(true)
    
    // ğŸ› BUG: æ²¡æœ‰å–æ¶ˆæœºåˆ¶
    fetchUser(userId)
      .then(data =&gt; {
        setUser(data)
        setLoading(false)
      })
  }, [userId])

  return &lt;div&gt;{user?.name}&lt;/div&gt;
}
</code></pre>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong></p>
<pre><code>æ—¶é—´çº¿ï¼š
t=0ms    ç”¨æˆ·ç‚¹å‡» userId=1 â†’ å‘é€è¯·æ±‚1 (éœ€è¦ 500ms)
t=100ms  ç”¨æˆ·ç‚¹å‡» userId=2 â†’ å‘é€è¯·æ±‚2 (éœ€è¦ 200ms)
t=200ms  ç”¨æˆ·ç‚¹å‡» userId=3 â†’ å‘é€è¯·æ±‚3 (éœ€è¦ 100ms)

å“åº”é¡ºåºï¼ˆæ ¹æ®ç½‘ç»œå»¶è¿Ÿï¼‰ï¼š
t=300ms  è¯·æ±‚3è¿”å› â†’ setUser(user3) âœ…
t=300ms  è¯·æ±‚2è¿”å› â†’ setUser(user2) âŒ è¦†ç›–äº† user3
t=500ms  è¯·æ±‚1è¿”å› â†’ setUser(user1) âŒ è¦†ç›–äº† user2

æœ€ç»ˆç»“æœï¼šæ˜¾ç¤º user1 çš„æ•°æ® âŒ
æœŸæœ›ç»“æœï¼šæ˜¾ç¤º user3 çš„æ•°æ® âœ…
</code></pre>
<h4 id="å°è¯•ä¿®å¤-ä½†ä»ä¸å®Œç¾">å°è¯•ä¿®å¤ï¼ˆä½†ä»ä¸å®Œç¾ï¼‰</h4>
<pre><code class="language-typescript">function UserProfile({ userId }) {
  const [user, setUser] = useState(null)

  useEffect(() =&gt; {
    let cancelled = false // æ·»åŠ å–æ¶ˆæ ‡å¿—

    fetchUser(userId).then(data =&gt; {
      if (!cancelled) { // æ£€æŸ¥æ˜¯å¦å–æ¶ˆ
        setUser(data)
      }
    })

    return () =&gt; {
      cancelled = true // ç»„ä»¶å¸è½½æˆ– userId å˜åŒ–æ—¶å–æ¶ˆ
    }
  }, [userId])

  return &lt;div&gt;{user?.name}&lt;/div&gt;
}
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ol>
<li>è™½ç„¶é¿å…äº†è®¾ç½®çŠ¶æ€ï¼Œä½†è¯·æ±‚ä»åœ¨è¿›è¡Œï¼ˆæµªè´¹å¸¦å®½ï¼‰</li>
<li>éœ€è¦åœ¨æ¯ä¸ªç»„ä»¶ä¸­é‡å¤è¿™ä¸ªé€»è¾‘</li>
<li>å®¹æ˜“å¿˜è®°æ·»åŠ å–æ¶ˆé€»è¾‘</li>
<li>å¦‚æœä½¿ç”¨ axiosï¼Œéœ€è¦é¢å¤–çš„ CancelToken é€»è¾‘</li>
</ol>
<hr>
<h4 id="react-query-çš„è§£å†³æ–¹æ¡ˆ">âœ… React Query çš„è§£å†³æ–¹æ¡ˆ</h4>
<pre><code class="language-typescript">function UserProfile({ userId }) {
  const { data: user } = useQuery({
    queryKey: [&#39;user&#39;, userId],
    queryFn: () =&gt; fetchUser(userId),
  })

  return &lt;div&gt;{user?.name}&lt;/div&gt;
}
</code></pre>
<p><strong>React Query å¦‚ä½•è§£å†³ï¼š</strong></p>
<ol>
<li>âœ… è‡ªåŠ¨å–æ¶ˆè¿‡æœŸçš„è¯·æ±‚ï¼ˆçœŸæ­£çš„ç½‘ç»œå±‚å–æ¶ˆï¼‰</li>
<li>âœ… é€šè¿‡ queryKey ç®¡ç†è¯·æ±‚å”¯ä¸€æ€§</li>
<li>âœ… ä¿è¯åªæ˜¾ç¤ºæœ€æ–° queryKey å¯¹åº”çš„æ•°æ®</li>
<li>âœ… é›¶é¢å¤–ä»£ç </li>
</ol>
<hr>
<h3 id="é—®é¢˜-3-é‡å¤è¯·æ±‚å’Œç¼“å­˜ç¼ºå¤±">é—®é¢˜ 3: é‡å¤è¯·æ±‚å’Œç¼“å­˜ç¼ºå¤± ğŸ”„</h3>
<h4 id="useeffect-çš„é‡å¤è¯·æ±‚é—®é¢˜">âŒ useEffect çš„é‡å¤è¯·æ±‚é—®é¢˜</h4>
<pre><code class="language-typescript">// åœºæ™¯ï¼šDashboard å’Œ Sidebar åŒæ—¶éœ€è¦ç”¨æˆ·åˆ—è¡¨

// Dashboard ç»„ä»¶
function Dashboard() {
  const [users, setUsers] = useState([])

  useEffect(() =&gt; {
    fetchUsers().then(setUsers) // è¯·æ±‚1
  }, [])

  return &lt;UserList users={users} /&gt;
}

// Sidebar ç»„ä»¶ï¼ˆåŒæ—¶æ¸²æŸ“ï¼‰
function Sidebar() {
  const [users, setUsers] = useState([])

  useEffect(() =&gt; {
    fetchUsers().then(setUsers) // è¯·æ±‚2ï¼ˆé‡å¤ï¼ï¼‰
  }, [])

  return &lt;UserCount count={users.length} /&gt;
}
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ol>
<li>å‘é€äº† 2 æ¬¡ç›¸åŒçš„è¯·æ±‚ï¼ˆæµªè´¹å¸¦å®½ï¼‰</li>
<li>ç”¨æˆ·çœ‹åˆ°ä¸¤æ¬¡åŠ è½½çŠ¶æ€</li>
<li>æ•°æ®å¯èƒ½ä¸ä¸€è‡´ï¼ˆä¸¤æ¬¡è¯·æ±‚ä¹‹é—´æ•°æ®å¯èƒ½å˜åŒ–ï¼‰</li>
</ol>
<p><strong>å°è¯•æ‰‹åŠ¨ç¼“å­˜ï¼ˆå¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼‰ï¼š</strong></p>
<pre><code class="language-typescript">// éœ€è¦åˆ›å»ºå…¨å±€ç¼“å­˜
const cache = new Map()

function useFetchUsers() {
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(false)

  useEffect(() =&gt; {
    // æ£€æŸ¥ç¼“å­˜
    if (cache.has(&#39;users&#39;)) {
      setUsers(cache.get(&#39;users&#39;))
      return
    }

    // å‘èµ·è¯·æ±‚
    setLoading(true)
    fetchUsers().then(data =&gt; {
      cache.set(&#39;users&#39;, data) // å­˜å…¥ç¼“å­˜
      setUsers(data)
      setLoading(false)
    })
  }, [])

  return { users, loading }
}
</code></pre>
<p><strong>æ–°é—®é¢˜ï¼š</strong></p>
<ol>
<li>ä½•æ—¶æ›´æ–°ç¼“å­˜ï¼Ÿ</li>
<li>ç¼“å­˜ä½•æ—¶è¿‡æœŸï¼Ÿ</li>
<li>å¦‚ä½•æ¸…é™¤ç¼“å­˜ï¼Ÿ</li>
<li>å¤šä¸ªå‚æ•°å¦‚ä½•ä½œä¸ºç¼“å­˜ keyï¼Ÿ</li>
<li>éœ€è¦æ‰‹åŠ¨ç®¡ç†ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ</li>
</ol>
<hr>
<h4 id="react-query-çš„è‡ªåŠ¨ç¼“å­˜">âœ… React Query çš„è‡ªåŠ¨ç¼“å­˜</h4>
<pre><code class="language-typescript">// Dashboard ç»„ä»¶
function Dashboard() {
  const { data: users } = useQuery({
    queryKey: [&#39;users&#39;],
    queryFn: fetchUsers,
  })

  return &lt;UserList users={users} /&gt;
}

// Sidebar ç»„ä»¶
function Sidebar() {
  const { data: users } = useQuery({
    queryKey: [&#39;users&#39;],
    queryFn: fetchUsers, // âœ… ä¸ä¼šå‘é€è¯·æ±‚ï¼ä½¿ç”¨ç¼“å­˜
  })

  return &lt;UserCount count={users?.length || 0} /&gt;
}
</code></pre>
<p><strong>React Query çš„æ™ºèƒ½ç¼“å­˜ï¼š</strong></p>
<ol>
<li>âœ… è‡ªåŠ¨å»é‡ - ç›¸åŒ queryKey åªå‘é€ä¸€æ¬¡è¯·æ±‚</li>
<li>âœ… è‡ªåŠ¨ç¼“å­˜ - æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­</li>
<li>âœ… è‡ªåŠ¨è¿‡æœŸ - å¯é…ç½® staleTime</li>
<li>âœ… è‡ªåŠ¨é‡æ–°éªŒè¯ - è¿‡æœŸåè‡ªåŠ¨åˆ·æ–°</li>
<li>âœ… é›¶é…ç½® - å¼€ç®±å³ç”¨</li>
</ol>
<hr>
<h3 id="é—®é¢˜-4-åŠ è½½çŠ¶æ€ç®¡ç†å¤æ‚">é—®é¢˜ 4: åŠ è½½çŠ¶æ€ç®¡ç†å¤æ‚ ğŸ›ï¸</h3>
<h4 id="å¤šä¸ªæ•°æ®æºçš„çŠ¶æ€ç®¡ç†å™©æ¢¦">âŒ å¤šä¸ªæ•°æ®æºçš„çŠ¶æ€ç®¡ç†å™©æ¢¦</h4>
<pre><code class="language-typescript">function ComplexDashboard() {
  // ç”¨æˆ·æ•°æ®
  const [users, setUsers] = useState(null)
  const [usersLoading, setUsersLoading] = useState(false)
  const [usersError, setUsersError] = useState(null)

  // è®¢å•æ•°æ®
  const [orders, setOrders] = useState(null)
  const [ordersLoading, setOrdersLoading] = useState(false)
  const [ordersError, setOrdersError] = useState(null)

  // äº§å“æ•°æ®
  const [products, setProducts] = useState(null)
  const [productsLoading, setProductsLoading] = useState(false)
  const [productsError, setProductsError] = useState(null)

  // ç»Ÿè®¡æ•°æ®
  const [stats, setStats] = useState(null)
  const [statsLoading, setStatsLoading] = useState(false)
  const [statsError, setStatsError] = useState(null)

  useEffect(() =&gt; {
    setUsersLoading(true)
    fetchUsers()
      .then(setUsers)
      .catch(setUsersError)
      .finally(() =&gt; setUsersLoading(false))
  }, [])

  useEffect(() =&gt; {
    setOrdersLoading(true)
    fetchOrders()
      .then(setOrders)
      .catch(setOrdersError)
      .finally(() =&gt; setOrdersLoading(false))
  }, [])

  useEffect(() =&gt; {
    setProductsLoading(true)
    fetchProducts()
      .then(setProducts)
      .catch(setProductsError)
      .finally(() =&gt; setProductsLoading(false))
  }, [])

  useEffect(() =&gt; {
    setStatsLoading(true)
    fetchStats()
      .then(setStats)
      .catch(setStatsError)
      .finally(() =&gt; setStatsLoading(false))
  }, [])

  // ğŸ˜µ éœ€è¦åè°ƒæ‰€æœ‰çŠ¶æ€
  const isLoading = usersLoading || ordersLoading || productsLoading || statsLoading
  const hasError = usersError || ordersError || productsError || statsError

  // ğŸ˜µ ç»„ä»¶æœ‰ 12 ä¸ªçŠ¶æ€å˜é‡ï¼
}
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li>12 ä¸ªçŠ¶æ€å˜é‡ï¼ˆæ•°æ® + åŠ è½½ + é”™è¯¯ï¼‰Ã— 4</li>
<li>4 ä¸ª useEffect</li>
<li>éš¾ä»¥ç»´æŠ¤</li>
<li>å®¹æ˜“å‡ºé”™</li>
</ul>
<hr>
<h4 id="react-query-çš„ä¼˜é›…æ–¹æ¡ˆ">âœ… React Query çš„ä¼˜é›…æ–¹æ¡ˆ</h4>
<pre><code class="language-typescript">function ComplexDashboard() {
  const users = useQuery({ queryKey: [&#39;users&#39;], queryFn: fetchUsers })
  const orders = useQuery({ queryKey: [&#39;orders&#39;], queryFn: fetchOrders })
  const products = useQuery({ queryKey: [&#39;products&#39;], queryFn: fetchProducts })
  const stats = useQuery({ queryKey: [&#39;stats&#39;], queryFn: fetchStats })

  // âœ… æ¸…æ™°ç®€æ´
  const isLoading = users.isLoading || orders.isLoading || products.isLoading || stats.isLoading
  const hasError = users.error || orders.error || products.error || stats.error

  // æ¯ä¸ªæŸ¥è¯¢ç‹¬ç«‹ç®¡ç†ï¼Œä½†å¯ä»¥ç»„åˆ
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>4 è¡ŒæŸ¥è¯¢ä»£ç </li>
<li>æ¯ä¸ªæŸ¥è¯¢ç‹¬ç«‹</li>
<li>æ˜“äºç»„åˆå’Œæ¡ä»¶åŒ–</li>
<li>ç±»å‹å®‰å…¨</li>
</ul>
<hr>
<h3 id="é—®é¢˜-5-çª—å£èšç„¦æ—¶æ•°æ®è¿‡æœŸ">é—®é¢˜ 5: çª—å£èšç„¦æ—¶æ•°æ®è¿‡æœŸ ğŸªŸ</h3>
<h4 id="useeffect-ä¸ä¼šè‡ªåŠ¨åˆ·æ–°">âŒ useEffect ä¸ä¼šè‡ªåŠ¨åˆ·æ–°</h4>
<pre><code class="language-typescript">function StockPrice() {
  const [price, setPrice] = useState(null)

  useEffect(() =&gt; {
    fetchStockPrice().then(setPrice)
  }, [])

  return &lt;div&gt;å½“å‰ä»·æ ¼: ${price}&lt;/div&gt;
}
</code></pre>
<p><strong>ç”¨æˆ·åœºæ™¯ï¼š</strong></p>
<pre><code>1. ç”¨æˆ·æ‰“å¼€è‚¡ç¥¨é¡µé¢ï¼Œçœ‹åˆ°ä»·æ ¼ $100
2. ç”¨æˆ·åˆ‡æ¢åˆ°é‚®ä»¶æ ‡ç­¾é¡µå·¥ä½œ 10 åˆ†é’Ÿ
3. è¿™æœŸé—´è‚¡ç¥¨æ¶¨åˆ° $150
4. ç”¨æˆ·åˆ‡å›æ¥ï¼Œä»ç„¶çœ‹åˆ° $100 âŒ
</code></pre>
<p><strong>å°è¯•ä¿®å¤ï¼š</strong></p>
<pre><code class="language-typescript">function StockPrice() {
  const [price, setPrice] = useState(null)

  useEffect(() =&gt; {
    fetchStockPrice().then(setPrice)
  }, [])

  // éœ€è¦æ‰‹åŠ¨æ·»åŠ ç„¦ç‚¹ç›‘å¬
  useEffect(() =&gt; {
    const handleFocus = () =&gt; {
      fetchStockPrice().then(setPrice)
    }

    window.addEventListener(&#39;focus&#39;, handleFocus)
    return () =&gt; window.removeEventListener(&#39;focus&#39;, handleFocus)
  }, [])

  return &lt;div&gt;å½“å‰ä»·æ ¼: ${price}&lt;/div&gt;
}
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li>æ¯æ¬¡èšç„¦éƒ½åˆ·æ–°ï¼ˆå³ä½¿æ•°æ®åˆšè·å–ï¼‰</li>
<li>éœ€è¦åœ¨æ¯ä¸ªç»„ä»¶é‡å¤è¿™ä¸ªé€»è¾‘</li>
</ul>
<hr>
<h4 id="react-query-çš„æ™ºèƒ½åˆ·æ–°">âœ… React Query çš„æ™ºèƒ½åˆ·æ–°</h4>
<pre><code class="language-typescript">function StockPrice() {
  const { data: price } = useQuery({
    queryKey: [&#39;stockPrice&#39;],
    queryFn: fetchStockPrice,
    staleTime: 2 * 60 * 1000, // 2åˆ†é’Ÿå†…è®¤ä¸ºæ•°æ®æ–°é²œ
    refetchOnWindowFocus: true, // âœ… é»˜è®¤å¼€å¯
  })

  return &lt;div&gt;å½“å‰ä»·æ ¼: ${price}&lt;/div&gt;
}
</code></pre>
<p><strong>æ™ºèƒ½åˆ·æ–°é€»è¾‘ï¼š</strong></p>
<pre><code>1. ç”¨æˆ·æ‰“å¼€é¡µé¢ â†’ è·å–ä»·æ ¼
2. ç”¨æˆ·åˆ‡èµ° â†’ æ•°æ®åœ¨ 2 åˆ†é’Ÿå†…è®¤ä¸ºæ˜¯æ–°é²œçš„
3. 2 åˆ†é’Ÿåç”¨æˆ·å›æ¥ â†’ è‡ªåŠ¨åˆ·æ–°ï¼ˆæ•°æ®å·²è¿‡æœŸï¼‰
4. 2 åˆ†é’Ÿå†…ç”¨æˆ·å›æ¥ â†’ ä¸åˆ·æ–°ï¼ˆæ•°æ®ä»ç„¶æ–°é²œï¼‰
</code></pre>
<hr>
<h3 id="é—®é¢˜-6-ä¹è§‚æ›´æ–°å›°éš¾">é—®é¢˜ 6: ä¹è§‚æ›´æ–°å›°éš¾ âš¡</h3>
<p>ä¹è§‚æ›´æ–°æ˜¯æŒ‡ï¼šå…ˆæ›´æ–° UIï¼Œå†å‘é€è¯·æ±‚ï¼Œå¦‚æœå¤±è´¥åˆ™å›æ»šã€‚è¿™èƒ½æå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<h4 id="useeffect-å®ç°ä¹è§‚æ›´æ–°-å¤æ‚">âŒ useEffect å®ç°ä¹è§‚æ›´æ–°ï¼ˆå¤æ‚ï¼‰</h4>
<pre><code class="language-typescript">function TodoList() {
  const [todos, setTodos] = useState([])

  const addTodo = async (text) =&gt; {
    // 1. ç”Ÿæˆä¸´æ—¶ ID
    const tempId = `temp-${Date.now()}`
    const tempTodo = { id: tempId, text, completed: false }

    // 2. ç«‹å³æ›´æ–° UIï¼ˆä¹è§‚ï¼‰
    setTodos(prev =&gt; [...prev, tempTodo])

    try {
      // 3. å‘é€è¯·æ±‚
      const newTodo = await createTodo(text)
      
      // 4. ç”¨çœŸå®æ•°æ®æ›¿æ¢ä¸´æ—¶æ•°æ®
      setTodos(prev =&gt; 
        prev.map(todo =&gt; todo.id === tempId ? newTodo : todo)
      )
    } catch (error) {
      // 5. å¤±è´¥æ—¶ç§»é™¤ä¸´æ—¶æ•°æ®ï¼ˆå›æ»šï¼‰
      setTodos(prev =&gt; prev.filter(todo =&gt; todo.id !== tempId))
      
      // 6. æ˜¾ç¤ºé”™è¯¯
      toast.error(&#39;æ·»åŠ å¤±è´¥&#39;)
    }
  }

  // ğŸ˜µ å¤æ‚çš„çŠ¶æ€æ›´æ–°é€»è¾‘
  // ğŸ˜µ å®¹æ˜“å‡ºé”™ï¼ˆå¿˜è®°å›æ»šã€çŠ¶æ€ä¸åŒæ­¥ç­‰ï¼‰
}
</code></pre>
<hr>
<h4 id="react-query-çš„ä¹è§‚æ›´æ–°-å†…ç½®æ”¯æŒ">âœ… React Query çš„ä¹è§‚æ›´æ–°ï¼ˆå†…ç½®æ”¯æŒï¼‰</h4>
<pre><code class="language-typescript">function TodoList() {
  const queryClient = useQueryClient()
  
  const { data: todos } = useQuery({
    queryKey: [&#39;todos&#39;],
    queryFn: fetchTodos,
  })

  const addTodoMutation = useMutation({
    mutationFn: createTodo,
    
    // ä¹è§‚æ›´æ–°
    onMutate: async (newTodoText) =&gt; {
      // 1. å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„æŸ¥è¯¢
      await queryClient.cancelQueries({ queryKey: [&#39;todos&#39;] })
      
      // 2. ä¿å­˜ä¹‹å‰çš„æ•°æ®ï¼ˆç”¨äºå›æ»šï¼‰
      const previousTodos = queryClient.getQueryData([&#39;todos&#39;])
      
      // 3. ä¹è§‚æ›´æ–°
      queryClient.setQueryData([&#39;todos&#39;], old =&gt; [
        ...old,
        { id: Date.now(), text: newTodoText, completed: false }
      ])
      
      // 4. è¿”å›ä¸Šä¸‹æ–‡ï¼ˆç”¨äºå›æ»šï¼‰
      return { previousTodos }
    },
    
    // å¤±è´¥æ—¶å›æ»š
    onError: (err, newTodo, context) =&gt; {
      queryClient.setQueryData([&#39;todos&#39;], context.previousTodos)
      toast.error(&#39;æ·»åŠ å¤±è´¥&#39;)
    },
    
    // æˆåŠŸåé‡æ–°éªŒè¯
    onSettled: () =&gt; {
      queryClient.invalidateQueries({ queryKey: [&#39;todos&#39;] })
    },
  })

  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; addTodoMutation.mutate(&#39;æ–°ä»»åŠ¡&#39;)}&gt;
        æ·»åŠ 
      &lt;/button&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… å®Œæ•´çš„ä¹è§‚æ›´æ–°æµç¨‹</li>
<li>âœ… è‡ªåŠ¨å›æ»šæœºåˆ¶</li>
<li>âœ… ç±»å‹å®‰å…¨</li>
<li>âœ… æ ‡å‡†åŒ–çš„å®ç°</li>
</ul>
<hr>
<h3 id="é—®é¢˜-7-è½®è¯¢å’Œå®æ—¶æ›´æ–°">é—®é¢˜ 7: è½®è¯¢å’Œå®æ—¶æ›´æ–° ğŸ”„</h3>
<h4 id="useeffect-æ‰‹åŠ¨è½®è¯¢">âŒ useEffect æ‰‹åŠ¨è½®è¯¢</h4>
<pre><code class="language-typescript">function RealtimeData() {
  const [data, setData] = useState(null)

  useEffect(() =&gt; {
    // ç«‹å³è·å–
    const fetchData = () =&gt; {
      fetch(&#39;/api/data&#39;).then(r =&gt; r.json()).then(setData)
    }

    fetchData()

    // æ¯ 3 ç§’è½®è¯¢
    const interval = setInterval(fetchData, 3000)

    // æ¸…ç†
    return () =&gt; clearInterval(interval)
  }, [])

  return &lt;div&gt;{data}&lt;/div&gt;
}
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ol>
<li>æ ‡ç­¾é¡µéšè—æ—¶ä»åœ¨è½®è¯¢ï¼ˆæµªè´¹èµ„æºï¼‰</li>
<li>ç”¨æˆ·ä¸åœ¨çº¿æ—¶ä»åœ¨è½®è¯¢ï¼ˆæµªè´¹èµ„æºï¼‰</li>
<li>é”™è¯¯å¤„ç†å¤æ‚</li>
<li>æ— æ³•åŠ¨æ€è°ƒæ•´è½®è¯¢é—´éš”</li>
</ol>
<hr>
<h4 id="react-query-çš„æ™ºèƒ½è½®è¯¢">âœ… React Query çš„æ™ºèƒ½è½®è¯¢</h4>
<pre><code class="language-typescript">function RealtimeData() {
  const { data } = useQuery({
    queryKey: [&#39;realtimeData&#39;],
    queryFn: fetchData,
    refetchInterval: 3000, // æ¯ 3 ç§’åˆ·æ–°
    refetchIntervalInBackground: false, // âœ… æ ‡ç­¾é¡µéšè—æ—¶åœæ­¢
    enabled: navigator.onLine, // âœ… ç¦»çº¿æ—¶åœæ­¢
  })

  return &lt;div&gt;{data}&lt;/div&gt;
}
</code></pre>
<p><strong>æ™ºèƒ½ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>âœ… æ ‡ç­¾é¡µå¯è§æ—¶æ‰è½®è¯¢</li>
<li>âœ… ç½‘ç»œç¦»çº¿æ—¶è‡ªåŠ¨åœæ­¢</li>
<li>âœ… ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†</li>
<li>âœ… å¯åŠ¨æ€è°ƒæ•´é—´éš”</li>
</ul>
<hr>
<h2 id="react-query-å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜">React Query å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜</h2>
<h3 id="æ ¸å¿ƒè®¾è®¡ç†å¿µ">ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ</h3>
<p>React Query ä¸“ä¸º<strong>å¼‚æ­¥çŠ¶æ€ç®¡ç†</strong>è®¾è®¡ï¼Œç‰¹åˆ«æ˜¯<strong>æœåŠ¡ç«¯çŠ¶æ€</strong>ï¼ˆServer Stateï¼‰ã€‚</p>
<p><strong>æœåŠ¡ç«¯çŠ¶æ€çš„ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li>å­˜å‚¨åœ¨è¿œç¨‹æœåŠ¡å™¨</li>
<li>éœ€è¦å¼‚æ­¥è·å–</li>
<li>å¯èƒ½è¢«å…¶ä»–äººä¿®æ”¹</li>
<li>ä¼šè¿‡æœŸï¼ˆstaleï¼‰</li>
<li>éœ€è¦ç¼“å­˜ä»¥æå‡æ€§èƒ½</li>
</ol>
<h3 id="æ ¸å¿ƒæœºåˆ¶">ğŸ› ï¸ æ ¸å¿ƒæœºåˆ¶</h3>
<h4 id="1-åŸºäº-key-çš„ç¼“å­˜ç³»ç»Ÿ">1. åŸºäº Key çš„ç¼“å­˜ç³»ç»Ÿ</h4>
<pre><code class="language-typescript">// queryKey å†³å®šæ•°æ®çš„å”¯ä¸€æ€§
useQuery({
  queryKey: [&#39;user&#39;, userId], // æ•°ç»„ä½œä¸º key
  queryFn: () =&gt; fetchUser(userId),
})

// ä¸åŒçš„ userId ä¼šæœ‰ä¸åŒçš„ç¼“å­˜
// userId=1 â†’ ç¼“å­˜A
// userId=2 â†’ ç¼“å­˜B
</code></pre>
<h4 id="2-è‡ªåŠ¨å–æ¶ˆè¿‡æœŸè¯·æ±‚">2. è‡ªåŠ¨å–æ¶ˆè¿‡æœŸè¯·æ±‚</h4>
<pre><code class="language-typescript">// å½“ queryKey å˜åŒ–æ—¶ï¼Œæ—§è¯·æ±‚è‡ªåŠ¨å–æ¶ˆ
// userId ä» 1 â†’ 2 â†’ 3
// è¯·æ±‚1 å’Œ è¯·æ±‚2 è‡ªåŠ¨å–æ¶ˆ
// åªæœ‰è¯·æ±‚3 çš„ç»“æœä¼šè¢«ä½¿ç”¨
</code></pre>
<h4 id="3-æ™ºèƒ½çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥">3. æ™ºèƒ½çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥</h4>
<pre><code class="language-typescript">useQuery({
  queryKey: [&#39;data&#39;],
  queryFn: fetchData,
  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿå†…æ•°æ®è§†ä¸ºæ–°é²œ
  cacheTime: 10 * 60 * 1000, // ç¼“å­˜ä¿ç•™ 10 åˆ†é’Ÿ
})

// æ•°æ®æ–°é²œæ—¶ï¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸å‘è¯·æ±‚
// æ•°æ®è¿‡æœŸä½†æœ‰ç¼“å­˜ï¼šå…ˆæ˜¾ç¤ºç¼“å­˜ï¼Œåå°åˆ·æ–°
// æ²¡æœ‰ç¼“å­˜ï¼šæ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œå‘é€è¯·æ±‚
</code></pre>
<h4 id="4-è‡ªåŠ¨çš„åå°é‡æ–°éªŒè¯">4. è‡ªåŠ¨çš„åå°é‡æ–°éªŒè¯</h4>
<pre><code class="language-typescript">// çª—å£èšç„¦æ—¶
refetchOnWindowFocus: true

// ç½‘ç»œé‡è¿æ—¶
refetchOnReconnect: true

// ç»„ä»¶é‡æ–°æŒ‚è½½æ—¶
refetchOnMount: true
</code></pre>
<hr>
<h2 id="å®é™…é¡¹ç›®å¯¹æ¯”">å®é™…é¡¹ç›®å¯¹æ¯”</h2>
<h3 id="åœºæ™¯-ç”¨æˆ·åˆ—è¡¨é¡µé¢">åœºæ™¯ï¼šç”¨æˆ·åˆ—è¡¨é¡µé¢</h3>
<h4 id="ä½¿ç”¨-useeffect-120-è¡Œä»£ç ">âŒ ä½¿ç”¨ useEffect (120 è¡Œä»£ç )</h4>
<pre><code class="language-typescript">function UsersPage() {
  // çŠ¶æ€ç®¡ç†
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)
  const [page, setPage] = useState(1)
  const [total, setTotal] = useState(0)
  const [search, setSearch] = useState(&#39;&#39;)

  // è·å–æ•°æ®
  useEffect(() =&gt; {
    let cancelled = false
    
    setLoading(true)
    setError(null)
    
    fetchUsers({ page, search })
      .then(response =&gt; {
        if (!cancelled) {
          setUsers(response.data)
          setTotal(response.total)
        }
      })
      .catch(err =&gt; {
        if (!cancelled) {
          setError(err.message)
        }
      })
      .finally(() =&gt; {
        if (!cancelled) {
          setLoading(false)
        }
      })

    return () =&gt; {
      cancelled = true
    }
  }, [page, search]) // ä¾èµ–å˜åŒ–æ—¶é‡æ–°è¯·æ±‚

  // æœç´¢é˜²æŠ–
  const [debouncedSearch, setDebouncedSearch] = useState(search)
  useEffect(() =&gt; {
    const timer = setTimeout(() =&gt; {
      setDebouncedSearch(search)
    }, 500)
    return () =&gt; clearTimeout(timer)
  }, [search])

  // åˆ é™¤ç”¨æˆ·
  const deleteUser = async (id) =&gt; {
    const originalUsers = [...users]
    
    // ä¹è§‚æ›´æ–°
    setUsers(users.filter(u =&gt; u.id !== id))
    
    try {
      await deleteUserApi(id)
    } catch (error) {
      // å›æ»š
      setUsers(originalUsers)
      setError(&#39;åˆ é™¤å¤±è´¥&#39;)
    }
  }

  // åˆ·æ–°
  const refresh = () =&gt; {
    setLoading(true)
    fetchUsers({ page, search })
      .then(response =&gt; {
        setUsers(response.data)
        setTotal(response.total)
      })
      .finally(() =&gt; setLoading(false))
  }

  // åˆ†é¡µ
  const handlePageChange = (newPage) =&gt; {
    setPage(newPage)
  }

  // æœç´¢
  const handleSearch = (value) =&gt; {
    setSearch(value)
    setPage(1) // é‡ç½®é¡µç 
  }

  if (loading &amp;&amp; !users.length) return &lt;Loading /&gt;
  if (error) return &lt;Error message={error} /&gt;

  return (
    &lt;div&gt;
      &lt;SearchBar value={search} onChange={handleSearch} /&gt;
      &lt;UserTable 
        users={users} 
        onDelete={deleteUser} 
        loading={loading}
      /&gt;
      &lt;Pagination 
        current={page}
        total={total}
        onChange={handlePageChange}
      /&gt;
      &lt;button onClick={refresh}&gt;åˆ·æ–°&lt;/button&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<hr>
<h4 id="ä½¿ç”¨-react-query-30-è¡Œä»£ç ">âœ… ä½¿ç”¨ React Query (30 è¡Œä»£ç )</h4>
<pre><code class="language-typescript">function UsersPage() {
  const [page, setPage] = useState(1)
  const [search, setSearch] = useState(&#39;&#39;)

  // è·å–ç”¨æˆ·åˆ—è¡¨
  const { data, isLoading, error, refetch } = useQuery({
    queryKey: [&#39;users&#39;, page, search],
    queryFn: () =&gt; fetchUsers({ page, search }),
    keepPreviousData: true, // åˆ‡é¡µæ—¶ä¿ç•™æ—§æ•°æ®
  })

  // åˆ é™¤ç”¨æˆ·
  const deleteMutation = useMutation({
    mutationFn: deleteUserApi,
    onSuccess: () =&gt; {
      queryClient.invalidateQueries({ queryKey: [&#39;users&#39;] })
    },
  })

  if (isLoading) return &lt;Loading /&gt;
  if (error) return &lt;Error message={error.message} /&gt;

  return (
    &lt;div&gt;
      &lt;SearchBar 
        value={search} 
        onChange={(value) =&gt; {
          setSearch(value)
          setPage(1)
        }} 
      /&gt;
      &lt;UserTable 
        users={data.data} 
        onDelete={(id) =&gt; deleteMutation.mutate(id)}
        loading={deleteMutation.isLoading}
      /&gt;
      &lt;Pagination 
        current={page}
        total={data.total}
        onChange={setPage}
      /&gt;
      &lt;button onClick={refetch}&gt;åˆ·æ–°&lt;/button&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p><strong>å¯¹æ¯”ï¼š</strong></p>
<ul>
<li>ä»£ç å‡å°‘ï¼š75% (120è¡Œ â†’ 30è¡Œ)</li>
<li>è‡ªåŠ¨é˜²æŠ–ï¼šé€šè¿‡ queryKey å˜åŒ–</li>
<li>è‡ªåŠ¨ç¼“å­˜ï¼šåˆ‡é¡µå†å›æ¥æ— éœ€é‡æ–°è¯·æ±‚</li>
<li>è‡ªåŠ¨å–æ¶ˆï¼šæœç´¢æ—¶æ—§è¯·æ±‚è‡ªåŠ¨å–æ¶ˆ</li>
<li>ä¿ç•™æ—§æ•°æ®ï¼šåˆ‡é¡µæ—¶ä¸é—ªå±</li>
</ul>
<hr>
<h2 id="æ€§èƒ½å’Œä½“éªŒæå‡">æ€§èƒ½å’Œä½“éªŒæå‡</h2>
<h3 id="æ€§èƒ½å¯¹æ¯”">ğŸ“Š æ€§èƒ½å¯¹æ¯”</h3>
<h4 id="åœºæ™¯-1-ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾">åœºæ™¯ 1: ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾</h4>
<pre><code>ç”¨æˆ·åœ¨åˆ—è¡¨é¡µå¿«é€Ÿç‚¹å‡» 10 ä¸ªç”¨æˆ·æŸ¥çœ‹è¯¦æƒ…

useEffect æ–¹å¼ï¼š
- å‘é€ 10 æ¬¡è¯·æ±‚
- å¯èƒ½æ˜¾ç¤ºé”™è¯¯ç”¨æˆ·ï¼ˆç«æ€æ¡ä»¶ï¼‰
- æ¯æ¬¡éƒ½æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- è¿”å›åˆ—è¡¨æ—¶åˆé‡æ–°è¯·æ±‚

React Query æ–¹å¼ï¼š
- å‘é€ 10 æ¬¡è¯·æ±‚
- è‡ªåŠ¨å–æ¶ˆè¿‡æœŸè¯·æ±‚ï¼Œä¿è¯æ­£ç¡®
- ç¼“å­˜æ¯ä¸ªç”¨æˆ·æ•°æ®
- è¿”å›åˆ—è¡¨æ—¶ä½¿ç”¨ç¼“å­˜ï¼Œæ— éœ€è¯·æ±‚
</code></pre>
<p><strong>æ€§èƒ½æå‡ï¼š50-70%</strong> ï¼ˆå‡å°‘è¯·æ±‚æ¬¡æ•°ï¼‰</p>
<hr>
<h4 id="åœºæ™¯-2-å¤šç»„ä»¶å…±äº«æ•°æ®">åœºæ™¯ 2: å¤šç»„ä»¶å…±äº«æ•°æ®</h4>
<pre><code>Dashboard æœ‰ 5 ä¸ªç»„ä»¶éƒ½éœ€è¦ç”¨æˆ·ä¿¡æ¯

useEffect æ–¹å¼ï¼š
- å‘é€ 5 æ¬¡ç›¸åŒè¯·æ±‚
- æˆ–è€…éœ€è¦æ‰‹åŠ¨å®ç° Context å…±äº«

React Query æ–¹å¼ï¼š
- åªå‘é€ 1 æ¬¡è¯·æ±‚
- è‡ªåŠ¨å…±äº«ç»™æ‰€æœ‰ç»„ä»¶
</code></pre>
<p><strong>è¯·æ±‚å‡å°‘ï¼š80%</strong> ï¼ˆ5ä¸ªè¯·æ±‚ â†’ 1ä¸ªè¯·æ±‚ï¼‰</p>
<hr>
<h4 id="åœºæ™¯-3-ç¦»çº¿åé‡è¿">åœºæ™¯ 3: ç¦»çº¿åé‡è¿</h4>
<pre><code>ç”¨æˆ·ç½‘ç»œä¸­æ–­ 1 åˆ†é’Ÿåæ¢å¤

useEffect æ–¹å¼ï¼š
- éœ€è¦æ‰‹åŠ¨ç›‘å¬ online äº‹ä»¶
- æ‰‹åŠ¨åˆ·æ–°æ•°æ®
- å¯èƒ½é—æ¼æŸäº›ç»„ä»¶

React Query æ–¹å¼ï¼š
- è‡ªåŠ¨æ£€æµ‹ç½‘ç»œæ¢å¤
- è‡ªåŠ¨åˆ·æ–°æ‰€æœ‰è¿‡æœŸæ•°æ®
- é›¶é¢å¤–ä»£ç 
</code></pre>
<hr>
<h3 id="ç”¨æˆ·ä½“éªŒæå‡">ğŸ’¡ ç”¨æˆ·ä½“éªŒæå‡</h3>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>useEffect</th>
<th>React Query</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¦–æ¬¡åŠ è½½</strong></td>
<td>æ˜¾ç¤ºåŠ è½½ä¸­</td>
<td>æ˜¾ç¤ºåŠ è½½ä¸­</td>
</tr>
<tr>
<td><strong>å†æ¬¡è®¿é—®</strong></td>
<td>é‡æ–°åŠ è½½ï¼Œé—ªå± âš ï¸</td>
<td>ç«‹å³æ˜¾ç¤ºç¼“å­˜ âœ…</td>
</tr>
<tr>
<td><strong>åˆ‡æ¢é¡µé¢åè¿”å›</strong></td>
<td>é‡æ–°åŠ è½½ï¼Œé—ªå± âš ï¸</td>
<td>ç«‹å³æ˜¾ç¤ºç¼“å­˜ âœ…</td>
</tr>
<tr>
<td><strong>çª—å£å¤±ç„¦åè¿”å›</strong></td>
<td>æ•°æ®å¯èƒ½è¿‡æœŸ âš ï¸</td>
<td>è‡ªåŠ¨åˆ·æ–° âœ…</td>
</tr>
<tr>
<td><strong>ç½‘ç»œä¸­æ–­æ¢å¤</strong></td>
<td>éœ€æ‰‹åŠ¨åˆ·æ–° âš ï¸</td>
<td>è‡ªåŠ¨åˆ·æ–° âœ…</td>
</tr>
<tr>
<td><strong>é‡å¤è¯·æ±‚</strong></td>
<td>å‘é€å¤šæ¬¡ âš ï¸</td>
<td>è‡ªåŠ¨å»é‡ âœ…</td>
</tr>
<tr>
<td><strong>ç«æ€æ¡ä»¶</strong></td>
<td>å¯èƒ½æ˜¾ç¤ºé”™è¯¯æ•°æ® âŒ</td>
<td>è‡ªåŠ¨å¤„ç† âœ…</td>
</tr>
</tbody></table>
<hr>
<h2 id="ä½•æ—¶ä»éœ€è¦-useeffect">ä½•æ—¶ä»éœ€è¦ useEffect</h2>
<p><strong>é‡è¦ï¼šuseEffect å¹¶æœªè¢«å®Œå…¨æŠ›å¼ƒï¼</strong></p>
<h3 id="useeffect-çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯">âœ… useEffect çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯</h3>
<h4 id="1-éæ•°æ®è·å–çš„å‰¯ä½œç”¨">1. éæ•°æ®è·å–çš„å‰¯ä½œç”¨</h4>
<pre><code class="language-typescript">// âœ… æ›´æ–°é¡µé¢æ ‡é¢˜
useEffect(() =&gt; {
  document.title = `æ‚¨æœ‰ ${count} æ¡æ–°æ¶ˆæ¯`
}, [count])

// âœ… æ·»åŠ å…¨å±€äº‹ä»¶ç›‘å¬
useEffect(() =&gt; {
  const handleResize = () =&gt; {
    console.log(&#39;çª—å£å¤§å°æ”¹å˜&#39;)
  }
  
  window.addEventListener(&#39;resize&#39;, handleResize)
  return () =&gt; window.removeEventListener(&#39;resize&#39;, handleResize)
}, [])
</code></pre>
<h4 id="2-dom-æ“ä½œ">2. DOM æ“ä½œ</h4>
<pre><code class="language-typescript">// âœ… è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
useEffect(() =&gt; {
  inputRef.current?.focus()
}, [])

// âœ… æ»šåŠ¨åˆ°é¡¶éƒ¨
useEffect(() =&gt; {
  window.scrollTo(0, 0)
}, [pathname])
</code></pre>
<h4 id="3-è®¢é˜…å¤–éƒ¨æ•°æ®æº">3. è®¢é˜…å¤–éƒ¨æ•°æ®æº</h4>
<pre><code class="language-typescript">// âœ… WebSocket è®¢é˜…
useEffect(() =&gt; {
  const ws = new WebSocket(&#39;ws://example.com&#39;)
  
  ws.onmessage = (event) =&gt; {
    console.log(&#39;æ”¶åˆ°æ¶ˆæ¯:&#39;, event.data)
  }
  
  return () =&gt; ws.close()
}, [])
</code></pre>
<h4 id="4-åŒæ­¥-react-çŠ¶æ€åˆ°å¤–éƒ¨ç³»ç»Ÿ">4. åŒæ­¥ React çŠ¶æ€åˆ°å¤–éƒ¨ç³»ç»Ÿ</h4>
<pre><code class="language-typescript">// âœ… åŒæ­¥çŠ¶æ€åˆ° localStorage
useEffect(() =&gt; {
  localStorage.setItem(&#39;theme&#39;, theme)
}, [theme])
</code></pre>
<h3 id="ä¸è¦ç”¨-useeffect-åšæ•°æ®è·å–">âŒ ä¸è¦ç”¨ useEffect åšæ•°æ®è·å–</h3>
<pre><code class="language-typescript">// âŒ é”™è¯¯
useEffect(() =&gt; {
  fetchUsers().then(setUsers)
}, [])

// âœ… æ­£ç¡®
const { data: users } = useQuery({
  queryKey: [&#39;users&#39;],
  queryFn: fetchUsers,
})
</code></pre>
<hr>
<h2 id="è¿ç§»æŒ‡å—">è¿ç§»æŒ‡å—</h2>
<h3 id="æ­¥éª¤-1-å®‰è£…-react-query">æ­¥éª¤ 1: å®‰è£… React Query</h3>
<pre><code class="language-bash">pnpm add @tanstack/react-query @tanstack/react-query-devtools
</code></pre>
<h3 id="æ­¥éª¤-2-è®¾ç½®-queryclient">æ­¥éª¤ 2: è®¾ç½® QueryClient</h3>
<pre><code class="language-typescript">// app/layout.tsx
import { QueryClient, QueryClientProvider } from &#39;@tanstack/react-query&#39;
import { ReactQueryDevtools } from &#39;@tanstack/react-query-devtools&#39;

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
      cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
      retry: 1,
      refetchOnWindowFocus: false, // å¯é€‰ï¼šå…³é—­çª—å£èšç„¦åˆ·æ–°
    },
  },
})

export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        &lt;QueryClientProvider client={queryClient}&gt;
          {children}
          &lt;ReactQueryDevtools initialIsOpen={false} /&gt;
        &lt;/QueryClientProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<h3 id="æ­¥éª¤-3-è¿ç§»ç¬¬ä¸€ä¸ªç»„ä»¶">æ­¥éª¤ 3: è¿ç§»ç¬¬ä¸€ä¸ªç»„ä»¶</h3>
<h4 id="before-useeffect">Before (useEffect)</h4>
<pre><code class="language-typescript">function Users() {
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() =&gt; {
    setLoading(true)
    fetchUsers()
      .then(setUsers)
      .catch(setError)
      .finally(() =&gt; setLoading(false))
  }, [])

  if (loading) return &lt;Loading /&gt;
  if (error) return &lt;Error /&gt;
  return &lt;UserList users={users} /&gt;
}
</code></pre>
<h4 id="after-react-query">After (React Query)</h4>
<pre><code class="language-typescript">function Users() {
  const { data: users, isLoading, error } = useQuery({
    queryKey: [&#39;users&#39;],
    queryFn: fetchUsers,
  })

  if (isLoading) return &lt;Loading /&gt;
  if (error) return &lt;Error /&gt;
  return &lt;UserList users={users} /&gt;
}
</code></pre>
<h3 id="æ­¥éª¤-4-è¿ç§»å¸¦å‚æ•°çš„è¯·æ±‚">æ­¥éª¤ 4: è¿ç§»å¸¦å‚æ•°çš„è¯·æ±‚</h3>
<h4 id="before">Before</h4>
<pre><code class="language-typescript">function UserProfile({ userId }) {
  const [user, setUser] = useState(null)

  useEffect(() =&gt; {
    let cancelled = false
    fetchUser(userId).then(data =&gt; {
      if (!cancelled) setUser(data)
    })
    return () =&gt; { cancelled = true }
  }, [userId])
}
</code></pre>
<h4 id="after">After</h4>
<pre><code class="language-typescript">function UserProfile({ userId }) {
  const { data: user } = useQuery({
    queryKey: [&#39;user&#39;, userId], // åŒ…å«å‚æ•°
    queryFn: () =&gt; fetchUser(userId),
  })
}
</code></pre>
<h3 id="æ­¥éª¤-5-è¿ç§»-post-put-delete-æ“ä½œ">æ­¥éª¤ 5: è¿ç§» POST/PUT/DELETE æ“ä½œ</h3>
<h4 id="before">Before</h4>
<pre><code class="language-typescript">const createUser = async (userData) =&gt; {
  setLoading(true)
  try {
    const newUser = await createUserApi(userData)
    setUsers([...users, newUser])
  } catch (error) {
    setError(error)
  } finally {
    setLoading(false)
  }
}
</code></pre>
<h4 id="after">After</h4>
<pre><code class="language-typescript">const createUserMutation = useMutation({
  mutationFn: createUserApi,
  onSuccess: () =&gt; {
    // åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
    queryClient.invalidateQueries({ queryKey: [&#39;users&#39;] })
  },
})

// ä½¿ç”¨
createUserMutation.mutate(userData)
</code></pre>
<hr>
<h2 id="å¸¸è§é—®é¢˜è§£ç­”">å¸¸è§é—®é¢˜è§£ç­”</h2>
<h3 id="q1-react-query-ä¼šå¢åŠ åŒ…ä½“ç§¯å—">Q1: React Query ä¼šå¢åŠ åŒ…ä½“ç§¯å—ï¼Ÿ</h3>
<p><strong>A:</strong> ä¼šå¢åŠ çº¦ 13KB (gzip å ~4KB)ï¼Œä½†è€ƒè™‘åˆ°ï¼š</p>
<ul>
<li>å‡å°‘ 70-90% çš„ä¸šåŠ¡ä»£ç </li>
<li>é¿å…è‡ªå·±å®ç°ç¼“å­˜ã€å–æ¶ˆç­‰é€»è¾‘</li>
<li>æ€§èƒ½æå‡å¸¦æ¥çš„ä»·å€¼</li>
</ul>
<p><strong>å®Œå…¨å€¼å¾—ï¼</strong></p>
<hr>
<h3 id="q2-å­¦ä¹ -react-query-éš¾å—">Q2: å­¦ä¹  React Query éš¾å—ï¼Ÿ</h3>
<p><strong>A:</strong> åŸºç¡€ç”¨æ³•éå¸¸ç®€å•ï¼š</p>
<pre><code class="language-typescript">// 99% çš„åœºæ™¯åªéœ€è¦è¿™ä¸ª
const { data, isLoading, error } = useQuery({
  queryKey: [&#39;key&#39;],
  queryFn: fetchData,
})
</code></pre>
<p>è¿›é˜¶åŠŸèƒ½ï¼ˆä¹è§‚æ›´æ–°ã€æ— é™æ»šåŠ¨ç­‰ï¼‰å¯ä»¥æ¸è¿›å¼å­¦ä¹ ã€‚</p>
<hr>
<h3 id="q3-å¦‚ä½•å¤„ç†éœ€è¦ç«‹å³æ‰§è¡Œçš„è¯·æ±‚">Q3: å¦‚ä½•å¤„ç†éœ€è¦ç«‹å³æ‰§è¡Œçš„è¯·æ±‚ï¼Ÿ</h3>
<p><strong>A:</strong> useQuery é»˜è®¤åœ¨ç»„ä»¶æŒ‚è½½æ—¶å°±ä¼šæ‰§è¡Œã€‚å¦‚æœéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼š</p>
<pre><code class="language-typescript">const { data, refetch } = useQuery({
  queryKey: [&#39;data&#39;],
  queryFn: fetchData,
  enabled: false, // ä¸è‡ªåŠ¨æ‰§è¡Œ
})

// æ‰‹åŠ¨è§¦å‘
&lt;button onClick={() =&gt; refetch()}&gt;åŠ è½½æ•°æ®&lt;/button&gt;
</code></pre>
<hr>
<h3 id="q4-å¦‚ä½•å¤„ç†ä¾èµ–å…¶ä»–æ•°æ®çš„è¯·æ±‚">Q4: å¦‚ä½•å¤„ç†ä¾èµ–å…¶ä»–æ•°æ®çš„è¯·æ±‚ï¼Ÿ</h3>
<p><strong>A:</strong> ä½¿ç”¨ <code>enabled</code> é€‰é¡¹ï¼š</p>
<pre><code class="language-typescript">// å…ˆè·å–ç”¨æˆ·
const { data: user } = useQuery({
  queryKey: [&#39;user&#39;],
  queryFn: fetchUser,
})

// åªæœ‰å½“ç”¨æˆ·æ•°æ®å­˜åœ¨æ—¶æ‰è·å–è®¢å•
const { data: orders } = useQuery({
  queryKey: [&#39;orders&#39;, user?.id],
  queryFn: () =&gt; fetchOrders(user.id),
  enabled: !!user, // âœ… æ¡ä»¶å¯ç”¨
})
</code></pre>
<hr>
<h3 id="q5-useeffect-çš„ä¾èµ–æ•°ç»„åœ¨-react-query-ä¸­å¦‚ä½•ä½“ç°">Q5: useEffect çš„ä¾èµ–æ•°ç»„åœ¨ React Query ä¸­å¦‚ä½•ä½“ç°ï¼Ÿ</h3>
<p><strong>A:</strong> é€šè¿‡ <code>queryKey</code> å®ç°ï¼š</p>
<pre><code class="language-typescript">// useEffect æ–¹å¼
useEffect(() =&gt; {
  fetchData(userId, page)
}, [userId, page]) // ä¾èµ–æ•°ç»„

// React Query æ–¹å¼
useQuery({
  queryKey: [&#39;data&#39;, userId, page], // queryKey åŒ…å«æ‰€æœ‰ä¾èµ–
  queryFn: () =&gt; fetchData(userId, page),
})
// queryKey å˜åŒ– = é‡æ–°è¯·æ±‚
</code></pre>
<hr>
<h3 id="q6-å¦‚ä½•æ¸…ç©ºç¼“å­˜">Q6: å¦‚ä½•æ¸…ç©ºç¼“å­˜ï¼Ÿ</h3>
<pre><code class="language-typescript">// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
queryClient.clear()

// æ¸…ç©ºç‰¹å®šç¼“å­˜
queryClient.removeQueries({ queryKey: [&#39;users&#39;] })

// ä½¿ç‰¹å®šç¼“å­˜å¤±æ•ˆï¼ˆä¼šè§¦å‘åˆ·æ–°ï¼‰
queryClient.invalidateQueries({ queryKey: [&#39;users&#39;] })
</code></pre>
<hr>
<h3 id="q7-react-query-ä¸-redux-æœ‰ä»€ä¹ˆåŒºåˆ«">Q7: React Query ä¸ Redux æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>React Query</th>
<th>Redux</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä¸»è¦ç”¨é€”</strong></td>
<td>æœåŠ¡ç«¯çŠ¶æ€</td>
<td>å®¢æˆ·ç«¯çŠ¶æ€</td>
</tr>
<tr>
<td><strong>æ•°æ®æ¥æº</strong></td>
<td>API è¯·æ±‚</td>
<td>åº”ç”¨å†…çŠ¶æ€</td>
</tr>
<tr>
<td><strong>ç¼“å­˜</strong></td>
<td>è‡ªåŠ¨</td>
<td>æ‰‹åŠ¨</td>
</tr>
<tr>
<td><strong>å¼‚æ­¥å¤„ç†</strong></td>
<td>å†…ç½®</td>
<td>éœ€è¦ä¸­é—´ä»¶</td>
</tr>
<tr>
<td><strong>ä»£ç é‡</strong></td>
<td>å°‘</td>
<td>å¤š</td>
</tr>
</tbody></table>
<p><strong>å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼</strong></p>
<ul>
<li>Redux: ç®¡ç†åº”ç”¨çŠ¶æ€ï¼ˆä¸»é¢˜ã€ç”¨æˆ·åå¥½ç­‰ï¼‰</li>
<li>React Query: ç®¡ç†æœåŠ¡ç«¯æ•°æ®ï¼ˆAPI è¯·æ±‚ï¼‰</li>
</ul>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="æ ¸å¿ƒè¦ç‚¹">ğŸ¯ æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li><strong>useEffect ä¸æ˜¯ä¸ºæ•°æ®è·å–è®¾è®¡çš„</strong> - å®ƒæ˜¯ä¸ºå‰¯ä½œç”¨è®¾è®¡çš„</li>
<li><strong>React Query è§£å†³äº†æ‰€æœ‰ç—›ç‚¹</strong> - ç«æ€æ¡ä»¶ã€ç¼“å­˜ã€åŠ è½½çŠ¶æ€ç­‰</li>
<li><strong>ä»£ç é‡å‡å°‘ 70-90%</strong> - æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„ bug</li>
<li><strong>æ€§èƒ½å’Œä½“éªŒæ˜¾è‘—æå‡</strong> - æ™ºèƒ½ç¼“å­˜ï¼Œè‡ªåŠ¨ä¼˜åŒ–</li>
<li><strong>useEffect ä»ç„¶æœ‰ç”¨</strong> - ç”¨äºéæ•°æ®è·å–çš„å‰¯ä½œç”¨</li>
</ol>
<h3 id="è¿ç§»å¸¦æ¥çš„ä»·å€¼">ğŸ“ˆ è¿ç§»å¸¦æ¥çš„ä»·å€¼</h3>
<ul>
<li><strong>å¼€å‘æ•ˆç‡</strong>: â¬†ï¸ 3-5å€</li>
<li><strong>ä»£ç è´¨é‡</strong>: â¬†ï¸ æ˜¾è‘—æå‡</li>
<li><strong>Bug æ•°é‡</strong>: â¬‡ï¸ 60-70%</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: â¬†ï¸ æ˜æ˜¾æ”¹å–„</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>: â¬†ï¸ å¤§å¹…æå‡</li>
</ul>
<h3 id="ç«‹å³å¼€å§‹">ğŸš€ ç«‹å³å¼€å§‹</h3>
<pre><code class="language-typescript">// 1. å®‰è£…
pnpm add @tanstack/react-query

// 2. é…ç½®
&lt;QueryClientProvider client={queryClient}&gt;
  &lt;App /&gt;
&lt;/QueryClientProvider&gt;

// 3. ä½¿ç”¨
const { data } = useQuery({
  queryKey: [&#39;data&#39;],
  queryFn: fetchData,
})
</code></pre>
<h3 id="æ¨èèµ„æº">ğŸ“š æ¨èèµ„æº</h3>
<ul>
<li><a href="https://tanstack.com/query/latest">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://tkdodo.eu/blog/practical-react-query">å®æˆ˜æ•™ç¨‹</a></li>
<li><a href="https://www.youtube.com/c/TanStack">è§†é¢‘æ•™ç¨‹</a></li>
</ul>
<hr>
<p><strong>æœ€åçš„å»ºè®®ï¼š</strong></p>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ useEffect è¿›è¡Œæ•°æ®è·å–ï¼Œå¼ºçƒˆå»ºè®®è¿ç§»åˆ° React Queryã€‚è¿™ä¸ä»…æ˜¯æŠ€æœ¯é€‰å‹çš„é—®é¢˜ï¼Œæ›´æ˜¯ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒçš„é‡å¤§æå‡ã€‚</p>
<p><strong>æ•°æ®è·å–ç”¨ React Queryï¼Œå…¶ä»–å‰¯ä½œç”¨ç”¨ useEffect</strong> - è¿™å°±æ˜¯ç°ä»£ React åº”ç”¨çš„æœ€ä½³å®è·µã€‚</p>
<hr>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>: 1.0<br><strong>æœ€åæ›´æ–°</strong>: 2025-11-05<br><strong>ç»´æŠ¤è€…</strong>: Development Team</p>

</div>
</body>
</html>